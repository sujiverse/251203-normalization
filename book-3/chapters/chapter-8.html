<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>8ì¥: ì¼ìƒ ì—…ë¬´ ì‹œë®¬ë ˆì´ì…˜ - ë¬¼ë¦¬ì¹˜ë£Œì‚¬ë¥¼ ìœ„í•œ ë°ì´í„°ë² ì´ìŠ¤ 3ê¶Œ</title>
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
    @@include('components/top-nav.html', {"root": "../..", "activeBook": "3"})

    @@include('components/mobile-menu.html')
    <div class="container">
        <nav class="sidebar" id="sidebar">
            <button class="close-btn" onclick="toggleMenu()">Ã—</button>
            <div class="sidebar-header">
                <h1>ğŸ“™ ë¬¼ë¦¬ì¹˜ë£Œì‚¬ë¥¼ ìœ„í•œ</h1>
                <p>ì‹¤ì „ êµ¬ì¶• & ëŒ€ì‹œë³´ë“œ (3ê¶Œ)</p>
            </div>
            <ul class="nav-list" id="navList"></ul>
        </nav>
        <main class="main">
<h1 class="title">ì¼ìƒ ì—…ë¬´ ì‹œë®¬ë ˆì´ì…˜</h1>

<h2>ì‹¤ì œ í´ë¦¬ë‹‰ì²˜ëŸ¼ ìš´ì˜í•´ë³´ê¸°</h2>

<p>ë°ì´í„°ë² ì´ìŠ¤ê°€ ì™„ì„±ë˜ì—ˆìœ¼ë‹ˆ, ì´ì œ ì‹¤ì œë¡œ ì‚¬ìš©í•´ë³¼ ì°¨ë¡€ì…ë‹ˆë‹¤. íë§ì† ë¬¼ë¦¬ì¹˜ë£Œì„¼í„°ì˜ í•˜ë£¨ë¥¼ ì‹œë®¬ë ˆì´ì…˜í•˜ë©´ì„œ, ìì£¼ ì‚¬ìš©í•˜ëŠ” ì¿¼ë¦¬ë“¤ì„ ìµí˜€ë´…ì‹œë‹¤.</p>

<p>ì˜¤ëŠ˜ì€ <strong>2024ë…„ 3ì›” 25ì¼ ì›”ìš”ì¼</strong>ì…ë‹ˆë‹¤. ê¹€ì§€í›ˆ ì›ì¥ì´ ì¶œê·¼í•´ì„œ í•˜ë£¨ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤.</p>

<hr>

<h2>1. ì•„ì¹¨: ì˜¤ëŠ˜ ì˜ˆì•½ í™•ì¸</h2>

<h3>ì˜¤ëŠ˜ ì˜ˆì•½ëœ í™˜ì ëª©ë¡</h3>

<pre><code>SELECT
    TIME_FORMAT(ts.start_time, '%H:%i') as ì‹œê°„,
    p.name as í™˜ìëª…,
    p.phone as ì—°ë½ì²˜,
    t.name as ë‹´ë‹¹ì¹˜ë£Œì‚¬,
    ts.notes as ë©”ëª¨
FROM treatment_sessions ts
JOIN patients p ON ts.patient_id = p.patient_id
JOIN therapists t ON ts.therapist_id = t.therapist_id
WHERE ts.session_date = '2024-03-25'
ORDER BY ts.start_time;</code></pre>

<h3>ì¹˜ë£Œì‚¬ë³„ ì˜¤ëŠ˜ ìŠ¤ì¼€ì¤„</h3>

<pre><code>SELECT
    t.name as ì¹˜ë£Œì‚¬,
    COUNT(*) as ì˜ˆì•½ê±´ìˆ˜,
    GROUP_CONCAT(
        CONCAT(TIME_FORMAT(ts.start_time, '%H:%i'), ' ', p.name)
        ORDER BY ts.start_time
        SEPARATOR ', '
    ) as ìŠ¤ì¼€ì¤„
FROM treatment_sessions ts
JOIN therapists t ON ts.therapist_id = t.therapist_id
JOIN patients p ON ts.patient_id = p.patient_id
WHERE ts.session_date = '2024-03-25'
GROUP BY t.therapist_id, t.name
ORDER BY t.name;</code></pre>

<hr>

<h2>2. í™˜ì ì ‘ìˆ˜: í™˜ì ì •ë³´ ì¡°íšŒ</h2>

<h3>í™˜ì ê²€ìƒ‰ (ì´ë¦„ìœ¼ë¡œ)</h3>

<pre><code>SELECT
    patient_id,
    name,
    gender,
    phone,
    TIMESTAMPDIFF(YEAR, birth_date, CURDATE()) as ë‚˜ì´,
    memo
FROM patients
WHERE name LIKE '%ê°•ë¯¼%';</code></pre>

<h3>í™˜ì ìƒì„¸ ì •ë³´</h3>

<pre><code>SELECT
    p.patient_id,
    p.name,
    CASE p.gender WHEN 'M' THEN 'ë‚¨' ELSE 'ì—¬' END as ì„±ë³„,
    p.birth_date,
    TIMESTAMPDIFF(YEAR, p.birth_date, CURDATE()) as ë‚˜ì´,
    p.phone,
    p.email,
    i.insurance_name as ë³´í—˜,
    p.memo
FROM patients p
LEFT JOIN insurances i ON p.insurance_code = i.insurance_code
WHERE p.patient_id = 'P001';</code></pre>

<h3>í™˜ìì˜ ì§„ë‹¨ ì •ë³´</h3>

<pre><code>SELECT
    d.diagnosis_code as ì½”ë“œ,
    d.diagnosis_name as ì§„ë‹¨ëª…,
    pd.diagnosis_date as ì§„ë‹¨ì¼,
    CASE pd.is_primary WHEN 'Y' THEN 'ì£¼ì§„ë‹¨' ELSE 'ë¶€ì§„ë‹¨' END as êµ¬ë¶„,
    pd.notes as ë¹„ê³ 
FROM patient_diagnoses pd
JOIN diagnosis_codes d ON pd.diagnosis_code = d.diagnosis_code
WHERE pd.patient_id = 'P001'
ORDER BY pd.is_primary DESC;</code></pre>

<h3>í™˜ìì˜ ì¹˜ë£Œ ì´ë ¥</h3>

<pre><code>SELECT
    ts.session_date as ë‚ ì§œ,
    t.name as ì¹˜ë£Œì‚¬,
    f.fee_name as ì¹˜ë£Œí•­ëª©,
    b.total_amount as ê¸ˆì•¡,
    b.payment_status as ìˆ˜ë‚©ìƒíƒœ
FROM treatment_sessions ts
JOIN therapists t ON ts.therapist_id = t.therapist_id
JOIN billings b ON ts.session_id = b.session_id
JOIN fee_items f ON b.fee_code = f.fee_code
WHERE ts.patient_id = 'P001'
ORDER BY ts.session_date DESC
LIMIT 10;</code></pre>

<hr>

<h2>3. ì‹ ê·œ í™˜ì ë“±ë¡</h2>

<p>ìƒˆë¡œìš´ í™˜ìê°€ ì™”ìŠµë‹ˆë‹¤. ì •ë³´ë¥¼ ì…ë ¥í•´ë´…ì‹œë‹¤.</p>

<pre><code>-- ì‹ ê·œ í™˜ì ë“±ë¡
INSERT INTO patients (
    patient_id, name, gender, birth_date, phone,
    email, address, insurance_code,
    emergency_contact, emergency_phone, memo
) VALUES (
    'P031', 'ê¹€ìƒˆí™˜ì', 'M', '1990-05-15', '010-9999-0001',
    'newpatient@email.com', 'ì„œìš¸ì‹œ ê°•ë‚¨êµ¬ ì—­ì‚¼ë™ 100-1', 'INS001',
    'ê¹€ë³´í˜¸ì', '010-9999-0002', 'ì›¹ ê²€ìƒ‰ìœ¼ë¡œ ë°©ë¬¸, í—ˆë¦¬ í†µì¦'
);

-- ì§„ë‹¨ ì—°ê²°
INSERT INTO patient_diagnoses (patient_id, diagnosis_code, diagnosis_date, is_primary, notes)
VALUES ('P031', 'M54.5', '2024-03-25', 'Y', 'ê¸‰ì„± ìš”í†µ');</code></pre>

<hr>

<h2>4. ì¹˜ë£Œ ê¸°ë¡ ì…ë ¥</h2>

<h3>ì¹˜ë£Œ ì„¸ì…˜ ë“±ë¡</h3>

<pre><code>-- ì¹˜ë£Œ ì„¸ì…˜ ê¸°ë¡
INSERT INTO treatment_sessions (
    patient_id, therapist_id, session_date,
    start_time, end_time, session_status, notes
) VALUES (
    'P001', 'T001', '2024-03-25',
    '10:00', '10:30', 'ì™„ë£Œ', 'ë„ìˆ˜ì¹˜ë£Œ, ìƒíƒœ í˜¸ì „ ì¤‘'
);</code></pre>

<h3>ì²­êµ¬ ë“±ë¡</h3>

<pre><code>-- ë°©ê¸ˆ ì…ë ¥í•œ ì„¸ì…˜ì˜ ID í™•ì¸
SELECT LAST_INSERT_ID() as ìƒˆì„¸ì…˜ID;

-- ì²­êµ¬ ì…ë ¥ (ì„¸ì…˜IDê°€ 88ì´ë¼ê³  ê°€ì •)
INSERT INTO billings (
    session_id, fee_code, quantity, unit_price,
    total_amount, payment_status, payment_method, payment_date
) VALUES (
    88, 'FEE001', 1, 80000,
    80000, 'ì™„ë£Œ', 'ì¹´ë“œ', '2024-03-25'
);</code></pre>

<hr>

<h2>5. ì˜¤í›„: í˜„í™© í™•ì¸</h2>

<h3>ì˜¤ëŠ˜ ë§¤ì¶œ í˜„í™©</h3>

<pre><code>SELECT
    COUNT(*) as ì¹˜ë£Œê±´ìˆ˜,
    SUM(CASE WHEN b.payment_status = 'ì™„ë£Œ' THEN b.total_amount ELSE 0 END) as ìˆ˜ë‚©ì™„ë£Œ,
    SUM(CASE WHEN b.payment_status = 'ëŒ€ê¸°' THEN b.total_amount ELSE 0 END) as ë¯¸ìˆ˜ê¸ˆ
FROM treatment_sessions ts
JOIN billings b ON ts.session_id = b.session_id
WHERE ts.session_date = '2024-03-25';</code></pre>

<h3>ë¯¸ìˆ˜ê¸ˆ ëª©ë¡</h3>

<pre><code>SELECT
    p.name as í™˜ìëª…,
    p.phone as ì—°ë½ì²˜,
    ts.session_date as ì¹˜ë£Œì¼,
    f.fee_name as í•­ëª©,
    b.total_amount as ê¸ˆì•¡,
    DATEDIFF(CURDATE(), ts.session_date) as ê²½ê³¼ì¼
FROM billings b
JOIN treatment_sessions ts ON b.session_id = ts.session_id
JOIN patients p ON ts.patient_id = p.patient_id
JOIN fee_items f ON b.fee_code = f.fee_code
WHERE b.payment_status = 'ëŒ€ê¸°'
  AND b.total_amount > 0
ORDER BY ts.session_date;</code></pre>

<hr>

<h2>6. í•´í”¼ì½œ ëŒ€ìƒì í™•ì¸</h2>

<h3>7ì¼ ì´ìƒ ë¯¸ë°©ë¬¸ í™˜ì (ì—°ë½ í•„ìš”)</h3>

<pre><code>SELECT
    p.name as í™˜ìëª…,
    p.phone as ì—°ë½ì²˜,
    MAX(ts.session_date) as ë§ˆì§€ë§‰ë°©ë¬¸,
    DATEDIFF('2024-03-25', MAX(ts.session_date)) as ê²½ê³¼ì¼,
    d.diagnosis_name as ì£¼ì§„ë‹¨
FROM patients p
JOIN treatment_sessions ts ON p.patient_id = ts.patient_id
LEFT JOIN patient_diagnoses pd ON p.patient_id = pd.patient_id AND pd.is_primary = 'Y'
LEFT JOIN diagnosis_codes d ON pd.diagnosis_code = d.diagnosis_code
WHERE p.is_active = 'Y'
GROUP BY p.patient_id, p.name, p.phone, d.diagnosis_name
HAVING DATEDIFF('2024-03-25', MAX(ts.session_date)) BETWEEN 7 AND 14
ORDER BY ê²½ê³¼ì¼ DESC;</code></pre>

<h3>30ì¼ ì´ìƒ ë¯¸ë°©ë¬¸ (ì´íƒˆ ìœ„í—˜)</h3>

<pre><code>SELECT
    p.name as í™˜ìëª…,
    p.phone as ì—°ë½ì²˜,
    MAX(ts.session_date) as ë§ˆì§€ë§‰ë°©ë¬¸,
    DATEDIFF('2024-03-25', MAX(ts.session_date)) as ê²½ê³¼ì¼,
    COUNT(ts.session_id) as ì´ë°©ë¬¸íšŸìˆ˜
FROM patients p
JOIN treatment_sessions ts ON p.patient_id = ts.patient_id
WHERE p.is_active = 'Y'
GROUP BY p.patient_id, p.name, p.phone
HAVING DATEDIFF('2024-03-25', MAX(ts.session_date)) > 30
ORDER BY ê²½ê³¼ì¼ DESC;</code></pre>

<hr>

<h2>7. ì €ë…: ë§ˆê° ì—…ë¬´</h2>

<h3>ì˜¤ëŠ˜ ì¹˜ë£Œì‚¬ë³„ ì‹¤ì </h3>

<pre><code>SELECT
    t.name as ì¹˜ë£Œì‚¬,
    COUNT(*) as ì¹˜ë£Œê±´ìˆ˜,
    SUM(b.total_amount) as ë§¤ì¶œ
FROM treatment_sessions ts
JOIN therapists t ON ts.therapist_id = t.therapist_id
JOIN billings b ON ts.session_id = b.session_id
WHERE ts.session_date = '2024-03-25'
  AND ts.session_status = 'ì™„ë£Œ'
GROUP BY t.therapist_id, t.name
ORDER BY ë§¤ì¶œ DESC;</code></pre>

<h3>ë‚´ì¼ ì˜ˆì•½ ë¯¸ë¦¬ë³´ê¸°</h3>

<pre><code>SELECT
    TIME_FORMAT(ts.start_time, '%H:%i') as ì‹œê°„,
    p.name as í™˜ìëª…,
    t.name as ì¹˜ë£Œì‚¬,
    ts.notes as ë©”ëª¨
FROM treatment_sessions ts
JOIN patients p ON ts.patient_id = p.patient_id
JOIN therapists t ON ts.therapist_id = t.therapist_id
WHERE ts.session_date = '2024-03-26'
ORDER BY ts.start_time;</code></pre>

<hr>

<h2>8. ì›”ë§ ì—…ë¬´</h2>

<h3>ì´ë²ˆ ë‹¬ ë§¤ì¶œ ìš”ì•½</h3>

<pre><code>SELECT
    COUNT(DISTINCT ts.patient_id) as í™˜ììˆ˜,
    COUNT(ts.session_id) as ì´ì¹˜ë£Œê±´ìˆ˜,
    SUM(b.total_amount) as ì´ë§¤ì¶œ,
    SUM(CASE WHEN b.payment_status = 'ì™„ë£Œ' THEN b.total_amount ELSE 0 END) as ìˆ˜ë‚©ì™„ë£Œ,
    SUM(CASE WHEN b.payment_status = 'ëŒ€ê¸°' THEN b.total_amount ELSE 0 END) as ë¯¸ìˆ˜ê¸ˆ
FROM treatment_sessions ts
JOIN billings b ON ts.session_id = b.session_id
WHERE DATE_FORMAT(ts.session_date, '%Y-%m') = '2024-03';</code></pre>

<h3>ì¹˜ë£Œì‚¬ë³„ ì›”ê°„ ì‹¤ì </h3>

<pre><code>SELECT
    t.name as ì¹˜ë£Œì‚¬,
    COUNT(ts.session_id) as ì¹˜ë£Œê±´ìˆ˜,
    COUNT(DISTINCT ts.patient_id) as ë‹´ë‹¹í™˜ììˆ˜,
    SUM(b.total_amount) as ë§¤ì¶œ
FROM therapists t
LEFT JOIN treatment_sessions ts ON t.therapist_id = ts.therapist_id
    AND DATE_FORMAT(ts.session_date, '%Y-%m') = '2024-03'
    AND ts.session_status = 'ì™„ë£Œ'
LEFT JOIN billings b ON ts.session_id = b.session_id
    AND b.payment_status = 'ì™„ë£Œ'
WHERE t.is_active = 'Y'
GROUP BY t.therapist_id, t.name
ORDER BY ë§¤ì¶œ DESC;</code></pre>

<hr>

<h2>ìœ ìš©í•œ ì¿¼ë¦¬ ëª¨ìŒ</h2>

<h3>íŠ¹ì • ì§„ë‹¨ì˜ í™˜ì ëª©ë¡</h3>

<pre><code>SELECT
    p.name, p.phone, d.diagnosis_name, pd.diagnosis_date
FROM patients p
JOIN patient_diagnoses pd ON p.patient_id = pd.patient_id
JOIN diagnosis_codes d ON pd.diagnosis_code = d.diagnosis_code
WHERE d.diagnosis_code = 'M54.5'  -- ìš”í†µ
  AND pd.is_primary = 'Y'
ORDER BY pd.diagnosis_date DESC;</code></pre>

<h3>ì¹˜ë£Œ í•­ëª©ë³„ ë§¤ì¶œ</h3>

<pre><code>SELECT
    f.fee_name as í•­ëª©,
    COUNT(*) as ê±´ìˆ˜,
    SUM(b.total_amount) as ë§¤ì¶œ
FROM billings b
JOIN fee_items f ON b.fee_code = f.fee_code
JOIN treatment_sessions ts ON b.session_id = ts.session_id
WHERE DATE_FORMAT(ts.session_date, '%Y-%m') = '2024-03'
  AND b.total_amount > 0
GROUP BY f.fee_code, f.fee_name
ORDER BY ë§¤ì¶œ DESC;</code></pre>

<hr>

<h2>ì´ë²ˆ ì¥ ìš”ì•½</h2>

<p>ì´ë²ˆ ì¥ì—ì„œ ì‹¤ìŠµí•œ ê²ƒ:</p>

<ol>
<li><strong>ì•„ì¹¨ ì—…ë¬´</strong> - ì˜¤ëŠ˜ ì˜ˆì•½ í™•ì¸, ìŠ¤ì¼€ì¤„ íŒŒì•…</li>
<li><strong>í™˜ì ê´€ë¦¬</strong> - ê²€ìƒ‰, ìƒì„¸ ì¡°íšŒ, ì‹ ê·œ ë“±ë¡</li>
<li><strong>ì¹˜ë£Œ ê¸°ë¡</strong> - ì„¸ì…˜ ì…ë ¥, ì²­êµ¬ ë“±ë¡</li>
<li><strong>í˜„í™© íŒŒì•…</strong> - ë§¤ì¶œ, ë¯¸ìˆ˜ê¸ˆ í™•ì¸</li>
<li><strong>í™˜ì ê´€ë¦¬</strong> - í•´í”¼ì½œ ëŒ€ìƒ, ì´íƒˆ ìœ„í—˜</li>
<li><strong>ë§ˆê° ì—…ë¬´</strong> - ì¼ì¼/ì›”ê°„ ì‹¤ì  ì •ë¦¬</li>
</ol>

<p>ì´ ì¿¼ë¦¬ë“¤ì€ ì‹¤ì œ ì—…ë¬´ì—ì„œ ë§¤ì¼ ì‚¬ìš©í•˜ê²Œ ë  ê²ƒë“¤ì…ë‹ˆë‹¤. í•˜ì§€ë§Œ ë§¤ë²ˆ SQLì„ ì§ì ‘ ì¹˜ê¸°ëŠ” ë²ˆê±°ë¡­ì£ ? ë‹¤ìŒ íŒŒíŠ¸ì—ì„œëŠ” Metabaseë¥¼ ì‚¬ìš©í•´ì„œ í´ë¦­ í•œ ë²ˆìœ¼ë¡œ ì´ëŸ° ì •ë³´ë“¤ì„ ë³¼ ìˆ˜ ìˆëŠ” ëŒ€ì‹œë³´ë“œë¥¼ ë§Œë“­ë‹ˆë‹¤!</p>

            <div class="nav-buttons">
                <button class="nav-btn" id="prevBtn">â† ì´ì „</button>
                <span class="page-num" id="pageNum"></span>
                <button class="nav-btn" id="nextBtn">ë‹¤ìŒ â†’</button>
            </div>
        </main>
    </div>
    <script src="../js/nav.js"></script>
</body>
</html>
