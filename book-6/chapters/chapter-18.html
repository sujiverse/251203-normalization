<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[18장] 회귀분석 - 연구 데이터 설계</title>
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
    <nav class="top-nav">
        <a href="../../index.html" class="top-nav-brand"><span>📊</span> 연구 데이터 설계</a>
        <div class="top-nav-links">
            <a href="../../book-1/index.html" class="top-nav-link book-1">1권</a>
            <a href="../../book-2/index.html" class="top-nav-link book-2">2권</a>
            <a href="../../book-3/index.html" class="top-nav-link book-3">3권</a>
            <a href="../../book-4/index.html" class="top-nav-link book-4">4권</a>
            <a href="../../book-5/index.html" class="top-nav-link book-5">5권</a>
            <a href="../../book-6/index.html" class="top-nav-link book-6 active">6권</a>
        </div>
    </nav>
    <button class="menu-toggle" onclick="toggleMenu()">☰</button>
    <div class="overlay" id="overlay" onclick="toggleMenu()"></div>
    <div class="container">
        <nav class="sidebar" id="sidebar">
            <button class="close-btn" onclick="toggleMenu()">×</button>
            <div class="sidebar-header"><h1>📘 6권: 연구 데이터 설계</h1><p>변수부터 회귀분석까지</p></div>
            <ul class="nav-list" id="navList"></ul>
        </nav>
        <main class="main">
            <div class="part-header">4부: 기술통계와 추론통계</div>
            <h1 class="title">[18장] 회귀분석 (Regression)</h1>

            <div class="intro-box">
                <p>이 장에서는 <strong>회귀분석</strong>의 개념부터 단순회귀, 다중회귀, 위계적 회귀까지 배우고, 이를 위한 데이터 구조를 설계합니다.</p>
            </div>

            <hr>

            <h2>1. 회귀분석의 기초</h2>

            <div class="concept-box">
                <h3>💡 회귀분석(Regression)이란?</h3>
                <p>독립변수(예측변수)를 사용하여 <strong>종속변수(결과변수)를 예측</strong>하는 통계 기법입니다.</p>
                <p><strong>상관분석과의 차이:</strong></p>
                <ul>
                    <li><strong>상관분석</strong>: "두 변수가 관련이 있는가?" (방향 없음)</li>
                    <li><strong>회귀분석</strong>: "X로 Y를 예측할 수 있는가?" (방향 있음)</li>
                </ul>
            </div>

            <div class="concept-box">
                <h3>💡 회귀분석의 목적</h3>
                <ol>
                    <li><strong>예측</strong>: 새로운 X값에서 Y를 추정</li>
                    <li><strong>설명</strong>: X가 Y에 얼마나 영향을 미치는지 파악</li>
                    <li><strong>통제</strong>: 다른 변수의 효과를 통제하고 특정 변수의 영향 분리</li>
                </ol>
            </div>

            <div class="concept-box">
                <h3>💡 최소제곱법(OLS: Ordinary Least Squares)</h3>
                <p>회귀선을 찾는 기본 방법입니다:</p>
                <ul>
                    <li>각 관측치와 회귀선 사이의 거리(잔차)를 제곱하여 합산</li>
                    <li>이 <strong>제곱합을 최소화</strong>하는 직선을 찾음</li>
                </ul>
                <p><strong>왜 제곱하나?</strong></p>
                <ul>
                    <li>양/음의 잔차가 서로 상쇄되지 않도록</li>
                    <li>큰 오차에 더 큰 페널티 부여</li>
                </ul>
            </div>

            <div class="concept-box">
                <h3>💡 회귀분석 용어</h3>
                <div class="table-container">
                    <table>
                        <tr>
                            <th>용어</th>
                            <th>의미</th>
                            <th>예시</th>
                        </tr>
                        <tr>
                            <td><strong>종속변수 (Y)</strong></td>
                            <td>예측하고자 하는 결과</td>
                            <td>통증 점수, 낙상 발생</td>
                        </tr>
                        <tr>
                            <td><strong>독립변수 (X)</strong></td>
                            <td>예측에 사용하는 변수</td>
                            <td>나이, 균형 점수, 운동 빈도</td>
                        </tr>
                        <tr>
                            <td><strong>회귀계수 (b)</strong></td>
                            <td>X가 1 증가할 때 Y의 변화량</td>
                            <td>나이 1살 증가 → 통증 0.3점 증가</td>
                        </tr>
                        <tr>
                            <td><strong>절편 (a)</strong></td>
                            <td>X=0일 때 Y의 예측값</td>
                            <td>기준점 (해석 주의 필요)</td>
                        </tr>
                        <tr>
                            <td><strong>잔차 (e)</strong></td>
                            <td>실제값 - 예측값</td>
                            <td>모델이 설명하지 못한 부분</td>
                        </tr>
                    </table>
                </div>
            </div>

            <hr>

            <h2>2. 단순 선형 회귀</h2>

            <div class="concept-box">
                <h3>💡 단순 선형 회귀 모델</h3>
                <p>하나의 독립변수로 종속변수를 예측합니다:</p>
                <pre>Y = a + bX + e</pre>
                <ul>
                    <li><strong>a (절편, intercept)</strong>: X=0일 때 Y의 예측값</li>
                    <li><strong>b (기울기, slope)</strong>: X가 1 증가할 때 Y의 변화량</li>
                    <li><strong>e (오차)</strong>: 모델이 설명하지 못하는 부분</li>
                </ul>
            </div>

            <div class="example-box">
                <h3>📋 예시: 균형과 TUG</h3>
                <p>균형 점수(BBS)로 TUG 시간을 예측:</p>
                <pre>TUG = 25.3 - 0.28 × BBS</pre>
                <ul>
                    <li><strong>해석</strong>: BBS가 1점 증가할 때마다 TUG가 0.28초 감소</li>
                    <li>BBS=40일 때 TUG 예측값 = 25.3 - 0.28×40 = 14.1초</li>
                </ul>
            </div>

            <div class="concept-box">
                <h3>💡 결정계수 (R²)</h3>
                <p>모델이 종속변수의 변동을 <strong>얼마나 설명하는지</strong> 나타냅니다.</p>
                <p><strong>수식:</strong> R² = 1 - (잔차 제곱합 / 총 제곱합)</p>
                <p><strong>범위:</strong> 0 ≤ R² ≤ 1</p>
                <ul>
                    <li>R² = 0: 모델이 아무것도 설명 못함</li>
                    <li>R² = 1: 모델이 모든 변동을 완벽히 설명</li>
                    <li>R² = 0.52: 독립변수가 종속변수 변동의 52%를 설명</li>
                </ul>
            </div>

            <div class="sql-box">
                <h3>🔷 단순 회귀 계수 계산</h3>
                <pre><code>-- 회귀계수(기울기)와 절편 계산
WITH data AS (
    SELECT
        m1.value AS x,   -- BBS (독립변수)
        m2.value AS y    -- TUG (종속변수)
    FROM measurements m1
    JOIN measurements m2
        ON m1.participant_id = m2.participant_id
        AND m1.time_id = m2.time_id
    WHERE m1.variable_id = 1 AND m2.variable_id = 2
      AND m1.time_id = 1
      AND m1.value IS NOT NULL AND m2.value IS NOT NULL
),
stats AS (
    SELECT
        AVG(x) AS mean_x,
        AVG(y) AS mean_y,
        SUM((x - (SELECT AVG(x) FROM data)) * (y - (SELECT AVG(y) FROM data))) AS sum_xy,
        SUM((x - (SELECT AVG(x) FROM data)) * (x - (SELECT AVG(x) FROM data))) AS sum_xx,
        SUM((y - (SELECT AVG(y) FROM data)) * (y - (SELECT AVG(y) FROM data))) AS sum_yy,
        COUNT(*) AS n
    FROM data
)
SELECT
    -- 기울기 (b)
    ROUND(sum_xy / sum_xx, 4) AS slope_b,
    -- 절편 (a)
    ROUND(mean_y - (sum_xy / sum_xx) * mean_x, 4) AS intercept_a,
    -- R² (결정계수)
    ROUND((sum_xy * sum_xy) / (sum_xx * sum_yy), 4) AS r_squared,
    n
FROM stats;

-- 결과: slope=-0.28, intercept=25.3, r_squared=0.52</code></pre>
            </div>

            <div class="sql-box">
                <h3>🔷 예측값과 잔차 계산</h3>
                <pre><code>-- 각 관측치의 예측값과 잔차
WITH regression AS (
    SELECT -0.28 AS b, 25.3 AS a  -- 위에서 계산한 계수
)
SELECT
    m1.participant_id,
    m1.value AS x_bbs,
    m2.value AS y_tug_actual,
    ROUND(r.a + r.b * m1.value, 2) AS y_predicted,
    ROUND(m2.value - (r.a + r.b * m1.value), 2) AS residual
FROM measurements m1
JOIN measurements m2
    ON m1.participant_id = m2.participant_id AND m1.time_id = m2.time_id
CROSS JOIN regression r
WHERE m1.variable_id = 1 AND m2.variable_id = 2 AND m1.time_id = 1;</code></pre>
            </div>

            <hr>

            <h2>3. 다중 회귀분석</h2>

            <div class="concept-box">
                <h3>💡 다중 회귀 모델</h3>
                <p><strong>여러 개의 독립변수</strong>로 종속변수를 예측합니다:</p>
                <pre>Y = a + b₁X₁ + b₂X₂ + b₃X₃ + ... + e</pre>
                <p><strong>장점:</strong></p>
                <ul>
                    <li>더 많은 정보를 활용하여 예측력 향상</li>
                    <li>다른 변수를 <strong>통제</strong>한 상태에서 특정 변수의 효과 파악</li>
                </ul>
            </div>

            <div class="example-box">
                <h3>📋 예시: TUG 예측 다중 회귀</h3>
                <pre>TUG = 15.2 - 0.22×BBS + 0.08×나이 + 1.5×통증</pre>
                <p><strong>해석:</strong></p>
                <ul>
                    <li>나이와 통증을 통제한 상태에서, BBS 1점 증가 → TUG 0.22초 감소</li>
                    <li>BBS와 통증을 통제한 상태에서, 나이 1세 증가 → TUG 0.08초 증가</li>
                    <li>BBS와 나이를 통제한 상태에서, 통증 1점 증가 → TUG 1.5초 증가</li>
                </ul>
            </div>

            <div class="concept-box">
                <h3>💡 표준화 회귀계수 (β, Beta)</h3>
                <p>변수들의 <strong>상대적 중요도</strong>를 비교하기 위해 표준화된 계수입니다.</p>
                <p><strong>비표준화 계수 (b)</strong>: 원래 단위 사용, 해석 용이</p>
                <p><strong>표준화 계수 (β)</strong>: 모든 변수를 z점수로 변환, 비교 가능</p>
                <div class="table-container">
                    <table>
                        <tr>
                            <th>변수</th>
                            <th>b (비표준화)</th>
                            <th>β (표준화)</th>
                        </tr>
                        <tr><td>BBS</td><td>-0.22</td><td><strong>-0.52</strong></td></tr>
                        <tr><td>나이</td><td>0.08</td><td>0.18</td></tr>
                        <tr><td>통증</td><td>1.50</td><td>0.31</td></tr>
                    </table>
                </div>
                <p><strong>해석:</strong> |β|가 가장 큰 BBS가 TUG에 가장 큰 영향</p>
            </div>

            <div class="warning-box">
                <h3>⚠️ 다중공선성(Multicollinearity)</h3>
                <p>독립변수들 간에 <strong>높은 상관관계</strong>가 있을 때 발생하는 문제입니다.</p>
                <p><strong>문제점:</strong></p>
                <ul>
                    <li>회귀계수 추정이 불안정해짐</li>
                    <li>표준오차가 커짐 → 유의성 검정 신뢰도 저하</li>
                    <li>개별 변수의 효과를 분리하기 어려움</li>
                </ul>
                <p><strong>진단:</strong> VIF (분산팽창지수)</p>
                <ul>
                    <li>VIF &lt; 5: 문제 없음</li>
                    <li>VIF 5~10: 주의</li>
                    <li>VIF &gt; 10: 심각한 다중공선성</li>
                </ul>
                <p><strong>해결:</strong> 상관 높은 변수 중 하나 제거, 변수 결합, 요인분석</p>
            </div>

            <div class="sql-box">
                <h3>🔷 다중 회귀용 Wide 형식 데이터</h3>
                <pre><code>-- 다중 회귀를 위한 Wide 형식 데이터 뷰
CREATE VIEW v_regression_data AS
SELECT
    p.participant_id,
    p.age,
    p.sex,
    MAX(CASE WHEN m.variable_id = 1 THEN m.value END) AS bbs,
    MAX(CASE WHEN m.variable_id = 2 THEN m.value END) AS tug,
    MAX(CASE WHEN m.variable_id = 3 THEN m.value END) AS pain
FROM participants p
LEFT JOIN measurements m
    ON p.participant_id = m.participant_id
    AND m.time_id = 1  -- baseline
GROUP BY p.participant_id, p.age, p.sex;

-- 사용
SELECT * FROM v_regression_data
WHERE bbs IS NOT NULL AND tug IS NOT NULL AND pain IS NOT NULL;</code></pre>
            </div>

            <hr>

            <h2>4. 위계적 회귀분석</h2>

            <div class="concept-box">
                <h3>💡 위계적 회귀분석이란?</h3>
                <p>변수를 <strong>단계별로 투입</strong>하여 각 단계의 설명력 증가를 확인하는 방법입니다.</p>
                <p><strong>목적:</strong></p>
                <ul>
                    <li>통제변수의 효과를 먼저 제거한 후 관심 변수의 추가 설명력 확인</li>
                    <li>변수 집합의 상대적 중요도 비교</li>
                    <li>이론에 기반한 순차적 검증</li>
                </ul>
            </div>

            <div class="example-box">
                <h3>📋 예시: 낙상 두려움 예측</h3>
                <p><strong>연구 질문:</strong> 균형이 낙상 두려움을 예측하는가? (인구통계 변수 통제 후)</p>
                <div class="table-container">
                    <table>
                        <tr>
                            <th>단계</th>
                            <th>투입 변수</th>
                            <th>R²</th>
                            <th>ΔR²</th>
                            <th>p (ΔR²)</th>
                        </tr>
                        <tr>
                            <td><strong>1단계</strong></td>
                            <td>나이, 성별</td>
                            <td>0.15</td>
                            <td>0.15</td>
                            <td>.02</td>
                        </tr>
                        <tr>
                            <td><strong>2단계</strong></td>
                            <td>+ 낙상 경험</td>
                            <td>0.28</td>
                            <td>0.13</td>
                            <td>.01</td>
                        </tr>
                        <tr>
                            <td><strong>3단계</strong></td>
                            <td>+ BBS</td>
                            <td>0.42</td>
                            <td><strong>0.14</strong></td>
                            <td><strong>&lt;.001</strong></td>
                        </tr>
                    </table>
                </div>
                <p><strong>결론:</strong> 인구통계와 낙상 경험을 통제한 후에도, BBS는 낙상 두려움의 추가적인 14%를 설명 (p&lt;.001)</p>
            </div>

            <div class="concept-box">
                <h3>💡 ΔR² (R² 변화량)</h3>
                <p>새 변수를 추가했을 때 <strong>설명력이 얼마나 증가</strong>했는지 나타냅니다.</p>
                <p><strong>수식:</strong> ΔR² = R²(새 모델) - R²(이전 모델)</p>
                <p><strong>통계적 유의성:</strong> F 변화량 검정으로 ΔR²가 우연인지 판단</p>
            </div>

            <div class="sql-box">
                <h3>🔷 위계적 회귀 결과 저장</h3>
                <pre><code>-- 모델 정보 테이블
CREATE TABLE regression_models (
    model_id INTEGER PRIMARY KEY,
    model_name TEXT NOT NULL,
    dependent_var TEXT NOT NULL,
    model_step INTEGER,              -- 위계적 회귀의 단계
    parent_model_id INTEGER,         -- 이전 단계 모델
    r_squared REAL,
    adj_r_squared REAL,
    delta_r_squared REAL,            -- R² 변화량
    f_statistic REAL,
    f_pvalue REAL,
    delta_f_pvalue REAL,             -- F 변화량 p값
    n INTEGER,
    analysis_date DATE DEFAULT CURRENT_DATE,
    FOREIGN KEY (parent_model_id) REFERENCES regression_models(model_id)
);

-- 샘플 데이터
INSERT INTO regression_models VALUES
(1, 'Model 1: Demographics', 'fall_fear', 1, NULL, 0.15, 0.12, 0.15, 4.2, 0.02, 0.02, 50, '2024-03-15'),
(2, 'Model 2: + Fall History', 'fall_fear', 2, 1, 0.28, 0.24, 0.13, 5.8, 0.005, 0.01, 50, '2024-03-15'),
(3, 'Model 3: + Balance', 'fall_fear', 3, 2, 0.42, 0.37, 0.14, 8.1, 0.001, 0.001, 50, '2024-03-15');</code></pre>
            </div>

            <hr>

            <h2>5. 회귀분석의 가정</h2>

            <div class="concept-box">
                <h3>💡 회귀분석의 기본 가정</h3>
                <ol>
                    <li><strong>선형성 (Linearity)</strong>: X와 Y의 관계가 직선</li>
                    <li><strong>정규성 (Normality)</strong>: 잔차가 정규분포</li>
                    <li><strong>등분산성 (Homoscedasticity)</strong>: 잔차의 분산이 일정</li>
                    <li><strong>독립성 (Independence)</strong>: 잔차들이 서로 독립적</li>
                    <li><strong>무상관 오차 (No autocorrelation)</strong>: 연속된 잔차가 상관 없음</li>
                </ol>
            </div>

            <div class="concept-box">
                <h3>💡 가정 진단 방법</h3>
                <div class="table-container">
                    <table>
                        <tr>
                            <th>가정</th>
                            <th>진단 방법</th>
                            <th>위반 시 패턴</th>
                        </tr>
                        <tr>
                            <td>선형성</td>
                            <td>잔차 vs 예측값 산점도</td>
                            <td>곡선 패턴</td>
                        </tr>
                        <tr>
                            <td>정규성</td>
                            <td>잔차 히스토그램, Q-Q plot</td>
                            <td>비대칭, 꼬리 두꺼움</td>
                        </tr>
                        <tr>
                            <td>등분산성</td>
                            <td>잔차 vs 예측값 산점도</td>
                            <td>깔때기 모양</td>
                        </tr>
                        <tr>
                            <td>독립성</td>
                            <td>Durbin-Watson 검정</td>
                            <td>DW ≠ 2 (자기상관)</td>
                        </tr>
                    </table>
                </div>
            </div>

            <div class="warning-box">
                <h3>⚠️ 가정 위반 시 대처</h3>
                <div class="table-container">
                    <table>
                        <tr>
                            <th>위반 가정</th>
                            <th>대처 방법</th>
                        </tr>
                        <tr>
                            <td>비선형 관계</td>
                            <td>변수 변환 (로그, 제곱근), 다항 회귀</td>
                        </tr>
                        <tr>
                            <td>잔차 비정규</td>
                            <td>종속변수 변환, 이상치 검토</td>
                        </tr>
                        <tr>
                            <td>이분산성</td>
                            <td>가중 최소제곱(WLS), 로버스트 표준오차</td>
                        </tr>
                        <tr>
                            <td>자기상관</td>
                            <td>시계열 분석, GLS</td>
                        </tr>
                        <tr>
                            <td>다중공선성</td>
                            <td>변수 제거, 릿지/라쏘 회귀</td>
                        </tr>
                    </table>
                </div>
            </div>

            <div class="sql-box">
                <h3>🔷 잔차 진단용 데이터</h3>
                <pre><code>-- 잔차 분석용 테이블
CREATE TABLE residual_diagnostics (
    diag_id INTEGER PRIMARY KEY,
    model_id INTEGER NOT NULL,
    participant_id INTEGER NOT NULL,
    y_actual REAL,
    y_predicted REAL,
    residual REAL,               -- y_actual - y_predicted
    std_residual REAL,           -- 표준화 잔차
    leverage REAL,               -- 레버리지 (hat value)
    cooks_d REAL,                -- Cook's Distance
    FOREIGN KEY (model_id) REFERENCES regression_models(model_id),
    FOREIGN KEY (participant_id) REFERENCES participants(participant_id)
);

-- 이상치 탐지 쿼리
SELECT
    participant_id,
    y_actual,
    y_predicted,
    residual,
    std_residual,
    cooks_d,
    CASE
        WHEN ABS(std_residual) > 3 THEN 'Outlier (>3SD)'
        WHEN ABS(std_residual) > 2 THEN 'Potential Outlier (>2SD)'
        ELSE 'Normal'
    END AS outlier_status,
    CASE
        WHEN cooks_d > 4.0 / (SELECT n FROM regression_models WHERE model_id = 1) THEN 'Influential'
        ELSE 'Not Influential'
    END AS influence_status
FROM residual_diagnostics
WHERE model_id = 1
ORDER BY ABS(std_residual) DESC;</code></pre>
            </div>

            <hr>

            <h2>6. 회귀분석을 위한 DB 설계</h2>

            <div class="example-box">
                <h3>📋 회귀분석 결과 저장 시스템</h3>
                <p>모델 정보, 계수, 진단 결과를 체계적으로 저장합니다.</p>
            </div>

            <div class="sql-box">
                <h3>🔷 완전한 회귀분석 스키마</h3>
                <pre><code>-- ========================================
-- 회귀분석 결과 데이터베이스
-- ========================================

-- 1. 회귀 모델 정보
CREATE TABLE regression_models (
    model_id INTEGER PRIMARY KEY,
    model_name TEXT NOT NULL,
    model_type TEXT DEFAULT 'linear',  -- linear, logistic, hierarchical
    dependent_var TEXT NOT NULL,
    model_step INTEGER,
    parent_model_id INTEGER,
    -- 모델 적합도
    r_squared REAL,
    adj_r_squared REAL,
    delta_r_squared REAL,
    -- F 검정
    f_statistic REAL,
    df1 INTEGER,
    df2 INTEGER,
    f_pvalue REAL,
    delta_f_pvalue REAL,
    -- 기타
    n INTEGER,
    k INTEGER,                   -- 독립변수 개수
    aic REAL,                    -- 모델 비교용
    bic REAL,
    rmse REAL,                   -- Root Mean Square Error
    analysis_date DATE DEFAULT CURRENT_DATE,
    notes TEXT,
    FOREIGN KEY (parent_model_id) REFERENCES regression_models(model_id)
);

-- 2. 회귀 계수
CREATE TABLE regression_coefficients (
    coef_id INTEGER PRIMARY KEY,
    model_id INTEGER NOT NULL,
    variable_name TEXT NOT NULL,
    variable_order INTEGER,       -- 투입 순서
    -- 비표준화 계수
    b_unstd REAL NOT NULL,        -- 비표준화 회귀계수
    se_b REAL,                    -- 표준오차
    -- 표준화 계수
    beta_std REAL,                -- 표준화 회귀계수
    -- 유의성
    t_value REAL,
    p_value REAL,
    -- 신뢰구간
    ci_lower_95 REAL,
    ci_upper_95 REAL,
    -- 다중공선성
    vif REAL,
    tolerance REAL,
    FOREIGN KEY (model_id) REFERENCES regression_models(model_id)
);

-- 3. 모델 비교
CREATE TABLE model_comparisons (
    comparison_id INTEGER PRIMARY KEY,
    model1_id INTEGER NOT NULL,
    model2_id INTEGER NOT NULL,
    comparison_type TEXT,         -- 'hierarchical', 'alternative'
    delta_r_squared REAL,
    f_change REAL,
    df1_change INTEGER,
    df2_change INTEGER,
    p_change REAL,
    preferred_model INTEGER,      -- 선호 모델 ID
    FOREIGN KEY (model1_id) REFERENCES regression_models(model_id),
    FOREIGN KEY (model2_id) REFERENCES regression_models(model_id)
);</code></pre>
            </div>

            <div class="sql-box">
                <h3>🔷 샘플 데이터 및 조회</h3>
                <pre><code>-- 계수 저장
INSERT INTO regression_coefficients
    (model_id, variable_name, variable_order, b_unstd, se_b, beta_std, t_value, p_value, vif)
VALUES
    (3, '(Intercept)', 0, 45.2, 5.1, NULL, 8.86, 0.001, NULL),
    (3, 'age', 1, 0.15, 0.06, 0.18, 2.50, 0.016, 1.2),
    (3, 'sex', 2, 2.3, 1.5, 0.11, 1.53, 0.132, 1.1),
    (3, 'fall_history', 3, 4.8, 1.2, 0.28, 4.00, 0.001, 1.3),
    (3, 'bbs', 4, -0.42, 0.08, -0.38, -5.25, 0.001, 1.4);

-- 논문용 테이블 출력
SELECT
    variable_name AS "Variable",
    ROUND(b_unstd, 3) AS "B",
    ROUND(se_b, 3) AS "SE",
    ROUND(beta_std, 3) AS "β",
    ROUND(t_value, 2) AS "t",
    CASE
        WHEN p_value < 0.001 THEN '<.001***'
        WHEN p_value < 0.01 THEN ROUND(p_value, 3) || '**'
        WHEN p_value < 0.05 THEN ROUND(p_value, 3) || '*'
        ELSE ROUND(p_value, 3) || ''
    END AS "p",
    ROUND(vif, 2) AS "VIF"
FROM regression_coefficients
WHERE model_id = 3
ORDER BY variable_order;</code></pre>
            </div>

            <div class="sql-box">
                <h3>🔷 위계적 회귀 결과 보고서</h3>
                <pre><code>-- 위계적 회귀 요약 테이블
SELECT
    rm.model_step AS "Step",
    rm.model_name AS "Model",
    ROUND(rm.r_squared, 3) AS "R²",
    ROUND(rm.delta_r_squared, 3) AS "ΔR²",
    ROUND(rm.f_statistic, 2) AS "F",
    CASE
        WHEN rm.delta_f_pvalue < 0.001 THEN '<.001'
        ELSE ROUND(rm.delta_f_pvalue, 3)
    END AS "p (ΔR²)",
    -- 해당 단계에서 추가된 유의한 변수
    (SELECT GROUP_CONCAT(variable_name, ', ')
     FROM regression_coefficients
     WHERE model_id = rm.model_id
       AND p_value < 0.05
       AND variable_name != '(Intercept)') AS "Significant Predictors"
FROM regression_models rm
WHERE rm.dependent_var = 'fall_fear'
ORDER BY rm.model_step;</code></pre>
            </div>

            <div class="concept-box">
                <h3>💡 회귀분석 유형 선택</h3>
                <div class="table-container">
                    <table>
                        <tr>
                            <th>종속변수 유형</th>
                            <th>회귀분석 유형</th>
                        </tr>
                        <tr>
                            <td>연속형</td>
                            <td>선형 회귀 (Linear Regression)</td>
                        </tr>
                        <tr>
                            <td>이분형 (0/1)</td>
                            <td>로지스틱 회귀 (Logistic Regression)</td>
                        </tr>
                        <tr>
                            <td>순서형</td>
                            <td>순서 로지스틱 회귀 (Ordinal Logistic)</td>
                        </tr>
                        <tr>
                            <td>빈도(count)</td>
                            <td>포아송 회귀 (Poisson Regression)</td>
                        </tr>
                        <tr>
                            <td>반복측정</td>
                            <td>혼합효과 모델 (Mixed Effects)</td>
                        </tr>
                    </table>
                </div>
            </div>

            <div class="summary-box">
                <h3>📝 이 장의 핵심 정리</h3>
                <ol>
                    <li><strong>회귀분석</strong>: 독립변수로 종속변수를 예측하는 모델 (Y = a + bX)</li>
                    <li><strong>R²</strong>: 모델의 설명력 (0~1), 높을수록 좋음</li>
                    <li><strong>다중 회귀</strong>: 여러 독립변수, β로 상대적 중요도 비교</li>
                    <li><strong>위계적 회귀</strong>: 단계별 투입, ΔR²로 추가 설명력 확인</li>
                    <li><strong>가정</strong>: 선형성, 정규성, 등분산성, 독립성 확인 필수</li>
                    <li><strong>다중공선성</strong>: VIF > 10이면 문제, 변수 조정 필요</li>
                </ol>
            </div>

            <div class="nav-buttons">
                <a href="chapter-17.html" class="nav-btn">← 이전</a>
                <span class="page-num">18 / 20</span>
                <a href="chapter-19.html" class="nav-btn">다음 →</a>
            </div>
        </main>
    </div>
    <script src="../js/nav.js"></script>
</body>
</html>