<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[13ì¥] ì„¤ë¬¸ ì—°êµ¬ - ì—°êµ¬ ë°ì´í„° ì„¤ê³„</title>
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
    <nav class="top-nav">
        <a href="../../index.html" class="top-nav-brand"><span>ğŸ“Š</span> ì—°êµ¬ ë°ì´í„° ì„¤ê³„</a>
        <div class="top-nav-links">
            <a href="../../book-1/index.html" class="top-nav-link book-1">1ê¶Œ</a>
            <a href="../../book-2/index.html" class="top-nav-link book-2">2ê¶Œ</a>
            <a href="../../book-3/index.html" class="top-nav-link book-3">3ê¶Œ</a>
            <a href="../../book-4/index.html" class="top-nav-link book-4">4ê¶Œ</a>
            <a href="../../book-5/index.html" class="top-nav-link book-5">5ê¶Œ</a>
            <a href="../../book-6/index.html" class="top-nav-link book-6 active">6ê¶Œ</a>
        </div>
    </nav>
    <button class="menu-toggle" onclick="toggleMenu()">â˜°</button>
    <div class="overlay" id="overlay" onclick="toggleMenu()"></div>
    <div class="container">
        <nav class="sidebar" id="sidebar">
            <button class="close-btn" onclick="toggleMenu()">Ã—</button>
            <div class="sidebar-header"><h1>ğŸ“˜ 6ê¶Œ: ì—°êµ¬ ë°ì´í„° ì„¤ê³„</h1><p>ë³€ìˆ˜ë¶€í„° íšŒê·€ë¶„ì„ê¹Œì§€</p></div>
            <ul class="nav-list" id="navList"></ul>
        </nav>
        <main class="main">
            <div class="part-header">3ë¶€: ì—°êµ¬ í˜•íƒœë³„ DB ì„¤ê³„</div>
            <h1 class="title">[13ì¥] ì„¤ë¬¸ ì—°êµ¬ (Survey)</h1>

            <div class="intro-box">
                <p>ì´ ì¥ì—ì„œëŠ” <strong>ì„¤ë¬¸ì¡°ì‚¬ ë°ì´í„°</strong>ì˜ DB ì„¤ê³„ë¥¼ ë°°ì›ë‹ˆë‹¤. ë¬¸í•­ ì •ê·œí™”, ë¦¬ì»¤íŠ¸ ì²™ë„, ì¡°ê±´ ë¶„ê¸° ë“± ì„¤ë¬¸ íŠ¹ìœ ì˜ ë¬¸ì œë¥¼ ë‹¤ë£¹ë‹ˆë‹¤.</p>
            </div>

            <hr>

            <h2>1. ì„¤ë¬¸ ë¬¸í•­ ì •ê·œí™”</h2>

            <div class="concept-box">
                <h3>ğŸ’¡ 1ì°¸ê°€ì = 1í–‰ì˜ í•œê³„</h3>
                <p>ë§ì€ ì—°êµ¬ìê°€ ì„¤ë¬¸ ë°ì´í„°ë¥¼ "Wide í˜•ì‹"ìœ¼ë¡œ ì €ì¥í•©ë‹ˆë‹¤:</p>
                <pre>participant_id | q1 | q2 | q3 | q4 | ... | q50</pre>
                <p>ì´ ë°©ì‹ì˜ <strong>ë¬¸ì œì </strong>:</p>
                <ul>
                    <li><strong>ì—´ ìˆ˜ í­ë°œ</strong>: 50ë¬¸í•­ ì„¤ë¬¸ì´ 5ê°œë©´ ì—´ì´ 250ê°œ</li>
                    <li><strong>ìœ ì—°ì„± ë¶€ì¡±</strong>: ë¬¸í•­ ì¶”ê°€/ì‚­ì œ ì‹œ í…Œì´ë¸” êµ¬ì¡° ë³€ê²½ í•„ìš”</li>
                    <li><strong>ë©”íƒ€ë°ì´í„° ëˆ„ë½</strong>: ê° ë¬¸í•­ì˜ ìœ í˜•, ì²™ë„, í•˜ìœ„ì²™ë„ ì •ë³´ë¥¼ ì €ì¥í•  ê³³ì´ ì—†ìŒ</li>
                    <li><strong>ì¿¼ë¦¬ ë³µì¡</strong>: "ëª¨ë“  ë¬¸í•­ì˜ í‰ê· "ì„ êµ¬í•˜ë ¤ë©´ ì—´ ì´ë¦„ì„ ëª¨ë‘ ë‚˜ì—´í•´ì•¼ í•¨</li>
                </ul>
            </div>

            <div class="concept-box">
                <h3>ğŸ’¡ ì •ê·œí™”ëœ ì„¤ë¬¸ êµ¬ì¡°</h3>
                <p>ë¬¸í•­ì„ <strong>í–‰(row)</strong>ìœ¼ë¡œ ë¶„ë¦¬í•˜ë©´ ìœ ì—°ì„±ì´ ë†’ì•„ì§‘ë‹ˆë‹¤:</p>
                <div class="table-container">
                    <table>
                        <tr>
                            <th colspan="3" style="text-align: center;">questions í…Œì´ë¸”</th>
                        </tr>
                        <tr>
                            <th>question_id</th>
                            <th>question_text</th>
                            <th>scale_type</th>
                        </tr>
                        <tr><td>1</td><td>í—ˆë¦¬ í†µì¦ìœ¼ë¡œ ì¼ìƒìƒí™œì´ ì–´ë µë‹¤</td><td>likert_5</td></tr>
                        <tr><td>2</td><td>í†µì¦ìœ¼ë¡œ ìˆ˜ë©´ì— ë°©í•´ë¥¼ ë°›ëŠ”ë‹¤</td><td>likert_5</td></tr>
                        <tr><td>3</td><td>ì£¼ë‹¹ ìš´ë™ íšŸìˆ˜ëŠ”?</td><td>numeric</td></tr>
                    </table>
                </div>
                <div class="table-container" style="margin-top: 1rem;">
                    <table>
                        <tr>
                            <th colspan="3" style="text-align: center;">responses í…Œì´ë¸”</th>
                        </tr>
                        <tr>
                            <th>participant_id</th>
                            <th>question_id</th>
                            <th>response_value</th>
                        </tr>
                        <tr><td>1</td><td>1</td><td>4</td></tr>
                        <tr><td>1</td><td>2</td><td>3</td></tr>
                        <tr><td>1</td><td>3</td><td>2</td></tr>
                        <tr><td>2</td><td>1</td><td>2</td></tr>
                        <tr><td>2</td><td>2</td><td>2</td></tr>
                        <tr><td>2</td><td>3</td><td>5</td></tr>
                    </table>
                </div>
            </div>

            <div class="sql-box">
                <h3>ğŸ”· ì •ê·œí™”ëœ ì„¤ë¬¸ í…Œì´ë¸” ìƒì„±</h3>
                <pre><code>-- ì„¤ë¬¸ì§€ ì •ë³´
CREATE TABLE surveys (
    survey_id INTEGER PRIMARY KEY,
    survey_name TEXT NOT NULL,
    survey_version TEXT,
    created_date DATE DEFAULT CURRENT_DATE
);

-- ë¬¸í•­ ì •ë³´
CREATE TABLE questions (
    question_id INTEGER PRIMARY KEY,
    survey_id INTEGER NOT NULL,
    question_order INTEGER NOT NULL,
    question_text TEXT NOT NULL,
    scale_type TEXT NOT NULL,  -- likert_5, likert_7, numeric, text, binary
    subscale_name TEXT,        -- í•˜ìœ„ì²™ë„ ì†Œì†
    is_reverse_coded INTEGER DEFAULT 0,
    FOREIGN KEY (survey_id) REFERENCES surveys(survey_id)
);

-- ì‘ë‹µ ë°ì´í„°
CREATE TABLE responses (
    response_id INTEGER PRIMARY KEY,
    participant_id INTEGER NOT NULL,
    question_id INTEGER NOT NULL,
    response_value TEXT,       -- ìˆ«ì/í…ìŠ¤íŠ¸ ëª¨ë‘ ì €ì¥ ê°€ëŠ¥
    response_date DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (participant_id) REFERENCES participants(participant_id),
    FOREIGN KEY (question_id) REFERENCES questions(question_id),
    UNIQUE(participant_id, question_id)  -- ì¤‘ë³µ ì‘ë‹µ ë°©ì§€
);</code></pre>
            </div>

            <hr>

            <h2>2. ë¦¬ì»¤íŠ¸ ì²™ë„ ì €ì¥</h2>

            <div class="concept-box">
                <h3>ğŸ’¡ ë¦¬ì»¤íŠ¸ ì²™ë„(Likert Scale)ë€</h3>
                <p>1932ë…„ Rensis Likertê°€ ê°œë°œí•œ íƒœë„ ì¸¡ì • ì²™ë„ì…ë‹ˆë‹¤. ì‘ë‹µìê°€ ì§„ìˆ ë¬¸ì— ëŒ€í•œ ë™ì˜ ì •ë„ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.</p>
                <p><strong>ì¼ë°˜ì ì¸ ìœ í˜•:</strong></p>
                <div class="table-container">
                    <table>
                        <tr>
                            <th>ì²™ë„</th>
                            <th>ì•µì»¤ í¬ì¸íŠ¸</th>
                            <th>ì‚¬ìš© ì˜ˆ</th>
                        </tr>
                        <tr>
                            <td><strong>5ì  ì²™ë„</strong></td>
                            <td>1=ì „í˜€ ì•„ë‹ˆë‹¤ ~ 5=ë§¤ìš° ê·¸ë ‡ë‹¤</td>
                            <td>ê°€ì¥ í”í•¨, ODI, KOOS ë“±</td>
                        </tr>
                        <tr>
                            <td><strong>7ì  ì²™ë„</strong></td>
                            <td>1=ì „í˜€ ì•„ë‹ˆë‹¤ ~ 7=ë§¤ìš° ê·¸ë ‡ë‹¤</td>
                            <td>ë” ì„¸ë°€í•œ êµ¬ë¶„ í•„ìš” ì‹œ</td>
                        </tr>
                        <tr>
                            <td><strong>4ì  ì²™ë„</strong></td>
                            <td>1=ì „í˜€ ì•„ë‹ˆë‹¤ ~ 4=ë§¤ìš° ê·¸ë ‡ë‹¤</td>
                            <td>ì¤‘ë¦½ ì‘ë‹µ ë°°ì œí•  ë•Œ</td>
                        </tr>
                        <tr>
                            <td><strong>11ì  NRS</strong></td>
                            <td>0=ì—†ìŒ ~ 10=ìµœì•…</td>
                            <td>í†µì¦ ê°•ë„ (NRS)</td>
                        </tr>
                    </table>
                </div>
            </div>

            <div class="warning-box">
                <h3>âš ï¸ ìˆ«ìë¡œ ì €ì¥í•˜ë¼</h3>
                <p>ë¦¬ì»¤íŠ¸ ì‘ë‹µì€ ë°˜ë“œì‹œ <strong>ìˆ«ì</strong>ë¡œ ì €ì¥í•©ë‹ˆë‹¤:</p>
                <ul>
                    <li><span class="emoji">âŒ</span> "ë§¤ìš° ê·¸ë ‡ë‹¤", "ê·¸ë ‡ë‹¤", "ë³´í†µì´ë‹¤"... (í…ìŠ¤íŠ¸)</li>
                    <li><span class="emoji">âœ…</span> 5, 4, 3, 2, 1 (ìˆ«ì)</li>
                </ul>
                <p><strong>ì´ìœ :</strong> í‰ê· , í•©ê³„, í‘œì¤€í¸ì°¨ ë“± í†µê³„ ê³„ì‚°ì´ ë°”ë¡œ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
            </div>

            <div class="sql-box">
                <h3>ğŸ”· ì•µì»¤ ë ˆì´ë¸” ê´€ë¦¬</h3>
                <p>ìˆ«ìì™€ ë ˆì´ë¸”ì˜ ë§¤í•‘ì€ ë³„ë„ í…Œì´ë¸”ë¡œ ê´€ë¦¬í•©ë‹ˆë‹¤:</p>
                <pre><code>-- ì²™ë„ ìœ í˜• ì •ì˜
CREATE TABLE scale_types (
    scale_type_id TEXT PRIMARY KEY,
    scale_name TEXT NOT NULL,
    min_value INTEGER NOT NULL,
    max_value INTEGER NOT NULL
);

-- ê° ê°’ì˜ ë ˆì´ë¸”
CREATE TABLE scale_labels (
    scale_type_id TEXT NOT NULL,
    value INTEGER NOT NULL,
    label_ko TEXT NOT NULL,
    label_en TEXT,
    PRIMARY KEY (scale_type_id, value),
    FOREIGN KEY (scale_type_id) REFERENCES scale_types(scale_type_id)
);

-- ë°ì´í„° ì‚½ì…
INSERT INTO scale_types VALUES ('likert_5', '5ì  ë¦¬ì»¤íŠ¸', 1, 5);
INSERT INTO scale_types VALUES ('likert_7', '7ì  ë¦¬ì»¤íŠ¸', 1, 7);
INSERT INTO scale_types VALUES ('nrs_11', '11ì  NRS', 0, 10);

INSERT INTO scale_labels VALUES ('likert_5', 1, 'ì „í˜€ ì•„ë‹ˆë‹¤', 'Strongly disagree');
INSERT INTO scale_labels VALUES ('likert_5', 2, 'ì•„ë‹ˆë‹¤', 'Disagree');
INSERT INTO scale_labels VALUES ('likert_5', 3, 'ë³´í†µì´ë‹¤', 'Neutral');
INSERT INTO scale_labels VALUES ('likert_5', 4, 'ê·¸ë ‡ë‹¤', 'Agree');
INSERT INTO scale_labels VALUES ('likert_5', 5, 'ë§¤ìš° ê·¸ë ‡ë‹¤', 'Strongly agree');</code></pre>
            </div>

            <div class="sql-box">
                <h3>ğŸ”· ë ˆì´ë¸” í¬í•¨ ì‘ë‹µ ì¡°íšŒ</h3>
                <pre><code>SELECT
    r.participant_id,
    q.question_text,
    CAST(r.response_value AS INTEGER) AS score,
    sl.label_ko AS response_label
FROM responses r
JOIN questions q ON r.question_id = q.question_id
JOIN scale_labels sl
    ON q.scale_type = sl.scale_type_id
    AND CAST(r.response_value AS INTEGER) = sl.value
WHERE r.participant_id = 1;</code></pre>
                <div class="table-container">
                    <table>
                        <tr>
                            <th>participant_id</th>
                            <th>question_text</th>
                            <th>score</th>
                            <th>response_label</th>
                        </tr>
                        <tr><td>1</td><td>í—ˆë¦¬ í†µì¦ìœ¼ë¡œ ì¼ìƒìƒí™œì´ ì–´ë µë‹¤</td><td>4</td><td>ê·¸ë ‡ë‹¤</td></tr>
                        <tr><td>1</td><td>í†µì¦ìœ¼ë¡œ ìˆ˜ë©´ì— ë°©í•´ë¥¼ ë°›ëŠ”ë‹¤</td><td>3</td><td>ë³´í†µì´ë‹¤</td></tr>
                    </table>
                </div>
            </div>

            <hr>

            <h2>3. ì¡°ê±´ ë¶„ê¸° ë¬¸í•­</h2>

            <div class="concept-box">
                <h3>ğŸ’¡ Skip Logic (ê±´ë„ˆë›°ê¸° ë¡œì§)</h3>
                <p>íŠ¹ì • ì¡°ê±´ì— ë”°ë¼ í›„ì† ë¬¸í•­ì„ ê±´ë„ˆë›°ëŠ” ë¡œì§ì…ë‹ˆë‹¤.</p>
                <p><strong>ì˜ˆì‹œ:</strong></p>
                <ul>
                    <li>Q1: "ì§€ë‚œ 1ë…„ê°„ ë‚™ìƒ ê²½í—˜ì´ ìˆìŠµë‹ˆê¹Œ?" â†’ "ì•„ë‹ˆì˜¤" ì„ íƒ ì‹œ Q2-Q5 ê±´ë„ˆëœ€</li>
                    <li>Q10: "í˜„ì¬ í†µì¦ì´ ìˆìŠµë‹ˆê¹Œ?" â†’ "ì—†ìŒ" ì„ íƒ ì‹œ í†µì¦ ê´€ë ¨ ë¬¸í•­ ê±´ë„ˆëœ€</li>
                </ul>
            </div>

            <div class="sql-box">
                <h3>ğŸ”· ë¶„ê¸° ì¡°ê±´ í…Œì´ë¸”</h3>
                <pre><code>-- ë¬¸í•­ ê°„ ë¶„ê¸° ì¡°ê±´
CREATE TABLE skip_logic (
    skip_id INTEGER PRIMARY KEY,
    trigger_question_id INTEGER NOT NULL,   -- ë¶„ê¸°ë¥¼ ë°œìƒì‹œí‚¤ëŠ” ë¬¸í•­
    trigger_value TEXT NOT NULL,            -- ì´ ê°’ì¼ ë•Œ ê±´ë„ˆëœ€
    skip_to_question_id INTEGER,            -- ê±´ë„ˆë›¸ ëª©í‘œ ë¬¸í•­ (NULLì´ë©´ ì„¤ë¬¸ ì¢…ë£Œ)
    FOREIGN KEY (trigger_question_id) REFERENCES questions(question_id),
    FOREIGN KEY (skip_to_question_id) REFERENCES questions(question_id)
);

-- ì˜ˆ: Q1ì—ì„œ "0"(ì•„ë‹ˆì˜¤)ë¥¼ ì„ íƒí•˜ë©´ Q6ë¡œ ê±´ë„ˆëœ€
INSERT INTO skip_logic (trigger_question_id, trigger_value, skip_to_question_id)
VALUES (1, '0', 6);</code></pre>
            </div>

            <div class="warning-box">
                <h3>âš ï¸ "í•´ë‹¹ ì—†ìŒ" vs "ê²°ì¸¡" êµ¬ë¶„</h3>
                <p>Skip Logicìœ¼ë¡œ ê±´ë„ˆë›´ ë¬¸í•­ì€ <strong>"í•´ë‹¹ ì—†ìŒ(Not Applicable)"</strong>ì´ì§€, <strong>"ê²°ì¸¡(Missing)"</strong>ì´ ì•„ë‹™ë‹ˆë‹¤.</p>
                <div class="table-container">
                    <table>
                        <tr>
                            <th>ìƒí™©</th>
                            <th>ì˜ë¯¸</th>
                            <th>ì €ì¥ ë°©ì‹</th>
                        </tr>
                        <tr>
                            <td>Skip Logicìœ¼ë¡œ ê±´ë„ˆëœ€</td>
                            <td>í•´ë‹¹ ì—†ìŒ (ë…¼ë¦¬ì ìœ¼ë¡œ ë‹µí•  ìˆ˜ ì—†ìŒ)</td>
                            <td>response_value = 'NA' ë˜ëŠ” ë³„ë„ í”Œë˜ê·¸</td>
                        </tr>
                        <tr>
                            <td>ì‘ë‹µìê°€ ë‹µí•˜ì§€ ì•ŠìŒ</td>
                            <td>ê²°ì¸¡ (ë‹µí•´ì•¼ í•˜ì§€ë§Œ ì•ˆ í•¨)</td>
                            <td>response_value = NULL</td>
                        </tr>
                        <tr>
                            <td>"ì‘ë‹µ ê±°ë¶€" ì„ íƒ</td>
                            <td>ê±°ë¶€ (ì˜ë„ì  ë¯¸ì‘ë‹µ)</td>
                            <td>response_value = 'REFUSED'</td>
                        </tr>
                    </table>
                </div>
            </div>

            <div class="sql-box">
                <h3>ğŸ”· ì‘ë‹µ ìƒíƒœ ì¶”ì </h3>
                <pre><code>-- ì‘ë‹µ í…Œì´ë¸”ì— ìƒíƒœ í•„ë“œ ì¶”ê°€
CREATE TABLE responses (
    response_id INTEGER PRIMARY KEY,
    participant_id INTEGER NOT NULL,
    question_id INTEGER NOT NULL,
    response_value TEXT,
    response_status TEXT DEFAULT 'answered',  -- answered, skipped, refused, missing
    skip_reason TEXT,  -- 'skip_logic', 'not_applicable', etc.
    FOREIGN KEY (participant_id) REFERENCES participants(participant_id),
    FOREIGN KEY (question_id) REFERENCES questions(question_id)
);

-- ê±´ë„ˆë›´ ë¬¸í•­ ê¸°ë¡
INSERT INTO responses (participant_id, question_id, response_value, response_status, skip_reason)
VALUES (1, 3, NULL, 'skipped', 'skip_logic');</code></pre>
            </div>

            <hr>

            <h2>4. ë§¤íŠ¸ë¦­ìŠ¤ ë¬¸í•­</h2>

            <div class="concept-box">
                <h3>ğŸ’¡ ë§¤íŠ¸ë¦­ìŠ¤(ê·¸ë¦¬ë“œ) ë¬¸í•­ì´ë€</h3>
                <p>ì—¬ëŸ¬ í•­ëª©ì— ëŒ€í•´ ë™ì¼í•œ ì²™ë„ë¡œ ì‘ë‹µí•˜ëŠ” í˜•íƒœì…ë‹ˆë‹¤:</p>
                <div class="table-container">
                    <table>
                        <tr>
                            <th>í•­ëª©</th>
                            <th>ì „í˜€<br>ì•„ë‹ˆë‹¤</th>
                            <th>ì•„ë‹ˆë‹¤</th>
                            <th>ë³´í†µ</th>
                            <th>ê·¸ë ‡ë‹¤</th>
                            <th>ë§¤ìš°<br>ê·¸ë ‡ë‹¤</th>
                        </tr>
                        <tr>
                            <td>ê±·ê¸°</td>
                            <td>â—‹</td>
                            <td>â—‹</td>
                            <td>â—</td>
                            <td>â—‹</td>
                            <td>â—‹</td>
                        </tr>
                        <tr>
                            <td>ê³„ë‹¨ ì˜¤ë¥´ê¸°</td>
                            <td>â—‹</td>
                            <td>â—‹</td>
                            <td>â—‹</td>
                            <td>â—</td>
                            <td>â—‹</td>
                        </tr>
                        <tr>
                            <td>ì•‰ì•˜ë‹¤ ì¼ì–´ì„œê¸°</td>
                            <td>â—‹</td>
                            <td>â—</td>
                            <td>â—‹</td>
                            <td>â—‹</td>
                            <td>â—‹</td>
                        </tr>
                    </table>
                </div>
            </div>

            <div class="concept-box">
                <h3>ğŸ’¡ ë§¤íŠ¸ë¦­ìŠ¤ ë¬¸í•­ ì €ì¥ ì „ëµ</h3>
                <p>ê° ì…€(í–‰-ì—´ ì¡°í•©)ì„ <strong>ê°œë³„ ë¬¸í•­</strong>ìœ¼ë¡œ ì·¨ê¸‰í•©ë‹ˆë‹¤:</p>
                <div class="table-container">
                    <table>
                        <tr>
                            <th>question_id</th>
                            <th>matrix_group</th>
                            <th>row_label</th>
                            <th>question_text</th>
                        </tr>
                        <tr><td>10</td><td>daily_activity</td><td>walking</td><td>ê±·ê¸°ì— ì–´ë ¤ì›€ì´ ìˆë‹¤</td></tr>
                        <tr><td>11</td><td>daily_activity</td><td>stairs</td><td>ê³„ë‹¨ ì˜¤ë¥´ê¸°ì— ì–´ë ¤ì›€ì´ ìˆë‹¤</td></tr>
                        <tr><td>12</td><td>daily_activity</td><td>sit_stand</td><td>ì•‰ì•˜ë‹¤ ì¼ì–´ì„œê¸°ì— ì–´ë ¤ì›€ì´ ìˆë‹¤</td></tr>
                    </table>
                </div>
                <p><code>matrix_group</code>ìœ¼ë¡œ ê°™ì€ ê·¸ë¦¬ë“œì— ì†í•œ ë¬¸í•­ë“¤ì„ ë¬¶ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
            </div>

            <div class="sql-box">
                <h3>ğŸ”· ë§¤íŠ¸ë¦­ìŠ¤ ë¬¸í•­ ìŠ¤í‚¤ë§ˆ</h3>
                <pre><code>CREATE TABLE questions (
    question_id INTEGER PRIMARY KEY,
    survey_id INTEGER NOT NULL,
    question_order INTEGER NOT NULL,
    question_text TEXT NOT NULL,
    scale_type TEXT NOT NULL,
    -- ë§¤íŠ¸ë¦­ìŠ¤ ê´€ë ¨ í•„ë“œ
    matrix_group TEXT,          -- ê°™ì€ ë§¤íŠ¸ë¦­ìŠ¤ì— ì†í•œ ë¬¸í•­ ê·¸ë£¹
    matrix_row_order INTEGER,   -- ë§¤íŠ¸ë¦­ìŠ¤ ë‚´ í–‰ ìˆœì„œ
    matrix_row_label TEXT,      -- í–‰ ë ˆì´ë¸”
    subscale_name TEXT,
    is_reverse_coded INTEGER DEFAULT 0,
    FOREIGN KEY (survey_id) REFERENCES surveys(survey_id)
);

-- ë§¤íŠ¸ë¦­ìŠ¤ ê·¸ë£¹ë³„ í•©ê³„ ì¡°íšŒ
SELECT
    p.participant_id,
    q.matrix_group,
    SUM(CAST(r.response_value AS INTEGER)) AS matrix_total
FROM responses r
JOIN questions q ON r.question_id = q.question_id
JOIN participants p ON r.participant_id = p.participant_id
WHERE q.matrix_group IS NOT NULL
GROUP BY p.participant_id, q.matrix_group;</code></pre>
            </div>

            <hr>

            <h2>5. ê°œë°©í˜• ë¬¸í•­</h2>

            <div class="concept-box">
                <h3>ğŸ’¡ ê°œë°©í˜•(Open-ended) ë¬¸í•­</h3>
                <p>ì‘ë‹µìê°€ ììœ ë¡­ê²Œ í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ëŠ” ë¬¸í•­ì…ë‹ˆë‹¤:</p>
                <ul>
                    <li><strong>ì™„ì „ ê°œë°©í˜•</strong>: "ì¹˜ë£Œì— ëŒ€í•œ ì˜ê²¬ì„ ììœ ë¡­ê²Œ ì‘ì„±í•´ì£¼ì„¸ìš”"</li>
                    <li><strong>ë°˜ê°œë°©í˜•</strong>: "ê¸°íƒ€: ___________" (ì„ íƒì§€ + í…ìŠ¤íŠ¸)</li>
                    <li><strong>ìˆ«ì ì…ë ¥</strong>: "ë‚˜ì´ë¥¼ ì…ë ¥í•˜ì„¸ìš”: ___ì„¸"</li>
                </ul>
            </div>

            <div class="sql-box">
                <h3>ğŸ”· í…ìŠ¤íŠ¸ ì‘ë‹µ ì €ì¥</h3>
                <pre><code>-- response_valueëŠ” TEXT íƒ€ì…ì´ë¯€ë¡œ ê¸´ ì‘ë‹µë„ ì €ì¥ ê°€ëŠ¥
INSERT INTO responses (participant_id, question_id, response_value)
VALUES (1, 25, 'ë¬¼ë¦¬ì¹˜ë£Œ í›„ í†µì¦ì´ ë§ì´ ì¤„ì—ˆìŠµë‹ˆë‹¤. íŠ¹íˆ ìŠ¤íŠ¸ë ˆì¹­ì„ ë°°ìš´ ê²ƒì´ ë„ì›€ì´ ë˜ì—ˆì–´ìš”.');

-- í…ìŠ¤íŠ¸ ì‘ë‹µë§Œ ì¡°íšŒ
SELECT
    r.participant_id,
    q.question_text,
    r.response_value AS text_response
FROM responses r
JOIN questions q ON r.question_id = q.question_id
WHERE q.scale_type = 'text'
AND r.response_value IS NOT NULL
AND LENGTH(r.response_value) > 0;</code></pre>
            </div>

            <div class="concept-box">
                <h3>ğŸ’¡ í…ìŠ¤íŠ¸ ì‘ë‹µì˜ ì½”ë”©(Coding)</h3>
                <p>ê°œë°©í˜• ì‘ë‹µì€ ë¶„ì„ì„ ìœ„í•´ ë²”ì£¼í™”(ì½”ë”©)í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:</p>
                <div class="table-container">
                    <table>
                        <tr>
                            <th>ì›ë³¸ ì‘ë‹µ</th>
                            <th>ì½”ë“œ</th>
                            <th>ë²”ì£¼</th>
                        </tr>
                        <tr>
                            <td>"í†µì¦ì´ ì¤„ì—ˆì–´ìš”"</td>
                            <td>1</td>
                            <td>ê¸ì •ì  íš¨ê³¼</td>
                        </tr>
                        <tr>
                            <td>"ë³„ íš¨ê³¼ ì—†ì—ˆìŠµë‹ˆë‹¤"</td>
                            <td>2</td>
                            <td>íš¨ê³¼ ì—†ìŒ</td>
                        </tr>
                        <tr>
                            <td>"ì˜¤íˆë ¤ ë” ì•„íŒ ì–´ìš”"</td>
                            <td>3</td>
                            <td>ë¶€ì •ì  íš¨ê³¼</td>
                        </tr>
                    </table>
                </div>
            </div>

            <div class="sql-box">
                <h3>ğŸ”· ì½”ë”© ê²°ê³¼ ì €ì¥</h3>
                <pre><code>-- ì½”ë”© ì¹´í…Œê³ ë¦¬ ì •ì˜
CREATE TABLE coding_categories (
    category_id INTEGER PRIMARY KEY,
    question_id INTEGER NOT NULL,
    code INTEGER NOT NULL,
    category_name TEXT NOT NULL,
    category_description TEXT,
    FOREIGN KEY (question_id) REFERENCES questions(question_id)
);

-- ì½”ë”© ê²°ê³¼ ì €ì¥
CREATE TABLE response_codes (
    coding_id INTEGER PRIMARY KEY,
    response_id INTEGER NOT NULL,
    category_id INTEGER NOT NULL,
    coder_id INTEGER,           -- ëˆ„ê°€ ì½”ë”©í–ˆëŠ”ì§€
    coding_date DATE,
    FOREIGN KEY (response_id) REFERENCES responses(response_id),
    FOREIGN KEY (category_id) REFERENCES coding_categories(category_id)
);

-- í•œ ì‘ë‹µì— ì—¬ëŸ¬ ì½”ë“œ ë¶€ì—¬ ê°€ëŠ¥ (ë‹¤ì¤‘ ì½”ë”©)
INSERT INTO response_codes (response_id, category_id, coder_id, coding_date)
VALUES
    (100, 1, 1, '2024-03-15'),  -- ê¸ì •ì  íš¨ê³¼
    (100, 5, 1, '2024-03-15');  -- ìŠ¤íŠ¸ë ˆì¹­ ì–¸ê¸‰</code></pre>
            </div>

            <hr>

            <h2>6. ì„¤ë¬¸ DB ì„¤ê³„ ì˜ˆì‹œ</h2>

            <div class="example-box">
                <h3>ğŸ“‹ ì˜ˆì‹œ: í™˜ì ë§Œì¡±ë„ ì¡°ì‚¬ DB</h3>
                <p>ë¬¼ë¦¬ì¹˜ë£Œì‹¤ í™˜ì ë§Œì¡±ë„ ì¡°ì‚¬ë¥¼ ìœ„í•œ ì™„ì „í•œ ìŠ¤í‚¤ë§ˆì…ë‹ˆë‹¤.</p>
            </div>

            <div class="sql-box">
                <h3>ğŸ”· ì™„ì „í•œ ìŠ¤í‚¤ë§ˆ</h3>
                <pre><code>-- ========================================
-- í™˜ì ë§Œì¡±ë„ ì¡°ì‚¬ ë°ì´í„°ë² ì´ìŠ¤
-- ========================================

-- 1. ì„¤ë¬¸ì§€ ì •ë³´
CREATE TABLE surveys (
    survey_id INTEGER PRIMARY KEY,
    survey_name TEXT NOT NULL,
    survey_name_en TEXT,
    version TEXT DEFAULT '1.0',
    description TEXT,
    created_date DATE DEFAULT CURRENT_DATE,
    is_active INTEGER DEFAULT 1
);

-- 2. ì²™ë„ ìœ í˜•
CREATE TABLE scale_types (
    scale_type_id TEXT PRIMARY KEY,
    scale_name TEXT NOT NULL,
    min_value INTEGER NOT NULL,
    max_value INTEGER NOT NULL,
    description TEXT
);

-- 3. ì²™ë„ ë ˆì´ë¸”
CREATE TABLE scale_labels (
    scale_type_id TEXT NOT NULL,
    value INTEGER NOT NULL,
    label_ko TEXT NOT NULL,
    label_en TEXT,
    PRIMARY KEY (scale_type_id, value),
    FOREIGN KEY (scale_type_id) REFERENCES scale_types(scale_type_id)
);

-- 4. í•˜ìœ„ì²™ë„ ì •ì˜
CREATE TABLE subscales (
    subscale_id INTEGER PRIMARY KEY,
    survey_id INTEGER NOT NULL,
    subscale_name TEXT NOT NULL,
    subscale_name_en TEXT,
    description TEXT,
    scoring_method TEXT DEFAULT 'mean',  -- sum, mean
    FOREIGN KEY (survey_id) REFERENCES surveys(survey_id)
);

-- 5. ë¬¸í•­
CREATE TABLE questions (
    question_id INTEGER PRIMARY KEY,
    survey_id INTEGER NOT NULL,
    subscale_id INTEGER,
    question_order INTEGER NOT NULL,
    question_text TEXT NOT NULL,
    question_text_en TEXT,
    scale_type TEXT NOT NULL,
    is_required INTEGER DEFAULT 1,
    is_reverse_coded INTEGER DEFAULT 0,
    matrix_group TEXT,
    matrix_row_order INTEGER,
    FOREIGN KEY (survey_id) REFERENCES surveys(survey_id),
    FOREIGN KEY (subscale_id) REFERENCES subscales(subscale_id),
    FOREIGN KEY (scale_type) REFERENCES scale_types(scale_type_id)
);

-- 6. ì„ íƒì§€ (ê°ê´€ì‹ ë¬¸í•­ìš©)
CREATE TABLE question_options (
    option_id INTEGER PRIMARY KEY,
    question_id INTEGER NOT NULL,
    option_order INTEGER NOT NULL,
    option_value TEXT NOT NULL,
    option_label TEXT NOT NULL,
    FOREIGN KEY (question_id) REFERENCES questions(question_id)
);

-- 7. ë¶„ê¸° ë¡œì§
CREATE TABLE skip_logic (
    skip_id INTEGER PRIMARY KEY,
    trigger_question_id INTEGER NOT NULL,
    trigger_operator TEXT DEFAULT '=',  -- =, !=, <, >, IN
    trigger_value TEXT NOT NULL,
    skip_to_question_id INTEGER,
    FOREIGN KEY (trigger_question_id) REFERENCES questions(question_id),
    FOREIGN KEY (skip_to_question_id) REFERENCES questions(question_id)
);

-- 8. ì°¸ê°€ì
CREATE TABLE participants (
    participant_id INTEGER PRIMARY KEY,
    participant_code TEXT UNIQUE NOT NULL,
    age INTEGER,
    sex TEXT CHECK(sex IN ('M', 'F')),
    diagnosis TEXT,
    treatment_count INTEGER,
    enrollment_date DATE DEFAULT CURRENT_DATE
);

-- 9. ì„¤ë¬¸ ì„¸ì…˜ (ì°¸ê°€ìê°€ ì„¤ë¬¸ì„ ì™„ë£Œí•œ ë‹¨ìœ„)
CREATE TABLE survey_sessions (
    session_id INTEGER PRIMARY KEY,
    participant_id INTEGER NOT NULL,
    survey_id INTEGER NOT NULL,
    start_time DATETIME,
    end_time DATETIME,
    completion_status TEXT DEFAULT 'incomplete',  -- incomplete, complete, abandoned
    FOREIGN KEY (participant_id) REFERENCES participants(participant_id),
    FOREIGN KEY (survey_id) REFERENCES surveys(survey_id)
);

-- 10. ì‘ë‹µ
CREATE TABLE responses (
    response_id INTEGER PRIMARY KEY,
    session_id INTEGER NOT NULL,
    question_id INTEGER NOT NULL,
    response_value TEXT,
    response_status TEXT DEFAULT 'answered',  -- answered, skipped, refused
    response_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (session_id) REFERENCES survey_sessions(session_id),
    FOREIGN KEY (question_id) REFERENCES questions(question_id),
    UNIQUE(session_id, question_id)
);</code></pre>
            </div>

            <div class="sql-box">
                <h3>ğŸ”· ìƒ˜í”Œ ë°ì´í„°</h3>
                <pre><code>-- ì„¤ë¬¸ì§€
INSERT INTO surveys (survey_id, survey_name, survey_name_en, description)
VALUES (1, 'í™˜ì ë§Œì¡±ë„ ì¡°ì‚¬', 'Patient Satisfaction Survey', 'ë¬¼ë¦¬ì¹˜ë£Œ ì„œë¹„ìŠ¤ ë§Œì¡±ë„ í‰ê°€');

-- ì²™ë„
INSERT INTO scale_types VALUES ('likert_5', '5ì  ë¦¬ì»¤íŠ¸', 1, 5, 'ë™ì˜ ì •ë„');
INSERT INTO scale_types VALUES ('nrs_11', '11ì  NRS', 0, 10, 'í†µì¦/ë§Œì¡± ê°•ë„');

-- í•˜ìœ„ì²™ë„
INSERT INTO subscales (subscale_id, survey_id, subscale_name, scoring_method)
VALUES
    (1, 1, 'ì¹˜ë£Œ í’ˆì§ˆ', 'mean'),
    (2, 1, 'ì‹œì„¤ í™˜ê²½', 'mean'),
    (3, 1, 'ì§ì› ì¹œì ˆë„', 'mean');

-- ë¬¸í•­
INSERT INTO questions (question_id, survey_id, subscale_id, question_order, question_text, scale_type)
VALUES
    (1, 1, 1, 1, 'ì¹˜ë£Œì‚¬ì˜ ì„¤ëª…ì´ ì´í•´í•˜ê¸° ì‰¬ì› ë‹¤', 'likert_5'),
    (2, 1, 1, 2, 'ì¹˜ë£Œê°€ íš¨ê³¼ì ì´ì—ˆë‹¤', 'likert_5'),
    (3, 1, 2, 3, 'ì¹˜ë£Œì‹¤ì´ ì²­ê²°í–ˆë‹¤', 'likert_5'),
    (4, 1, 2, 4, 'ëŒ€ê¸° ì‹œê°„ì´ ì ì ˆí–ˆë‹¤', 'likert_5'),
    (5, 1, 3, 5, 'ì§ì›ë“¤ì´ ì¹œì ˆí–ˆë‹¤', 'likert_5'),
    (6, 1, NULL, 6, 'ì „ë°˜ì ì¸ ë§Œì¡±ë„ (0-10)', 'nrs_11'),
    (7, 1, NULL, 7, 'ê°œì„ ì´ í•„ìš”í•œ ì ì´ ìˆë‹¤ë©´ ì‘ì„±í•´ì£¼ì„¸ìš”', 'text');</code></pre>
            </div>

            <div class="sql-box">
                <h3>ğŸ”· í•˜ìœ„ì²™ë„ë³„ ì ìˆ˜ ê³„ì‚°</h3>
                <pre><code>-- í•˜ìœ„ì²™ë„ë³„ í‰ê·  ì ìˆ˜ ê³„ì‚°
SELECT
    ss.session_id,
    p.participant_code,
    sub.subscale_name,
    ROUND(AVG(CAST(r.response_value AS REAL)), 2) AS subscale_mean,
    COUNT(r.response_id) AS item_count
FROM survey_sessions ss
JOIN participants p ON ss.participant_id = p.participant_id
JOIN responses r ON ss.session_id = r.session_id
JOIN questions q ON r.question_id = q.question_id
JOIN subscales sub ON q.subscale_id = sub.subscale_id
WHERE r.response_status = 'answered'
  AND q.scale_type = 'likert_5'
GROUP BY ss.session_id, p.participant_code, sub.subscale_name;

-- ê²°ê³¼ ì˜ˆì‹œ:
-- session_id | participant_code | subscale_name | subscale_mean | item_count
-- 1          | PT001           | ì¹˜ë£Œ í’ˆì§ˆ      | 4.50          | 2
-- 1          | PT001           | ì‹œì„¤ í™˜ê²½      | 4.00          | 2
-- 1          | PT001           | ì§ì› ì¹œì ˆë„    | 5.00          | 1</code></pre>
            </div>

            <div class="sql-box">
                <h3>ğŸ”· ì„¤ë¬¸ ì™„ë£Œìœ¨ ë¶„ì„</h3>
                <pre><code>-- ë¬¸í•­ë³„ ì‘ë‹µë¥ 
SELECT
    q.question_id,
    q.question_text,
    COUNT(r.response_id) AS response_count,
    SUM(CASE WHEN r.response_status = 'answered' THEN 1 ELSE 0 END) AS answered_count,
    ROUND(100.0 * SUM(CASE WHEN r.response_status = 'answered' THEN 1 ELSE 0 END)
        / COUNT(r.response_id), 1) AS response_rate_pct
FROM questions q
LEFT JOIN responses r ON q.question_id = r.question_id
WHERE q.survey_id = 1
GROUP BY q.question_id, q.question_text
ORDER BY q.question_order;</code></pre>
            </div>

            <div class="summary-box">
                <h3>ğŸ“ ì´ ì¥ì˜ í•µì‹¬ ì •ë¦¬</h3>
                <ol>
                    <li><strong>ì •ê·œí™”</strong>: ë¬¸í•­ì„ ì—´ì´ ì•„ë‹Œ í–‰ìœ¼ë¡œ ë¶„ë¦¬í•˜ë©´ ìœ ì—°ì„± ë†’ì€ ì„¤ê³„ ê°€ëŠ¥</li>
                    <li><strong>ë¦¬ì»¤íŠ¸ ì €ì¥</strong>: ë°˜ë“œì‹œ ìˆ«ìë¡œ ì €ì¥, ë ˆì´ë¸”ì€ ë³„ë„ í…Œì´ë¸”ë¡œ ê´€ë¦¬</li>
                    <li><strong>Skip Logic</strong>: ë¶„ê¸° ì¡°ê±´ì„ í…Œì´ë¸”ë¡œ ê´€ë¦¬, "í•´ë‹¹ ì—†ìŒ"ê³¼ "ê²°ì¸¡" êµ¬ë¶„</li>
                    <li><strong>ë§¤íŠ¸ë¦­ìŠ¤</strong>: ê° ì…€ì„ ê°œë³„ ë¬¸í•­ìœ¼ë¡œ ì·¨ê¸‰, matrix_groupìœ¼ë¡œ ë¬¶ìŒ</li>
                    <li><strong>ê°œë°©í˜•</strong>: TEXT íƒ€ì… ì €ì¥, í•„ìš”ì‹œ ì½”ë”©(ë²”ì£¼í™”) í…Œì´ë¸” ì¶”ê°€</li>
                    <li><strong>êµ¬ì¡°</strong>: surveys â†’ questions â†’ responses 3ê³„ì¸µì´ ê¸°ë³¸</li>
                </ol>
            </div>

            <div class="nav-buttons">
                <a href="chapter-12.html" class="nav-btn">â† ì´ì „</a>
                <span class="page-num">13 / 20</span>
                <a href="chapter-14.html" class="nav-btn">ë‹¤ìŒ â†’</a>
            </div>
        </main>
    </div>
    <script src="../js/nav.js"></script>
</body>
</html>