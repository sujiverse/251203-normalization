<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>10μ¥: λ―Όκ° λ°μ΄ν„° μ•”νΈν™” - λ¬Όλ¦¬μΉλ£μ‚¬λ¥Ό μ„ν• DB 5κ¶</title>
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
    @@include('components/top-nav.html', {"root": "../..", "activeBook": "5"})

    @@include('components/mobile-menu.html')

    <div class="container">
        <nav class="sidebar" id="sidebar">
            <button class="close-btn" onclick="toggleMenu()">Γ—</button>
            <div class="sidebar-header">
                <h1>π›΅οΈ 5κ¶: λ³΄μ• νΈ</h1>
                <p>DB & μ„λ²„ λ³΄μ•</p>
            </div>
            <ul class="nav-list" id="navList"></ul>
        </nav>

        <main class="main">
            <h1 class="title">λ―Όκ° λ°μ΄ν„° μ•”νΈν™”</h1>

            <h2>μ•”νΈν™”κ°€ ν•„μ”ν• λ°μ΄ν„°</h2>

            <pre class="file-tree">νλ§μ† λ―Όκ° λ°μ΄ν„°
β”‚
β”β”€β”€ κ°μΈμ •λ³΄
β”‚   β”β”€β”€ μ£Όλ―Όλ“±λ΅λ²νΈ
β”‚   β”β”€β”€ ν΄λ€ν° λ²νΈ
β”‚   β””β”€β”€ μ£Όμ†
β”‚
β”β”€β”€ μλ£μ •λ³΄
β”‚   β”β”€β”€ μ§„λ‹¨ λ‚΄μ—­
β”‚   β””β”€β”€ μ²λ°© κΈ°λ΅
β”‚
β””β”€β”€ κ²°μ μ •λ³΄
    β”β”€β”€ μΉ΄λ“λ²νΈ
    β””β”€β”€ κ³„μΆλ²νΈ</pre>

            <blockquote>
                DBκ°€ μ μ¶λλ”λΌλ„ μ•”νΈν™”λ λ°μ΄ν„°λ” μ½μ„ μ μ—†μµλ‹λ‹¤.
            </blockquote>

            <hr>

            <h2>μ•”νΈν™” μΆ…λ¥</h2>

            <table>
                <tr>
                    <th>κµ¬λ¶„</th>
                    <th>λ€μΉ­ν‚¤ (AES)</th>
                    <th>λΉ„λ€μΉ­ν‚¤ (RSA)</th>
                </tr>
                <tr>
                    <td>ν‚¤</td>
                    <td>μ•”νΈν™”/λ³µνΈν™” κ°™μ€ ν‚¤</td>
                    <td>κ³µκ°ν‚¤/κ°μΈν‚¤ μ</td>
                </tr>
                <tr>
                    <td>μ†λ„</td>
                    <td>λΉ λ¦„</td>
                    <td>λλ¦Ό</td>
                </tr>
                <tr>
                    <td>μ©λ„</td>
                    <td>λ€μ©λ‰ λ°μ΄ν„°</td>
                    <td>μ‘μ€ λ°μ΄ν„°, ν‚¤ κµν™</td>
                </tr>
            </table>

            <p>DB μΉΌλΌ μ•”νΈν™”μ—λ” μ£Όλ΅ <strong>AES (λ€μΉ­ν‚¤)</strong>λ¥Ό μ‚¬μ©ν•©λ‹λ‹¤.</p>

            <hr>

            <h2>Pythonμ—μ„ AES μ•”νΈν™”</h2>

            <pre><code>from cryptography.fernet import Fernet
import base64
import os

# ν‚¤ μƒμ„± (ν• λ²λ§ μ‹¤ν–‰, μ•μ „ν•κ² μ €μ¥)
def generate_key():
    return Fernet.generate_key()

# ν™κ²½λ³€μμ—μ„ ν‚¤ λ΅λ“
ENCRYPTION_KEY = os.environ.get('ENCRYPTION_KEY')
cipher = Fernet(ENCRYPTION_KEY)

def encrypt(plaintext):
    """λ¬Έμμ—΄ μ•”νΈν™”"""
    if plaintext is None:
        return None
    return cipher.encrypt(plaintext.encode()).decode()

def decrypt(ciphertext):
    """λ¬Έμμ—΄ λ³µνΈν™”"""
    if ciphertext is None:
        return None
    return cipher.decrypt(ciphertext.encode()).decode()

# μ‚¬μ© μμ‹
phone = "010-1234-5678"
encrypted_phone = encrypt(phone)
print(encrypted_phone)  # gAAAAABhX... (μ•μ•„λ³Ό μ μ—†λ” λ¬Έμμ—΄)

decrypted_phone = decrypt(encrypted_phone)
print(decrypted_phone)  # 010-1234-5678</code></pre>

            <hr>

            <h2>μ•”νΈν™” ν‚¤ κ΄€λ¦¬</h2>

            <div class="danger">
                <strong>μ¤‘μ”!</strong><br>
                μ•”νΈν™” ν‚¤λ” μ λ€ μ½”λ“μ— ν•λ“μ½”λ”©ν•μ§€ λ§μ„Έμ”!
            </div>

            <pre><code># β μ„ν—: μ½”λ“μ— ν‚¤ ν•λ“μ½”λ”©
ENCRYPTION_KEY = b'my-secret-key-12345'

# β… μ•μ „: ν™κ²½λ³€μ μ‚¬μ©
import os
ENCRYPTION_KEY = os.environ.get('ENCRYPTION_KEY')

# β… μ•μ „: λ³„λ„ μ„¤μ • νμΌ (κ¶ν• μ ν•)
# /etc/healing-hands/secrets.env
# chmod 600 secrets.env</code></pre>

            <h3>ν‚¤ μ €μ¥ μµμ…</h3>
            <pre class="file-tree">ν‚¤ κ΄€λ¦¬ λ°©λ²•
β”‚
β”β”€β”€ ν™κ²½λ³€μ
β”‚   β””β”€β”€ μ„λ²„ μ¬μ‹μ‘ μ‹ μ„¤μ • ν•„μ”
β”‚
β”β”€β”€ λΉ„λ°€ κ΄€λ¦¬ μ„λΉ„μ¤
β”‚   β”β”€β”€ AWS Secrets Manager
β”‚   β”β”€β”€ HashiCorp Vault
β”‚   β””β”€β”€ Azure Key Vault
β”‚
β””β”€β”€ HSM (Hardware Security Module)
    β””β”€β”€ λ€κΈ°μ—…, κΈμµκ¶ μ‚¬μ©</pre>

            <hr>

            <h2>ν™μ μ •λ³΄ μ•”νΈν™” μ €μ¥</h2>

            <pre><code>class PatientService:
    def create_patient(self, data):
        """ν™μ μ •λ³΄ μ•”νΈν™” ν›„ μ €μ¥"""
        cursor = self.conn.cursor()

        query = """
            INSERT INTO patients
            (patient_id, name, phone_encrypted, address_encrypted)
            VALUES (%s, %s, %s, %s)
        """

        cursor.execute(query, (
            data['patient_id'],
            data['name'],  # μ΄λ¦„μ€ κ²€μƒ‰μ©μΌλ΅ ν‰λ¬Έ μ €μ¥
            encrypt(data['phone']),     # μ „ν™”λ²νΈ μ•”νΈν™”
            encrypt(data['address'])    # μ£Όμ† μ•”νΈν™”
        ))

        self.conn.commit()

    def get_patient(self, patient_id):
        """ν™μ μ •λ³΄ λ³µνΈν™” ν›„ λ°ν™"""
        cursor = self.conn.cursor(dictionary=True)

        cursor.execute(
            "SELECT * FROM patients WHERE patient_id = %s",
            (patient_id,)
        )

        patient = cursor.fetchone()

        if patient:
            # λ³µνΈν™”
            patient['phone'] = decrypt(patient['phone_encrypted'])
            patient['address'] = decrypt(patient['address_encrypted'])
            del patient['phone_encrypted']
            del patient['address_encrypted']

        return patient</code></pre>

            <hr>

            <h2>ν…μ΄λΈ” μ„¤κ³„</h2>

            <pre><code>CREATE TABLE patients (
    patient_id VARCHAR(10) PRIMARY KEY,
    name VARCHAR(30) NOT NULL,               -- κ²€μƒ‰μ© ν‰λ¬Έ
    name_search VARCHAR(64),                 -- κ²€μƒ‰μ© ν•΄μ‹ (μ„ νƒ)
    phone_encrypted VARCHAR(255),            -- μ•”νΈν™”λ μ „ν™”λ²νΈ
    address_encrypted TEXT,                  -- μ•”νΈν™”λ μ£Όμ†
    insurance_code_encrypted VARCHAR(255),   -- μ•”νΈν™”λ λ³΄ν—μ •λ³΄
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);</code></pre>

            <hr>

            <h2>MySQL λ‚΄μ¥ μ•”νΈν™” ν•¨μ</h2>

            <p>MySQL μμ²΄ μ•”νΈν™” ν•¨μλ„ μ‚¬μ©ν•  μ μμµλ‹λ‹¤.</p>

            <pre><code>-- μ•”νΈν™” (AES)
INSERT INTO patients (patient_id, phone_encrypted)
VALUES ('P001', AES_ENCRYPT('010-1234-5678', 'encryption_key'));

-- λ³µνΈν™”
SELECT patient_id,
       CAST(AES_DECRYPT(phone_encrypted, 'encryption_key') AS CHAR) as phone
FROM patients;

-- μ°Έκ³ : ν‚¤λ¥Ό SQLμ— μ§μ ‘ λ„£λ” κ²ƒμ€ λ³΄μ•μƒ μΆ‹μ§€ μ•μµλ‹λ‹¤.
-- μ•± λ λ²¨ μ•”νΈν™”λ¥Ό κ¶μ¥ν•©λ‹λ‹¤.</code></pre>

            <hr>

            <h2>μ•”νΈν™”λ λ°μ΄ν„° κ²€μƒ‰</h2>

            <p>μ•”νΈν™”λ μΉΌλΌμ€ μ§μ ‘ κ²€μƒ‰ν•  μ μ—†μµλ‹λ‹¤. ν•΄κ²° λ°©λ²•:</p>

            <h3>1. λΈ”λΌμΈλ“ μΈλ±μ¤</h3>
            <pre><code>import hashlib

def create_search_hash(value):
    """κ²€μƒ‰μ© ν•΄μ‹ μƒμ„±"""
    # μ†”νΈ + κ°’μ„ ν•΄μ‹
    salted = f"search_salt_{value}"
    return hashlib.sha256(salted.encode()).hexdigest()

# μ €μ¥ μ‹
phone_hash = create_search_hash("010-1234-5678")
cursor.execute("""
    INSERT INTO patients (patient_id, phone_encrypted, phone_hash)
    VALUES (%s, %s, %s)
""", (patient_id, encrypt(phone), phone_hash))

# κ²€μƒ‰ μ‹
search_hash = create_search_hash("010-1234-5678")
cursor.execute("""
    SELECT * FROM patients WHERE phone_hash = %s
""", (search_hash,))</code></pre>

            <h3>2. λ¶€λ¶„ ν‰λ¬Έ μ €μ¥</h3>
            <pre><code># μ „ν™”λ²νΈ λ’¤ 4μλ¦¬λ§ ν‰λ¬ΈμΌλ΅ μ €μ¥ (κ²€μƒ‰μ©)
phone = "010-1234-5678"
phone_last4 = phone[-4:]  # "5678"
phone_encrypted = encrypt(phone)

# κ²€μƒ‰ μ‹ λ’¤ 4μλ¦¬λ΅ ν•„ν„°λ§ ν›„ λ³µνΈν™”ν•΄μ„ ν™•μΈ</code></pre>

            <hr>

            <h2>μ „μ†΅ κµ¬κ°„ μ•”νΈν™” (TLS)</h2>

            <pre><code># MySQL μ—°κ²° μ‹ TLS μ‚¬μ©
import mysql.connector

conn = mysql.connector.connect(
    host='db-server.com',
    user='healing_app',
    password='password',
    database='healing_hands',
    ssl_ca='/path/to/ca-cert.pem',      # CA μΈμ¦μ„
    ssl_cert='/path/to/client-cert.pem', # ν΄λΌμ΄μ–ΈνΈ μΈμ¦μ„
    ssl_key='/path/to/client-key.pem'    # ν΄λΌμ΄μ–ΈνΈ ν‚¤
)</code></pre>

            <pre><code># MySQL μ„λ²„ μ„¤μ • (my.cnf)
[mysqld]
require_secure_transport = ON
ssl_ca = /var/lib/mysql/ca.pem
ssl_cert = /var/lib/mysql/server-cert.pem
ssl_key = /var/lib/mysql/server-key.pem</code></pre>

            <hr>

            <h2>μ•”νΈν™” μ²΄ν¬λ¦¬μ¤νΈ</h2>

            <table>
                <tr>
                    <th>ν•­λ©</th>
                    <th>ν™•μΈ</th>
                </tr>
                <tr>
                    <td>λ―Όκ° μΉΌλΌ μ‹λ³„ λ° μ•”νΈν™”</td>
                    <td>β</td>
                </tr>
                <tr>
                    <td>μ•”νΈν™” ν‚¤ μ•μ „ν•κ² λ³΄κ΄€</td>
                    <td>β</td>
                </tr>
                <tr>
                    <td>DB μ—°κ²° TLS μ‚¬μ©</td>
                    <td>β</td>
                </tr>
                <tr>
                    <td>ν‚¤ λ΅ν…μ΄μ… κ³„ν</td>
                    <td>β</td>
                </tr>
                <tr>
                    <td>λ³µνΈν™” κ¶ν• μ ν•</td>
                    <td>β</td>
                </tr>
            </table>

            <hr>

            <h2>μ΄λ² μ¥ μ •λ¦¬</h2>

            <ul>
                <li>λ―Όκ° λ°μ΄ν„°λ” <strong>μ•”νΈν™”</strong>ν•΄μ„ μ €μ¥</li>
                <li><strong>AES</strong>κ°€ κ°€μ¥ λ„λ¦¬ μ‚¬μ©λλ” μ•”νΈν™” μ•κ³ λ¦¬μ¦</li>
                <li>μ•”νΈν™” ν‚¤λ” <strong>μ½”λ“μ— λ„£μ§€ λ§κ³ </strong> λ³„λ„ κ΄€λ¦¬</li>
                <li>μ•”νΈν™”λ λ°μ΄ν„° κ²€μƒ‰μ€ <strong>λΈ”λΌμΈλ“ μΈλ±μ¤</strong> ν™μ©</li>
                <li>DB μ—°κ²°λ„ <strong>TLS</strong>λ΅ μ•”νΈν™”</li>
            </ul>

            <blockquote>λ‹¤μ μ¥μ—μ„λ” WAS μ„λ²„ λ³΄μ• μ„¤μ •μ„ λ°°μ›λ‹λ‹¤!</blockquote>

            <div class="nav-buttons">
                <button class="nav-btn" id="prevBtn">β† μ΄μ „</button>
                <span class="page-num" id="pageNum"></span>
                <button class="nav-btn" id="nextBtn">λ‹¤μ β†’</button>
            </div>
        </main>
    </div>
    <script src="../js/nav.js"></script>
</body>
</html>
