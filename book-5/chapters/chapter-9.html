<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>9ì¥: DB ì ‘ê·¼ ì œì–´ - ë¬¼ë¦¬ì¹˜ë£Œì‚¬ë¥¼ ìœ„í•œ DB 5ê¶Œ</title>
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
    @@include('components/top-nav.html', {"root": "../..", "activeBook": "5"})

    @@include('components/mobile-menu.html')

    <div class="container">
        <nav class="sidebar" id="sidebar">
            <button class="close-btn" onclick="toggleMenu()">Ã—</button>
            <div class="sidebar-header">
                <h1>ğŸ›¡ï¸ 5ê¶Œ: ë³´ì•ˆ í¸</h1>
                <p>DB & ì„œë²„ ë³´ì•ˆ</p>
            </div>
            <ul class="nav-list" id="navList"></ul>
        </nav>

        <main class="main">
            <h1 class="title">DB ì ‘ê·¼ ì œì–´</h1>

            <h2>ë„¤íŠ¸ì›Œí¬ ìˆ˜ì¤€ì˜ ë³´ì•ˆ</h2>

            <p>DB ê¶Œí•œ ì™¸ì—ë„ ë„¤íŠ¸ì›Œí¬ ë ˆë²¨ì—ì„œ ì ‘ê·¼ì„ ì œì–´í•´ì•¼ í•©ë‹ˆë‹¤.</p>

            <pre class="file-tree">ì ‘ê·¼ ì œì–´ ê³„ì¸µ
â”‚
â”œâ”€â”€ 1. ë°©í™”ë²½ (Firewall)
â”‚   â””â”€â”€ í—ˆìš©ëœ IPë§Œ 3306 í¬íŠ¸ ì ‘ê·¼
â”‚
â”œâ”€â”€ 2. MySQL í˜¸ìŠ¤íŠ¸ ì œí•œ
â”‚   â””â”€â”€ ì‚¬ìš©ìë³„ ì ‘ì† IP ì œí•œ
â”‚
â”œâ”€â”€ 3. MySQL ê¶Œí•œ
â”‚   â””â”€â”€ í…Œì´ë¸”/ì¹¼ëŸ¼ ë‹¨ìœ„ ê¶Œí•œ
â”‚
â””â”€â”€ 4. ì•± ë ˆë²¨ ì ‘ê·¼ ì œì–´
    â””â”€â”€ ì‚¬ìš©ì ì—­í• ë³„ ê¸°ëŠ¥ ì œí•œ</pre>

            <hr>

            <h2>MySQL ë°”ì¸ë“œ ì£¼ì†Œ ì„¤ì •</h2>

            <p>MySQLì´ ì–´ë–¤ ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ì—ì„œ ì ‘ì†ì„ ë°›ì„ì§€ ì„¤ì •í•©ë‹ˆë‹¤.</p>

            <pre><code># my.cnf ë˜ëŠ” my.ini

[mysqld]
# ë¡œì»¬ì—ì„œë§Œ ì ‘ì† í—ˆìš© (ê°€ì¥ ì•ˆì „)
bind-address = 127.0.0.1

# íŠ¹ì • IPì—ì„œë§Œ ì ‘ì† í—ˆìš©
bind-address = 192.168.1.10

# ëª¨ë“  IPì—ì„œ ì ‘ì† í—ˆìš© (ìœ„í—˜!)
bind-address = 0.0.0.0</code></pre>

            <div class="warning">
                <strong>ì£¼ì˜</strong><br>
                bind-address = 0.0.0.0ì€ ì™¸ë¶€ ê³µê²©ì— ë…¸ì¶œë©ë‹ˆë‹¤!<br>
                ë°˜ë“œì‹œ ë°©í™”ë²½ê³¼ í•¨ê»˜ ì‚¬ìš©í•˜ì„¸ìš”.
            </div>

            <hr>

            <h2>ë¦¬ëˆ…ìŠ¤ ë°©í™”ë²½ (iptables)</h2>

            <pre><code># í˜„ì¬ ê·œì¹™ í™•ì¸
sudo iptables -L -n

# MySQL í¬íŠ¸(3306) - íŠ¹ì • IPë§Œ í—ˆìš©
sudo iptables -A INPUT -p tcp --dport 3306 -s 192.168.1.100 -j ACCEPT
sudo iptables -A INPUT -p tcp --dport 3306 -s 192.168.1.101 -j ACCEPT

# ë‚˜ë¨¸ì§€ IPëŠ” ì°¨ë‹¨
sudo iptables -A INPUT -p tcp --dport 3306 -j DROP

# ê·œì¹™ ì €ì¥ (Ubuntu)
sudo netfilter-persistent save</code></pre>

            <hr>

            <h2>ë¦¬ëˆ…ìŠ¤ ë°©í™”ë²½ (firewalld)</h2>

            <pre><code># CentOS/RHELì—ì„œ ì‚¬ìš©

# í˜„ì¬ ìƒíƒœ í™•ì¸
sudo firewall-cmd --list-all

# MySQL í¬íŠ¸ ì—´ê¸° (íŠ¹ì • IPë§Œ)
sudo firewall-cmd --permanent --add-rich-rule='
    rule family="ipv4"
    source address="192.168.1.100"
    port protocol="tcp" port="3306"
    accept'

# ì ìš©
sudo firewall-cmd --reload</code></pre>

            <hr>

            <h2>ë¦¬ëˆ…ìŠ¤ ë°©í™”ë²½ (ufw)</h2>

            <pre><code># Ubuntuì—ì„œ ì‚¬ìš©

# ufw í™œì„±í™”
sudo ufw enable

# SSH í—ˆìš© (ë¨¼ì €!)
sudo ufw allow ssh

# MySQL - íŠ¹ì • IPë§Œ í—ˆìš©
sudo ufw allow from 192.168.1.100 to any port 3306
sudo ufw allow from 192.168.1.101 to any port 3306

# ìƒíƒœ í™•ì¸
sudo ufw status</code></pre>

            <hr>

            <h2>ìœˆë„ìš° ë°©í™”ë²½</h2>

            <pre><code># PowerShell (ê´€ë¦¬ì ê¶Œí•œ)

# MySQL í¬íŠ¸ ì—´ê¸° (íŠ¹ì • IPë§Œ)
New-NetFirewallRule -DisplayName "MySQL Allow" `
    -Direction Inbound `
    -Protocol TCP `
    -LocalPort 3306 `
    -RemoteAddress 192.168.1.100,192.168.1.101 `
    -Action Allow

# ê·œì¹™ í™•ì¸
Get-NetFirewallRule -DisplayName "MySQL*"</code></pre>

            <hr>

            <h2>AWS ë³´ì•ˆ ê·¸ë£¹</h2>

            <p>í´ë¼ìš°ë“œ í™˜ê²½ì—ì„œëŠ” ë³´ì•ˆ ê·¸ë£¹ìœ¼ë¡œ ë„¤íŠ¸ì›Œí¬ ì ‘ê·¼ì„ ì œì–´í•©ë‹ˆë‹¤.</p>

            <pre><code># AWS CLIë¡œ ë³´ì•ˆ ê·¸ë£¹ ê·œì¹™ ì¶”ê°€

# RDS(MySQL)ìš© ë³´ì•ˆ ê·¸ë£¹ì— ê·œì¹™ ì¶”ê°€
aws ec2 authorize-security-group-ingress \
    --group-id sg-1234567890abcdef0 \
    --protocol tcp \
    --port 3306 \
    --source-group sg-0987654321fedcba0  # ì•± ì„œë²„ ë³´ì•ˆ ê·¸ë£¹</code></pre>

            <pre class="file-tree">AWS ê¶Œì¥ êµ¬ì„±
â”‚
â”œâ”€â”€ ì›¹ ì„œë²„ (Public Subnet)
â”‚   â””â”€â”€ ë³´ì•ˆ ê·¸ë£¹: 80, 443 í—ˆìš©
â”‚
â””â”€â”€ DB ì„œë²„ (Private Subnet)
    â””â”€â”€ ë³´ì•ˆ ê·¸ë£¹: ì›¹ ì„œë²„ ë³´ì•ˆ ê·¸ë£¹ì—ì„œë§Œ 3306 í—ˆìš©
    â””â”€â”€ ì¸í„°ë„·ì—ì„œ ì§ì ‘ ì ‘ê·¼ ë¶ˆê°€!</pre>

            <hr>

            <h2>VPNì„ í†µí•œ ì ‘ê·¼</h2>

            <p>ê´€ë¦¬ìê°€ ì™¸ë¶€ì—ì„œ DBì— ì ‘ê·¼í•´ì•¼ í•  ë•ŒëŠ” VPNì„ ì‚¬ìš©í•©ë‹ˆë‹¤.</p>

            <pre class="file-tree">VPN ì ‘ê·¼ êµ¬ì„±
â”‚
â”œâ”€â”€ ê´€ë¦¬ì PC
â”‚   â””â”€â”€ VPN í´ë¼ì´ì–¸íŠ¸
â”‚
â”œâ”€â”€ VPN ì„œë²„ (íšŒì‚¬ ë„¤íŠ¸ì›Œí¬ ë‚´)
â”‚   â””â”€â”€ ì¸ì¦ëœ ì‚¬ìš©ìë§Œ ì ‘ì†
â”‚
â””â”€â”€ DB ì„œë²„
    â””â”€â”€ VPN ì„œë²„ IPë§Œ í—ˆìš©</pre>

            <hr>

            <h2>SSH í„°ë„ë§</h2>

            <p>SSHë¥¼ í†µí•´ ì•”í˜¸í™”ëœ í„°ë„ì„ ë§Œë“¤ì–´ DBì— ì ‘ê·¼í•©ë‹ˆë‹¤.</p>

            <pre><code># ë¡œì»¬ í¬íŠ¸ í¬ì›Œë”©
# ë¡œì»¬ 3307 â†’ ì„œë²„ì˜ localhost:3306

ssh -L 3307:localhost:3306 user@db-server.com

# ë‹¤ë¥¸ í„°ë¯¸ë„ì—ì„œ ì ‘ì†
mysql -h 127.0.0.1 -P 3307 -u healing_app -p</code></pre>

            <pre><code># Pythonì—ì„œ SSH í„°ë„ ì‚¬ìš©
from sshtunnel import SSHTunnelForwarder
import mysql.connector

# SSH í„°ë„ ìƒì„±
tunnel = SSHTunnelForwarder(
    ('db-server.com', 22),
    ssh_username='user',
    ssh_pkey='/path/to/private_key',
    remote_bind_address=('127.0.0.1', 3306)
)
tunnel.start()

# í„°ë„ì„ í†µí•´ DB ì—°ê²°
conn = mysql.connector.connect(
    host='127.0.0.1',
    port=tunnel.local_bind_port,
    user='healing_app',
    password='password',
    database='healing_hands'
)

# ì‚¬ìš© í›„ ì •ë¦¬
conn.close()
tunnel.stop()</code></pre>

            <hr>

            <h2>MySQL ì—°ê²° ë¡œê·¸</h2>

            <p>ëˆ„ê°€ ì–¸ì œ ì ‘ì†í–ˆëŠ”ì§€ ê¸°ë¡í•©ë‹ˆë‹¤.</p>

            <pre><code># my.cnf

[mysqld]
# ì¼ë°˜ ì¿¼ë¦¬ ë¡œê·¸ (ì„±ëŠ¥ ì˜í–¥ ìˆìŒ)
general_log = 1
general_log_file = /var/log/mysql/general.log

# ì—°ê²° ë¡œê·¸
log_error = /var/log/mysql/error.log</code></pre>

            <pre><code>-- í˜„ì¬ ì—°ê²° í™•ì¸
SHOW PROCESSLIST;

-- ì—°ê²° ì´ë ¥ (performance_schema)
SELECT * FROM performance_schema.events_statements_summary_by_user_by_event_name
WHERE EVENT_NAME LIKE '%connect%';</code></pre>

            <hr>

            <h2>ì ‘ì† ì‹¤íŒ¨ ì‹œ ì ê¸ˆ</h2>

            <pre><code># my.cnf

[mysqld]
# ì—°ê²° ì‹¤íŒ¨ ì‹œ ê³„ì • ì ê¸ˆ (MySQL 8.0+)
# 3ë²ˆ ì‹¤íŒ¨ ì‹œ 2ì¼ ì ê¸ˆ
CREATE USER 'healing_app'@'localhost'
IDENTIFIED BY 'password'
FAILED_LOGIN_ATTEMPTS 3
PASSWORD_LOCK_TIME 2;</code></pre>

            <hr>

            <h2>íë§ì† ì‹œìŠ¤í…œ ë„¤íŠ¸ì›Œí¬ êµ¬ì„±</h2>

            <pre class="file-tree">ê¶Œì¥ êµ¬ì„±
â”‚
â”œâ”€â”€ ì›¹ ì„œë²„ (192.168.1.10)
â”‚   â”œâ”€â”€ Flask ì•± ì‹¤í–‰
â”‚   â”œâ”€â”€ ë°©í™”ë²½: 80, 443 ì™¸ë¶€ í—ˆìš©
â”‚   â””â”€â”€ DB ì ‘ì†: 192.168.1.20:3306
â”‚
â””â”€â”€ DB ì„œë²„ (192.168.1.20)
    â”œâ”€â”€ MySQL ì‹¤í–‰
    â”œâ”€â”€ bind-address: 192.168.1.20
    â””â”€â”€ ë°©í™”ë²½: 3306ì€ 192.168.1.10ë§Œ í—ˆìš©</pre>

            <hr>

            <h2>ì ‘ê·¼ ì œì–´ ì²´í¬ë¦¬ìŠ¤íŠ¸</h2>

            <table>
                <tr>
                    <th>í•­ëª©</th>
                    <th>í™•ì¸</th>
                </tr>
                <tr>
                    <td>MySQL bind-address ì„¤ì •</td>
                    <td>â˜</td>
                </tr>
                <tr>
                    <td>ë°©í™”ë²½ìœ¼ë¡œ 3306 í¬íŠ¸ ì œí•œ</td>
                    <td>â˜</td>
                </tr>
                <tr>
                    <td>DB ì‚¬ìš©ì í˜¸ìŠ¤íŠ¸ ì œí•œ</td>
                    <td>â˜</td>
                </tr>
                <tr>
                    <td>ì›ê²© ì ‘ì† ì‹œ VPN/SSH í„°ë„ ì‚¬ìš©</td>
                    <td>â˜</td>
                </tr>
                <tr>
                    <td>ì—°ê²° ë¡œê·¸ í™œì„±í™”</td>
                    <td>â˜</td>
                </tr>
            </table>

            <hr>

            <h2>ì´ë²ˆ ì¥ ì •ë¦¬</h2>

            <ul>
                <li><strong>bind-address</strong>ë¡œ MySQL ì ‘ì† ì¸í„°í˜ì´ìŠ¤ ì œí•œ</li>
                <li><strong>ë°©í™”ë²½</strong>ìœ¼ë¡œ ë„¤íŠ¸ì›Œí¬ ë ˆë²¨ ì ‘ê·¼ ì œì–´</li>
                <li>í´ë¼ìš°ë“œì—ì„œëŠ” <strong>ë³´ì•ˆ ê·¸ë£¹</strong> í™œìš©</li>
                <li>ì™¸ë¶€ ì ‘ê·¼ì€ <strong>VPN</strong> ë˜ëŠ” <strong>SSH í„°ë„</strong> ì‚¬ìš©</li>
                <li><strong>ì—°ê²° ë¡œê·¸</strong>ë¡œ ì ‘ì† ê¸°ë¡ ê´€ë¦¬</li>
            </ul>

            <blockquote>ë‹¤ìŒ ì¥ì—ì„œëŠ” ë¯¼ê° ë°ì´í„° ì•”í˜¸í™”ë¥¼ ë°°ì›ë‹ˆë‹¤!</blockquote>

            <div class="nav-buttons">
                <button class="nav-btn" id="prevBtn">â† ì´ì „</button>
                <span class="page-num" id="pageNum"></span>
                <button class="nav-btn" id="nextBtn">ë‹¤ìŒ â†’</button>
            </div>
        </main>
    </div>
    <script src="../js/nav.js"></script>
</body>
</html>
