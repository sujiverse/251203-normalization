<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>8ì¥: DB ì‚¬ìš©ì ê¶Œí•œ ê´€ë¦¬ - ë¬¼ë¦¬ì¹˜ë£Œì‚¬ë¥¼ ìœ„í•œ DB 5ê¶Œ</title>
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
    @@include('components/top-nav.html', {"root": "../..", "activeBook": "5"})

    @@include('components/mobile-menu.html')

    <div class="container">
        <nav class="sidebar" id="sidebar">
            <button class="close-btn" onclick="toggleMenu()">Ã—</button>
            <div class="sidebar-header">
                <h1>ğŸ›¡ï¸ 5ê¶Œ: ë³´ì•ˆ í¸</h1>
                <p>DB & ì„œë²„ ë³´ì•ˆ</p>
            </div>
            <ul class="nav-list" id="navList"></ul>
        </nav>

        <main class="main">
            <h1 class="title">DB ì‚¬ìš©ì ê¶Œí•œ ê´€ë¦¬</h1>

            <h2>ìµœì†Œ ê¶Œí•œ ì›ì¹™</h2>

            <blockquote>
                ì‚¬ìš©ìì—ê²ŒëŠ” <strong>ì—…ë¬´ì— í•„ìš”í•œ ìµœì†Œí•œì˜ ê¶Œí•œ</strong>ë§Œ ë¶€ì—¬í•©ë‹ˆë‹¤.
            </blockquote>

            <pre class="file-tree">ê¶Œí•œ ë¶„ë¦¬ ì˜ˆì‹œ
â”‚
â”œâ”€â”€ root (ìŠˆí¼ìœ ì €)
â”‚   â””â”€â”€ ì‹œìŠ¤í…œ ê´€ë¦¬ë§Œ - ì•±ì—ì„œ ì‚¬ìš© ê¸ˆì§€!
â”‚
â”œâ”€â”€ healing_admin
â”‚   â””â”€â”€ ìŠ¤í‚¤ë§ˆ ë³€ê²½, ë°±ì—…
â”‚
â”œâ”€â”€ healing_app
â”‚   â””â”€â”€ SELECT, INSERT, UPDATE (ì›¹ ì•±ìš©)
â”‚
â””â”€â”€ healing_readonly
    â””â”€â”€ SELECTë§Œ (ë¦¬í¬íŠ¸ìš©)</pre>

            <hr>

            <h2>MySQL ì‚¬ìš©ì ìƒì„±</h2>

            <pre><code>-- ì‚¬ìš©ì ìƒì„±
CREATE USER 'healing_app'@'localhost' IDENTIFIED BY 'secure_password_123!';

-- ì›ê²© ì ‘ì†ìš© (íŠ¹ì • IPë§Œ)
CREATE USER 'healing_app'@'192.168.1.100' IDENTIFIED BY 'secure_password_123!';

-- ëª¨ë“  IPì—ì„œ ì ‘ì† (ë¹„ì¶”ì²œ)
CREATE USER 'healing_app'@'%' IDENTIFIED BY 'secure_password_123!';</code></pre>

            <h3>í˜¸ìŠ¤íŠ¸ ì§€ì •ì˜ ì˜ë¯¸</h3>
            <table>
                <tr>
                    <th>í˜¸ìŠ¤íŠ¸</th>
                    <th>ì˜ë¯¸</th>
                    <th>ìš©ë„</th>
                </tr>
                <tr>
                    <td>localhost</td>
                    <td>ê°™ì€ ì„œë²„ì—ì„œë§Œ</td>
                    <td>ì›¹ ì•±ê³¼ DB ê°™ì€ ì„œë²„</td>
                </tr>
                <tr>
                    <td>192.168.1.100</td>
                    <td>íŠ¹ì • IPë§Œ</td>
                    <td>ì•± ì„œë²„ ì§€ì •</td>
                </tr>
                <tr>
                    <td>192.168.1.%</td>
                    <td>íŠ¹ì • ëŒ€ì—­</td>
                    <td>ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬</td>
                </tr>
                <tr>
                    <td>%</td>
                    <td>ëª¨ë“  IP</td>
                    <td>ë¹„ì¶”ì²œ!</td>
                </tr>
            </table>

            <hr>

            <h2>ê¶Œí•œ ë¶€ì—¬ (GRANT)</h2>

            <pre><code>-- ëª¨ë“  ê¶Œí•œ (ìœ„í—˜!)
GRANT ALL PRIVILEGES ON healing_hands.* TO 'healing_app'@'localhost';

-- í•„ìš”í•œ ê¶Œí•œë§Œ (ê¶Œì¥)
GRANT SELECT, INSERT, UPDATE ON healing_hands.* TO 'healing_app'@'localhost';

-- íŠ¹ì • í…Œì´ë¸”ë§Œ
GRANT SELECT ON healing_hands.patients TO 'healing_readonly'@'localhost';
GRANT SELECT ON healing_hands.treatment_sessions TO 'healing_readonly'@'localhost';

-- íŠ¹ì • ì¹¼ëŸ¼ë§Œ (ë¯¼ê°ì •ë³´ ì œì™¸)
GRANT SELECT (patient_id, name, phone) ON healing_hands.patients
TO 'healing_staff'@'localhost';

-- ê¶Œí•œ ì ìš©
FLUSH PRIVILEGES;</code></pre>

            <h3>ê¶Œí•œ ì¢…ë¥˜</h3>
            <table>
                <tr>
                    <th>ê¶Œí•œ</th>
                    <th>ì„¤ëª…</th>
                    <th>ìœ„í—˜ë„</th>
                </tr>
                <tr>
                    <td>SELECT</td>
                    <td>ë°ì´í„° ì¡°íšŒ</td>
                    <td>ë‚®ìŒ</td>
                </tr>
                <tr>
                    <td>INSERT</td>
                    <td>ë°ì´í„° ì¶”ê°€</td>
                    <td>ì¤‘ê°„</td>
                </tr>
                <tr>
                    <td>UPDATE</td>
                    <td>ë°ì´í„° ìˆ˜ì •</td>
                    <td>ì¤‘ê°„</td>
                </tr>
                <tr>
                    <td>DELETE</td>
                    <td>ë°ì´í„° ì‚­ì œ</td>
                    <td>ë†’ìŒ</td>
                </tr>
                <tr>
                    <td>DROP</td>
                    <td>í…Œì´ë¸”/DB ì‚­ì œ</td>
                    <td>ë§¤ìš° ë†’ìŒ</td>
                </tr>
                <tr>
                    <td>ALTER</td>
                    <td>ìŠ¤í‚¤ë§ˆ ë³€ê²½</td>
                    <td>ë†’ìŒ</td>
                </tr>
                <tr>
                    <td>GRANT OPTION</td>
                    <td>ê¶Œí•œ ë¶€ì—¬ ê°€ëŠ¥</td>
                    <td>ë§¤ìš° ë†’ìŒ</td>
                </tr>
            </table>

            <hr>

            <h2>ê¶Œí•œ íšŒìˆ˜ (REVOKE)</h2>

            <pre><code>-- íŠ¹ì • ê¶Œí•œ íšŒìˆ˜
REVOKE DELETE ON healing_hands.* FROM 'healing_app'@'localhost';

-- ëª¨ë“  ê¶Œí•œ íšŒìˆ˜
REVOKE ALL PRIVILEGES ON healing_hands.* FROM 'healing_app'@'localhost';

-- ê¶Œí•œ ì ìš©
FLUSH PRIVILEGES;</code></pre>

            <hr>

            <h2>ê¶Œí•œ í™•ì¸</h2>

            <pre><code>-- í˜„ì¬ ì‚¬ìš©ì ê¶Œí•œ í™•ì¸
SHOW GRANTS;

-- íŠ¹ì • ì‚¬ìš©ì ê¶Œí•œ í™•ì¸
SHOW GRANTS FOR 'healing_app'@'localhost';

-- ê²°ê³¼ ì˜ˆì‹œ:
-- GRANT SELECT, INSERT, UPDATE ON `healing_hands`.* TO 'healing_app'@'localhost'</code></pre>

            <hr>

            <h2>ì—­í•  ê¸°ë°˜ ê¶Œí•œ ê´€ë¦¬</h2>

            <p>MySQL 8.0ë¶€í„° ì—­í• (Role)ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

            <pre><code>-- ì—­í•  ìƒì„±
CREATE ROLE 'app_read', 'app_write', 'app_admin';

-- ì—­í• ì— ê¶Œí•œ ë¶€ì—¬
GRANT SELECT ON healing_hands.* TO 'app_read';
GRANT INSERT, UPDATE ON healing_hands.* TO 'app_write';
GRANT ALL PRIVILEGES ON healing_hands.* TO 'app_admin';

-- ì‚¬ìš©ìì—ê²Œ ì—­í•  ë¶€ì—¬
GRANT 'app_read', 'app_write' TO 'healing_app'@'localhost';
GRANT 'app_admin' TO 'healing_admin'@'localhost';

-- ì—­í•  í™œì„±í™” (ê¸°ë³¸ê°’ ì„¤ì •)
SET DEFAULT ROLE 'app_read', 'app_write' TO 'healing_app'@'localhost';</code></pre>

            <hr>

            <h2>íë§ì† ì‹œìŠ¤í…œ ê¶Œí•œ ì„¤ê³„</h2>

            <pre><code>-- 1. ì›¹ ì•±ìš© ì‚¬ìš©ì (ì¼ë°˜ CRUD)
CREATE USER 'healing_web'@'localhost' IDENTIFIED BY 'web_password_123!';
GRANT SELECT, INSERT, UPDATE ON healing_hands.patients TO 'healing_web'@'localhost';
GRANT SELECT, INSERT, UPDATE ON healing_hands.treatment_sessions TO 'healing_web'@'localhost';
GRANT SELECT, INSERT, UPDATE ON healing_hands.billings TO 'healing_web'@'localhost';
-- DELETE ê¶Œí•œ ì—†ìŒ!

-- 2. ê´€ë¦¬ììš© (ì‚­ì œ ê°€ëŠ¥)
CREATE USER 'healing_admin'@'localhost' IDENTIFIED BY 'admin_password_456!';
GRANT SELECT, INSERT, UPDATE, DELETE ON healing_hands.* TO 'healing_admin'@'localhost';
-- DROP, ALTER ê¶Œí•œ ì—†ìŒ!

-- 3. ë¦¬í¬íŠ¸ìš© (ì½ê¸° ì „ìš©)
CREATE USER 'healing_report'@'localhost' IDENTIFIED BY 'report_password_789!';
GRANT SELECT ON healing_hands.* TO 'healing_report'@'localhost';

-- 4. ë°±ì—…ìš©
CREATE USER 'healing_backup'@'localhost' IDENTIFIED BY 'backup_password_000!';
GRANT SELECT, LOCK TABLES, SHOW VIEW ON healing_hands.* TO 'healing_backup'@'localhost';

FLUSH PRIVILEGES;</code></pre>

            <hr>

            <h2>ì‚¬ìš©ì ì‚­ì œ</h2>

            <pre><code>-- ì‚¬ìš©ì ì‚­ì œ
DROP USER 'old_user'@'localhost';

-- ì¡´ì¬í•˜ë©´ ì‚­ì œ
DROP USER IF EXISTS 'old_user'@'localhost';</code></pre>

            <hr>

            <h2>ë¹„ë°€ë²ˆí˜¸ ì •ì±…</h2>

            <pre><code>-- ë¹„ë°€ë²ˆí˜¸ ë§Œë£Œ ì„¤ì •
ALTER USER 'healing_app'@'localhost' PASSWORD EXPIRE INTERVAL 90 DAY;

-- ë¹„ë°€ë²ˆí˜¸ ë³€ê²½
ALTER USER 'healing_app'@'localhost' IDENTIFIED BY 'new_secure_password!';

-- ë¹„ë°€ë²ˆí˜¸ ì •ì±… í™•ì¸
SHOW VARIABLES LIKE 'validate_password%';

-- ë¹„ë°€ë²ˆí˜¸ ì •ì±… ì„¤ì • (my.cnf)
[mysqld]
validate_password.policy=MEDIUM
validate_password.length=8
validate_password.mixed_case_count=1
validate_password.number_count=1
validate_password.special_char_count=1</code></pre>

            <hr>

            <h2>Flaskì—ì„œ ì‚¬ìš©ì ë¶„ë¦¬</h2>

            <pre><code>import mysql.connector

# ì½ê¸° ì „ìš© ì—°ê²°
def get_readonly_db():
    return mysql.connector.connect(
        host='localhost',
        user='healing_report',
        password='report_password_789!',
        database='healing_hands'
    )

# ì½ê¸°/ì“°ê¸° ì—°ê²°
def get_readwrite_db():
    return mysql.connector.connect(
        host='localhost',
        user='healing_web',
        password='web_password_123!',
        database='healing_hands'
    )

# ì¡°íšŒ ê¸°ëŠ¥
@app.route('/api/patients')
def get_patients():
    conn = get_readonly_db()  # ì½ê¸° ì „ìš© ì‚¬ìš©
    cursor = conn.cursor(dictionary=True)
    cursor.execute("SELECT * FROM patients")
    ...

# ì €ì¥ ê¸°ëŠ¥
@app.route('/api/patients', methods=['POST'])
def create_patient():
    conn = get_readwrite_db()  # ì½ê¸°/ì“°ê¸° ì‚¬ìš©
    cursor = conn.cursor()
    cursor.execute("INSERT INTO patients ...")
    ...</code></pre>

            <hr>

            <h2>ê¶Œí•œ ê´€ë¦¬ ì²´í¬ë¦¬ìŠ¤íŠ¸</h2>

            <table>
                <tr>
                    <th>í•­ëª©</th>
                    <th>í™•ì¸</th>
                </tr>
                <tr>
                    <td>root ê³„ì • ì•±ì—ì„œ ì‚¬ìš© ì•ˆ í•¨</td>
                    <td>â˜</td>
                </tr>
                <tr>
                    <td>ìš©ë„ë³„ DB ì‚¬ìš©ì ë¶„ë¦¬</td>
                    <td>â˜</td>
                </tr>
                <tr>
                    <td>ìµœì†Œ ê¶Œí•œë§Œ ë¶€ì—¬</td>
                    <td>â˜</td>
                </tr>
                <tr>
                    <td>í˜¸ìŠ¤íŠ¸ ì œí•œ ì„¤ì •</td>
                    <td>â˜</td>
                </tr>
                <tr>
                    <td>ë¹„ë°€ë²ˆí˜¸ ì •ì±… ì ìš©</td>
                    <td>â˜</td>
                </tr>
                <tr>
                    <td>ì •ê¸°ì ì¸ ê¶Œí•œ ê²€í† </td>
                    <td>â˜</td>
                </tr>
            </table>

            <hr>

            <h2>ì´ë²ˆ ì¥ ì •ë¦¬</h2>

            <ul>
                <li><strong>ìµœì†Œ ê¶Œí•œ ì›ì¹™</strong>: í•„ìš”í•œ ê¶Œí•œë§Œ ë¶€ì—¬</li>
                <li><strong>ìš©ë„ë³„ ì‚¬ìš©ì ë¶„ë¦¬</strong>: ì›¹ ì•±, ê´€ë¦¬ì, ë¦¬í¬íŠ¸ ë“±</li>
                <li><strong>GRANT/REVOKE</strong>ë¡œ ê¶Œí•œ ê´€ë¦¬</li>
                <li><strong>í˜¸ìŠ¤íŠ¸ ì œí•œ</strong>ìœ¼ë¡œ ì ‘ì† IP ì œì–´</li>
                <li>root ê³„ì •ì€ ì•±ì—ì„œ <strong>ì ˆëŒ€ ì‚¬ìš© ê¸ˆì§€</strong></li>
            </ul>

            <blockquote>ë‹¤ìŒ ì¥ì—ì„œëŠ” DB ì ‘ê·¼ ì œì–´ (ë°©í™”ë²½, IP ì œí•œ)ë¥¼ ë°°ì›ë‹ˆë‹¤!</blockquote>

            <div class="nav-buttons">
                <button class="nav-btn" id="prevBtn">â† ì´ì „</button>
                <span class="page-num" id="pageNum"></span>
                <button class="nav-btn" id="nextBtn">ë‹¤ìŒ â†’</button>
            </div>
        </main>
    </div>
    <script src="../js/nav.js"></script>
</body>
</html>
