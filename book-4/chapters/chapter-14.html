<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>14ì¥: API í˜¸ì¶œí•˜ê¸° - ë¬¼ë¦¬ì¹˜ë£Œì‚¬ë¥¼ ìœ„í•œ DB 4ê¶Œ</title>
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
    @@include('components/top-nav.html', {"root": "../..", "activeBook": "4"})

    @@include('components/mobile-menu.html')

    <div class="container">
        <nav class="sidebar" id="sidebar">
            <button class="close-btn" onclick="toggleMenu()">Ã—</button>
            <div class="sidebar-header">
                <h1>ğŸ“• ë¬¼ë¦¬ì¹˜ë£Œì‚¬ë¥¼ ìœ„í•œ</h1>
                <p>ì›¹ ì•± ë§Œë“¤ê¸° (4ê¶Œ)</p>
            </div>
            <ul class="nav-list" id="navList"></ul>
        </nav>

        <main class="main">
            <h1 class="title">API í˜¸ì¶œí•˜ê¸°</h1>

            <h2>fetch() ê¸°ë³¸</h2>

            <p><code>fetch()</code>ëŠ” JavaScriptì—ì„œ HTTP ìš”ì²­ì„ ë³´ë‚´ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤.</p>

            <pre><code>// ê¸°ë³¸ GET ìš”ì²­
fetch('/api/patients')
    .then(response => response.json())
    .then(data => {
        console.log(data);
    })
    .catch(error => {
        console.error('ì—ëŸ¬:', error);
    });</code></pre>

            <hr>

            <h2>async/await ë°©ì‹ (ê¶Œì¥)</h2>

            <pre><code>async function getPatients() {
    try {
        const response = await fetch('/api/patients');

        if (!response.ok) {
            throw new Error('ì„œë²„ ì—ëŸ¬');
        }

        const data = await response.json();
        return data;
    } catch (error) {
        console.error('ì—ëŸ¬:', error);
        alert('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤');
    }
}</code></pre>

            <hr>

            <h2>GET ìš”ì²­ (ì¡°íšŒ)</h2>

            <pre><code>// ì „ì²´ ëª©ë¡
async function getPatients() {
    const response = await fetch('/api/patients');
    return await response.json();
}

// ê²€ìƒ‰
async function searchPatients(name) {
    const response = await fetch(`/api/patients?name=${encodeURIComponent(name)}`);
    return await response.json();
}

// ìƒì„¸ ì¡°íšŒ
async function getPatient(id) {
    const response = await fetch(`/api/patients/${id}`);
    return await response.json();
}</code></pre>

            <hr>

            <h2>POST ìš”ì²­ (ìƒì„±)</h2>

            <pre><code>async function createPatient(patientData) {
    const response = await fetch('/api/patients', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(patientData)
    });

    return await response.json();
}

// ì‚¬ìš©
const newPatient = {
    name: 'í™ê¸¸ë™',
    phone: '010-9999-8888',
    birth_date: '1995-05-05'
};

createPatient(newPatient).then(result => {
    if (result.success) {
        alert('ë“±ë¡ ì™„ë£Œ!');
    }
});</code></pre>

            <hr>

            <h2>PUT ìš”ì²­ (ìˆ˜ì •)</h2>

            <pre><code>async function updatePatient(id, data) {
    const response = await fetch(`/api/patients/${id}`, {
        method: 'PUT',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
    });

    return await response.json();
}

// ì‚¬ìš©
updatePatient(1, { phone: '010-1111-2222' })
    .then(result => {
        if (result.success) {
            alert('ìˆ˜ì • ì™„ë£Œ!');
        }
    });</code></pre>

            <hr>

            <h2>DELETE ìš”ì²­ (ì‚­ì œ)</h2>

            <pre><code>async function deletePatient(id) {
    const response = await fetch(`/api/patients/${id}`, {
        method: 'DELETE'
    });

    return await response.json();
}

// ì‚¬ìš©
if (confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
    deletePatient(1).then(result => {
        if (result.success) {
            alert('ì‚­ì œ ì™„ë£Œ!');
            loadPatientTable();  // í…Œì´ë¸” ìƒˆë¡œê³ ì¹¨
        }
    });
}</code></pre>

            <hr>

            <h2>í¼ ë°ì´í„° ì²˜ë¦¬</h2>

            <pre><code>// HTML
&lt;form id="patientForm"&gt;
    &lt;input name="name" id="name"&gt;
    &lt;input name="phone" id="phone"&gt;
    &lt;button type="submit"&gt;ë“±ë¡&lt;/button&gt;
&lt;/form&gt;

// JavaScript
document.getElementById('patientForm').addEventListener('submit', async (e) => {
    e.preventDefault();

    const formData = {
        name: document.getElementById('name').value,
        phone: document.getElementById('phone').value
    };

    const result = await createPatient(formData);

    if (result.success) {
        alert('ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!');
        e.target.reset();  // í¼ ì´ˆê¸°í™”
        loadPatientTable();
    } else {
        alert('ì—ëŸ¬: ' + result.error);
    }
});</code></pre>

            <hr>

            <h2>API ëª¨ë“ˆí™”</h2>

            <p>API í˜¸ì¶œ í•¨ìˆ˜ë“¤ì„ í•˜ë‚˜ì˜ íŒŒì¼ë¡œ ì •ë¦¬í•©ë‹ˆë‹¤.</p>

            <pre><code>// static/js/api.js

const API = {
    // í™˜ì
    patients: {
        getAll: () => fetch('/api/patients').then(r => r.json()),
        get: (id) => fetch(`/api/patients/${id}`).then(r => r.json()),
        create: (data) => fetch('/api/patients', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        }).then(r => r.json()),
        update: (id, data) => fetch(`/api/patients/${id}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        }).then(r => r.json()),
        delete: (id) => fetch(`/api/patients/${id}`, {
            method: 'DELETE'
        }).then(r => r.json())
    },

    // ì˜ˆì•½
    reservations: {
        getAll: (params) => {
            const query = new URLSearchParams(params).toString();
            return fetch(`/api/reservations?${query}`).then(r => r.json());
        },
        create: (data) => fetch('/api/reservations', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        }).then(r => r.json())
    }
};</code></pre>

            <h3>ì‚¬ìš© ì˜ˆì‹œ</h3>
            <pre><code>// í™˜ì ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
const patients = await API.patients.getAll();

// ì˜ˆì•½ ì¡°íšŒ
const reservations = await API.reservations.getAll({
    start_date: '2024-12-01',
    end_date: '2024-12-07'
});</code></pre>

            <hr>

            <h2>ë¡œë”© í‘œì‹œ</h2>

            <pre><code>async function loadDataWithSpinner() {
    const spinner = document.getElementById('spinner');
    const content = document.getElementById('content');

    spinner.style.display = 'block';
    content.style.display = 'none';

    try {
        const data = await API.patients.getAll();
        // ë°ì´í„° í‘œì‹œ...
    } finally {
        spinner.style.display = 'none';
        content.style.display = 'block';
    }
}</code></pre>

            <hr>

            <h2>ì´ë²ˆ ì¥ ì •ë¦¬</h2>

            <ul>
                <li><code>fetch()</code>ë¡œ APIë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤</li>
                <li><code>async/await</code>ë¡œ ê¹”ë”í•˜ê²Œ ì‘ì„±í•©ë‹ˆë‹¤</li>
                <li>POST/PUTì€ <code>body</code>ì— JSONì„ ë‹´ìŠµë‹ˆë‹¤</li>
                <li>API í•¨ìˆ˜ë“¤ì„ ëª¨ë“ˆí™”í•˜ë©´ ê´€ë¦¬ê°€ í¸í•©ë‹ˆë‹¤</li>
            </ul>

            <blockquote>Part 4 ì™„ë£Œ! ë‹¤ìŒ Partì—ì„œëŠ” Luckysheetë¥¼ ì„¤ì¹˜í•˜ê³  ì‚¬ìš©í•©ë‹ˆë‹¤!</blockquote>

            <div class="nav-buttons">
                <button class="nav-btn" id="prevBtn">â† ì´ì „</button>
                <span class="page-num" id="pageNum"></span>
                <button class="nav-btn" id="nextBtn">ë‹¤ìŒ â†’</button>
            </div>
        </main>
    </div>
    <script src="../js/nav.js"></script>
</body>
</html>
