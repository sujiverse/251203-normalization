<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>20ì¥: ì…€ í¸ì§‘ ê°ì§€ - ë¬¼ë¦¬ì¹˜ë£Œì‚¬ë¥¼ ìœ„í•œ DB 4ê¶Œ</title>
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
    @@include('components/top-nav.html', {"root": "../..", "activeBook": "4"})

    @@include('components/mobile-menu.html')

    <div class="container">
        <nav class="sidebar" id="sidebar">
            <button class="close-btn" onclick="toggleMenu()">Ã—</button>
            <div class="sidebar-header">
                <h1>ğŸ“• ë¬¼ë¦¬ì¹˜ë£Œì‚¬ë¥¼ ìœ„í•œ</h1>
                <p>ì›¹ ì•± ë§Œë“¤ê¸° (4ê¶Œ)</p>
            </div>
            <ul class="nav-list" id="navList"></ul>
        </nav>

        <main class="main">
            <h1 class="title">ì…€ í¸ì§‘ ê°ì§€</h1>

            <h2>Luckysheet í›…(Hook)</h2>

            <p>LuckysheetëŠ” ë‹¤ì–‘í•œ ì´ë²¤íŠ¸ í›…ì„ ì œê³µí•©ë‹ˆë‹¤.</p>

            <table>
                <tr>
                    <th>í›… ì´ë¦„</th>
                    <th>ë°œìƒ ì‹œì </th>
                </tr>
                <tr>
                    <td>cellUpdated</td>
                    <td>ì…€ ê°’ ë³€ê²½ í›„</td>
                </tr>
                <tr>
                    <td>cellEditBefore</td>
                    <td>ì…€ í¸ì§‘ ì‹œì‘ ì „</td>
                </tr>
                <tr>
                    <td>cellEditAfter</td>
                    <td>ì…€ í¸ì§‘ ì™„ë£Œ í›„</td>
                </tr>
                <tr>
                    <td>cellMousedown</td>
                    <td>ì…€ í´ë¦­</td>
                </tr>
                <tr>
                    <td>cellDragStop</td>
                    <td>ë“œë˜ê·¸ ì™„ë£Œ</td>
                </tr>
            </table>

            <hr>

            <h2>í›… ë“±ë¡ ë°©ë²•</h2>

            <pre><code>luckysheet.create({
    container: 'luckysheet',
    data: [{ ... }],

    // í›… ì„¤ì •
    hook: {
        // ì…€ ì—…ë°ì´íŠ¸ í›„
        cellUpdated: function(row, column, oldValue, newValue, isRefresh) {
            console.log('ì…€ ì—…ë°ì´íŠ¸:', row, column, oldValue, '->', newValue);
        },

        // ì…€ í¸ì§‘ ì‹œì‘ ì „
        cellEditBefore: function(row, column) {
            console.log('í¸ì§‘ ì‹œì‘:', row, column);
            // false ë°˜í™˜í•˜ë©´ í¸ì§‘ ì·¨ì†Œ
            return true;
        },

        // ì…€ í´ë¦­
        cellMousedown: function(cell, position, sheet, ctx) {
            console.log('ì…€ í´ë¦­:', position.row, position.column);
        }
    }
});</code></pre>

            <hr>

            <h2>ì˜ˆì•½ ì…€ í¸ì§‘ ê°ì§€</h2>

            <pre><code>// ì…€ í¸ì§‘ ì™„ë£Œ ì‹œ ì²˜ë¦¬
function onCellUpdated(row, column, oldValue, newValue) {
    // í—¤ë” í–‰/ì—´ì€ ë¬´ì‹œ
    if (row === 0 || column === 0) return;

    // í™˜ì IDì™€ ë‚ ì§œ ê°€ì ¸ì˜¤ê¸°
    const { patients, dates } = window.sheetData;
    const patient = patients[row - 1];  // 1í–‰ë¶€í„° í™˜ì
    const date = dates[column - 1];      // 1ì—´ë¶€í„° ë‚ ì§œ

    if (!patient || !date) return;

    console.log(`ì˜ˆì•½ ë³€ê²½: ${patient.name}, ${date.date}, ${newValue}`);

    // API í˜¸ì¶œ (ë‹¤ìŒ ì¥ì—ì„œ êµ¬í˜„)
    saveReservation(patient.patient_id, date.date, newValue);
}

luckysheet.create({
    // ...
    hook: {
        cellUpdated: onCellUpdated
    }
});</code></pre>

            <hr>

            <h2>í¸ì§‘ ì œí•œí•˜ê¸°</h2>

            <pre><code>// íŠ¹ì • ì…€ë§Œ í¸ì§‘ ê°€ëŠ¥í•˜ê²Œ
function onCellEditBefore(row, column) {
    // í—¤ë” í–‰ (0í–‰) - í¸ì§‘ ë¶ˆê°€
    if (row === 0) {
        return false;
    }

    // í™˜ìëª… ì—´ (0ì—´) - í¸ì§‘ ë¶ˆê°€
    if (column === 0) {
        return false;
    }

    // ë‚˜ë¨¸ì§€ ì…€ì€ í¸ì§‘ ê°€ëŠ¥
    return true;
}

luckysheet.create({
    hook: {
        cellEditBefore: onCellEditBefore,
        cellUpdated: onCellUpdated
    }
});</code></pre>

            <hr>

            <h2>ì…€ í´ë¦­ìœ¼ë¡œ íŒì—… ì—´ê¸°</h2>

            <p>ì…€ì„ í´ë¦­í•˜ë©´ ì˜ˆì•½ ë“±ë¡/ìˆ˜ì • íŒì—…ì„ ì—½ë‹ˆë‹¤.</p>

            <pre><code>function onCellClick(cell, position) {
    const row = position.row;
    const column = position.column;

    // í—¤ë”ëŠ” ë¬´ì‹œ
    if (row === 0 || column === 0) return;

    const { patients, dates } = window.sheetData;
    const patient = patients[row - 1];
    const date = dates[column - 1];

    if (!patient || !date) return;

    // í˜„ì¬ ì…€ ê°’
    const cellData = luckysheet.getCellValue(row, column);

    // íŒì—… ì—´ê¸°
    openReservationModal({
        patient: patient,
        date: date,
        currentValue: cellData
    });
}

luckysheet.create({
    hook: {
        cellMousedown: onCellClick
    }
});</code></pre>

            <hr>

            <h2>ì˜ˆì•½ ëª¨ë‹¬ ì°½</h2>

            <pre><code>&lt;!-- ëª¨ë‹¬ HTML --&gt;
&lt;div id="reservationModal" class="modal" style="display:none;"&gt;
    &lt;div class="modal-content"&gt;
        &lt;h2&gt;ì˜ˆì•½ ë“±ë¡/ìˆ˜ì •&lt;/h2&gt;
        &lt;p id="modalInfo"&gt;&lt;/p&gt;

        &lt;div class="form-group"&gt;
            &lt;label&gt;ì‹œê°„&lt;/label&gt;
            &lt;select id="modalTime"&gt;
                &lt;option value=""&gt;ì„ íƒ&lt;/option&gt;
                &lt;option value="09:00"&gt;09:00&lt;/option&gt;
                &lt;option value="10:00"&gt;10:00&lt;/option&gt;
                &lt;option value="11:00"&gt;11:00&lt;/option&gt;
                &lt;option value="14:00"&gt;14:00&lt;/option&gt;
                &lt;option value="15:00"&gt;15:00&lt;/option&gt;
                &lt;option value="16:00"&gt;16:00&lt;/option&gt;
            &lt;/select&gt;
        &lt;/div&gt;

        &lt;div class="form-group"&gt;
            &lt;label&gt;ì¹˜ë£Œì‚¬&lt;/label&gt;
            &lt;select id="modalTherapist"&gt;&lt;/select&gt;
        &lt;/div&gt;

        &lt;div class="modal-buttons"&gt;
            &lt;button onclick="saveModal()"&gt;ì €ì¥&lt;/button&gt;
            &lt;button onclick="deleteReservation()"&gt;ì‚­ì œ&lt;/button&gt;
            &lt;button onclick="closeModal()"&gt;ì·¨ì†Œ&lt;/button&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;</code></pre>

            <pre><code>// JavaScript
let currentModalData = null;

function openReservationModal(data) {
    currentModalData = data;

    document.getElementById('modalInfo').textContent =
        `${data.patient.name} / ${data.date.display}`;

    // í˜„ì¬ ê°’ì´ ìˆìœ¼ë©´ ì±„ìš°ê¸°
    if (data.currentValue) {
        const [time, therapist] = data.currentValue.split('|');
        document.getElementById('modalTime').value = time || '';
        document.getElementById('modalTherapist').value = therapist || '';
    } else {
        document.getElementById('modalTime').value = '';
        document.getElementById('modalTherapist').value = '';
    }

    document.getElementById('reservationModal').style.display = 'flex';
}

function closeModal() {
    document.getElementById('reservationModal').style.display = 'none';
    currentModalData = null;
}

async function saveModal() {
    const time = document.getElementById('modalTime').value;
    const therapist = document.getElementById('modalTherapist').value;

    if (!time || !therapist) {
        alert('ì‹œê°„ê³¼ ì¹˜ë£Œì‚¬ë¥¼ ì„ íƒí•˜ì„¸ìš”');
        return;
    }

    // API í˜¸ì¶œ (ë‹¤ìŒ ì¥ì—ì„œ êµ¬í˜„)
    await saveReservation(
        currentModalData.patient.patient_id,
        currentModalData.date.date,
        time,
        therapist
    );

    closeModal();
    initSheet();  // ì‹œíŠ¸ ìƒˆë¡œê³ ì¹¨
}</code></pre>

            <hr>

            <h2>ì´ë²ˆ ì¥ ì •ë¦¬</h2>

            <ul>
                <li><code>hook</code> ì˜µì…˜ìœ¼ë¡œ ì…€ ì´ë²¤íŠ¸ë¥¼ ê°ì§€í•©ë‹ˆë‹¤</li>
                <li><code>cellUpdated</code>: ì…€ ê°’ ë³€ê²½ ê°ì§€</li>
                <li><code>cellEditBefore</code>: í¸ì§‘ ê°€ëŠ¥ ì—¬ë¶€ ì œì–´</li>
                <li><code>cellMousedown</code>: ì…€ í´ë¦­ ê°ì§€</li>
                <li>ëª¨ë‹¬ ì°½ìœ¼ë¡œ ìƒì„¸ ì…ë ¥ì„ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤</li>
            </ul>

            <blockquote>ë‹¤ìŒ ì¥ì—ì„œëŠ” í¸ì§‘ëœ ë‚´ìš©ì„ DBì— ì €ì¥í•©ë‹ˆë‹¤!</blockquote>

            <div class="nav-buttons">
                <button class="nav-btn" id="prevBtn">â† ì´ì „</button>
                <span class="page-num" id="pageNum"></span>
                <button class="nav-btn" id="nextBtn">ë‹¤ìŒ â†’</button>
            </div>
        </main>
    </div>
    <script src="../js/nav.js"></script>
</body>
</html>
