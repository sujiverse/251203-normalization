<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>27장: 로컬 네트워크 배포 - 물리치료사를 위한 DB 4권</title>
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
    @@include('components/top-nav.html', {"root": "../..", "activeBook": "4"})

    @@include('components/mobile-menu.html')

    <div class="container">
        <nav class="sidebar" id="sidebar">
            <button class="close-btn" onclick="toggleMenu()">×</button>
            <div class="sidebar-header">
                <h1>📕 물리치료사를 위한</h1>
                <p>웹 앱 만들기 (4권)</p>
            </div>
            <ul class="nav-list" id="navList"></ul>
        </nav>

        <main class="main">
            <h1 class="title">로컬 네트워크 배포</h1>

            <h2>배포 목표</h2>

            <p>클리닉 내 다른 컴퓨터에서도 접속할 수 있게 합니다.</p>

            <pre class="file-tree">┌─────────────────────────────────────────────────────┐
│                    클리닉 네트워크                   │
│                                                     │
│   ┌─────────┐      ┌─────────┐      ┌─────────┐   │
│   │ 서버 PC │      │ 접수대  │      │ 치료실  │   │
│   │ (Flask) │◄────►│ 컴퓨터  │      │ 태블릿  │   │
│   │ MySQL   │      │         │      │         │   │
│   └─────────┘      └─────────┘      └─────────┘   │
│       ↑                ↑                 ↑        │
│       └────────────────┴─────────────────┘        │
│                  같은 공유기 연결                   │
└─────────────────────────────────────────────────────┘</pre>

            <hr>

            <h2>1. 서버 IP 주소 확인</h2>

            <pre><code># Windows
ipconfig

# 결과에서 IPv4 주소 확인
이더넷 어댑터:
   IPv4 주소 . . . . . . . : 192.168.0.10  ← 이 주소!


# Mac/Linux
ifconfig
# 또는
ip addr</code></pre>

            <hr>

            <h2>2. Flask를 모든 IP에서 접근 가능하게</h2>

            <pre><code># app.py

if __name__ == '__main__':
    app.run(
        host='0.0.0.0',  # 모든 IP에서 접근 허용
        port=5000,
        debug=False      # 배포 시 반드시 False
    )</code></pre>

            <div class="warning"><strong>⚠️ 중요</strong><br>
            - <code>host='0.0.0.0'</code>: 모든 네트워크 인터페이스에서 접속 허용<br>
            - <code>debug=False</code>: 보안을 위해 디버그 모드 끄기</div>

            <hr>

            <h2>3. Windows 방화벽 설정</h2>

            <pre><code>1. Windows 검색 → "방화벽" → "고급 설정"

2. "인바운드 규칙" → "새 규칙"

3. 규칙 유형: 포트
   프로토콜: TCP
   포트: 5000

4. 연결 허용

5. 프로필: 모두 선택 (도메인, 개인, 공용)

6. 이름: "Flask Server" 입력</code></pre>

            <hr>

            <h2>4. 다른 PC에서 접속</h2>

            <pre><code>브라우저에서:
http://192.168.0.10:5000

(192.168.0.10은 서버 PC의 IP 주소)</code></pre>

            <hr>

            <h2>5. 고정 IP 설정 (권장)</h2>

            <p>서버 IP가 바뀌면 접속 주소도 바뀝니다. 고정 IP를 설정하세요.</p>

            <pre><code>1. 네트워크 설정 → 이더넷 → 속성

2. IPv4 속성 → "다음 IP 주소 사용"
   - IP 주소: 192.168.0.100
   - 서브넷: 255.255.255.0
   - 게이트웨이: 192.168.0.1 (공유기 주소)
   - DNS: 8.8.8.8

3. 확인</code></pre>

            <hr>

            <h2>프로덕션 서버 (Waitress)</h2>

            <p>Flask 내장 서버는 개발용입니다. 실제 운영에는 WSGI 서버를 사용합니다.</p>

            <pre><code># Waitress 설치
pip install waitress

# run_server.py
from waitress import serve
from app import app

if __name__ == '__main__':
    print("서버 시작: http://0.0.0.0:5000")
    serve(app, host='0.0.0.0', port=5000)


# 실행
python run_server.py</code></pre>

            <h3>Waitress 장점</h3>
            <ul>
                <li>Windows에서 잘 동작</li>
                <li>멀티스레드 지원</li>
                <li>안정적</li>
            </ul>

            <hr>

            <h2>자동 시작 설정</h2>

            <h3>Windows 작업 스케줄러</h3>

            <pre><code>1. "작업 스케줄러" 열기

2. "기본 작업 만들기"
   - 이름: HealingHands Server

3. 트리거: 컴퓨터 시작 시

4. 동작: 프로그램 시작
   - 프로그램: python
   - 인수: C:\healing_hands\run_server.py
   - 시작 위치: C:\healing_hands

5. 완료</code></pre>

            <h3>배치 파일로 실행</h3>

            <pre><code>:: start_server.bat
@echo off
cd C:\healing_hands
python run_server.py

:: 또는 가상환경 사용 시
cd C:\healing_hands
call venv\Scripts\activate
python run_server.py</code></pre>

            <hr>

            <h2>MySQL 원격 접속 설정</h2>

            <p>다른 PC에서 MySQL에 직접 접속하려면:</p>

            <pre><code>-- MySQL에서 실행
CREATE USER 'healing_user'@'192.168.0.%' IDENTIFIED BY 'password';
GRANT ALL PRIVILEGES ON healing_hands.* TO 'healing_user'@'192.168.0.%';
FLUSH PRIVILEGES;

-- 192.168.0.% = 같은 네트워크의 모든 PC</code></pre>

            <div class="tip"><strong>💡 보통은 불필요</strong><br>
            Flask 서버가 MySQL과 같은 PC에 있다면 원격 접속 설정은 필요 없습니다. Flask API를 통해 접근하면 됩니다.</div>

            <hr>

            <h2>트러블슈팅</h2>

            <table>
                <tr>
                    <th>문제</th>
                    <th>해결</th>
                </tr>
                <tr>
                    <td>접속 안 됨</td>
                    <td>방화벽 5000 포트 확인</td>
                </tr>
                <tr>
                    <td>IP가 계속 바뀜</td>
                    <td>고정 IP 설정</td>
                </tr>
                <tr>
                    <td>컴퓨터 끄면 서버 종료</td>
                    <td>자동 시작 설정</td>
                </tr>
                <tr>
                    <td>느림</td>
                    <td>Waitress 사용, 인덱스 확인</td>
                </tr>
                <tr>
                    <td>연결이 끊김</td>
                    <td>네트워크 안정성 확인</td>
                </tr>
            </table>

            <hr>

            <h2>접속 URL 쉽게 기억하기</h2>

            <pre><code># 1. 호스트 파일 수정 (각 PC에서)

# Windows: C:\Windows\System32\drivers\etc\hosts
# 관리자 권한으로 메모장 열기

192.168.0.100    healing.local

# 이제 브라우저에서:
http://healing.local:5000


# 2. 또는 바탕화면에 바로가기 만들기
대상: http://192.168.0.100:5000</code></pre>

            <hr>

            <h2>이번 장 정리</h2>

            <ul>
                <li><code>host='0.0.0.0'</code>: 모든 IP에서 접근 허용</li>
                <li>방화벽에서 5000 포트 열기</li>
                <li>고정 IP 설정으로 주소 고정</li>
                <li>Waitress로 안정적인 서버 운영</li>
                <li>작업 스케줄러로 자동 시작</li>
            </ul>

            <blockquote>다음 장에서는 보안 체크리스트를 확인합니다!</blockquote>

            <div class="nav-buttons">
                <button class="nav-btn" id="prevBtn">← 이전</button>
                <span class="page-num" id="pageNum"></span>
                <button class="nav-btn" id="nextBtn">다음 →</button>
            </div>
        </main>
    </div>
    <script src="../js/nav.js"></script>
</body>
</html>
