<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>18ì¥: ì—´/í–‰ ê³ ì • ì„¤ì • - ë¬¼ë¦¬ì¹˜ë£Œì‚¬ë¥¼ ìœ„í•œ DB 4ê¶Œ</title>
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
    @@include('components/top-nav.html', {"root": "../..", "activeBook": "4"})

    @@include('components/mobile-menu.html')

    <div class="container">
        <nav class="sidebar" id="sidebar">
            <button class="close-btn" onclick="toggleMenu()">Ã—</button>
            <div class="sidebar-header">
                <h1>ğŸ“• ë¬¼ë¦¬ì¹˜ë£Œì‚¬ë¥¼ ìœ„í•œ</h1>
                <p>ì›¹ ì•± ë§Œë“¤ê¸° (4ê¶Œ)</p>
            </div>
            <ul class="nav-list" id="navList"></ul>
        </nav>

        <main class="main">
            <h1 class="title">ì—´/í–‰ ê³ ì • ì„¤ì •</h1>

            <h2>ê³ ì •(Freeze)ì´ë€?</h2>

            <p>ìŠ¤í¬ë¡¤í•´ë„ íŠ¹ì • í–‰ì´ë‚˜ ì—´ì´ í•­ìƒ ë³´ì´ë„ë¡ ê³ ì •í•˜ëŠ” ê¸°ëŠ¥ì…ë‹ˆë‹¤.</p>

            <ul>
                <li><strong>ì²« í–‰ ê³ ì •</strong>: ë‚ ì§œ í—¤ë”ê°€ í•­ìƒ ë³´ì„</li>
                <li><strong>ì²« ì—´ ê³ ì •</strong>: í™˜ìëª…ì´ í•­ìƒ ë³´ì„</li>
            </ul>

            <hr>

            <h2>Luckysheet ê³ ì • ì„¤ì •</h2>

            <pre><code>luckysheet.create({
    container: 'luckysheet',
    data: [{
        name: 'ì˜ˆì•½',
        celldata: celldata,

        // ê³ ì • ì„¤ì •
        frozen: {
            type: 'rangeBoth',  // í–‰ê³¼ ì—´ ëª¨ë‘ ê³ ì •

            range: {
                row_focus: 0,    // 0í–‰ê¹Œì§€ ê³ ì • (ì²« í–‰)
                column_focus: 0  // 0ì—´ê¹Œì§€ ê³ ì • (ì²« ì—´)
            }
        }
    }]
});</code></pre>

            <h3>ê³ ì • íƒ€ì…</h3>
            <table>
                <tr>
                    <th>type</th>
                    <th>ì„¤ëª…</th>
                </tr>
                <tr>
                    <td>row</td>
                    <td>í–‰ë§Œ ê³ ì •</td>
                </tr>
                <tr>
                    <td>column</td>
                    <td>ì—´ë§Œ ê³ ì •</td>
                </tr>
                <tr>
                    <td>both</td>
                    <td>í–‰ê³¼ ì—´ ëª¨ë‘ ê³ ì •</td>
                </tr>
                <tr>
                    <td>rangeRow</td>
                    <td>ì§€ì • ë²”ìœ„ í–‰ ê³ ì •</td>
                </tr>
                <tr>
                    <td>rangeColumn</td>
                    <td>ì§€ì • ë²”ìœ„ ì—´ ê³ ì •</td>
                </tr>
                <tr>
                    <td>rangeBoth</td>
                    <td>ì§€ì • ë²”ìœ„ í–‰+ì—´ ê³ ì •</td>
                </tr>
            </table>

            <hr>

            <h2>ì™„ì„±ëœ ì‹œíŠ¸ ì„¤ì •</h2>

            <pre><code>async function initReservationSheet() {
    // ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
    const today = new Date().toISOString().split('T')[0];
    const dates = getDateRange(today, 30);  // 30ì¼ê°„

    const startDate = dates[0].date;
    const endDate = dates[dates.length - 1].date;

    const [patientsRes, reservationsRes] = await Promise.all([
        fetch('/api/patients').then(r => r.json()),
        fetch(`/api/reservations/sheet?start_date=${startDate}&end_date=${endDate}`)
            .then(r => r.json())
    ]);

    const patients = patientsRes.data;
    const reservations = reservationsRes.reservations;

    // ì…€ ë°ì´í„° ìƒì„±
    let celldata = [
        ...createHeaderRow(dates),
        ...createPatientRows(patients),
        ...createReservationCells(patients, dates, reservations)
    ];

    // Luckysheet ìƒì„±
    luckysheet.create({
        container: 'luckysheet',
        title: 'ì˜ˆì•½ í˜„í™©',
        lang: 'ko',

        // íˆ´ë°” ê°„ì†Œí™”
        showtoolbar: false,
        showsheetbar: false,
        showstatisticBar: false,

        // í¸ì§‘ ì„¤ì •
        allowEdit: true,
        enableAddRow: false,
        enableAddBackTop: false,

        data: [{
            name: 'ì˜ˆì•½',
            celldata: celldata,
            row: patients.length + 1,
            column: dates.length + 1,

            // â˜… ê³ ì • ì„¤ì •
            frozen: {
                type: 'rangeBoth',
                range: {
                    row_focus: 0,     // ì²« í–‰ (ë‚ ì§œ) ê³ ì •
                    column_focus: 0   // ì²« ì—´ (í™˜ìëª…) ê³ ì •
                }
            },

            // ì—´ ë„ˆë¹„
            config: {
                columnlen: {
                    0: 100  // ì²« ì—´ (í™˜ìëª…) ë„ˆë¹„
                }
            }
        }]
    });
}</code></pre>

            <hr>

            <h2>ìŠ¤í¬ë¡¤ í…ŒìŠ¤íŠ¸</h2>

            <p>ê°€ë¡œ/ì„¸ë¡œë¡œ ìŠ¤í¬ë¡¤í•´ë„:</p>
            <ul>
                <li>âœ… ì²« í–‰(ë‚ ì§œ)ì´ í•­ìƒ ë³´ì„</li>
                <li>âœ… ì²« ì—´(í™˜ìëª…)ì´ í•­ìƒ ë³´ì„</li>
            </ul>

            <div class="tip"><strong>ğŸ’¡ 30ì¼ ì´ìƒ í‘œì‹œí•˜ë ¤ë©´?</strong><br>
            ë‚ ì§œ ë²”ìœ„ë¥¼ ëŠ˜ë¦¬ë©´ ë©ë‹ˆë‹¤. ê°€ë¡œ ìŠ¤í¬ë¡¤ë¡œ ëª¨ë“  ë‚ ì§œë¥¼ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‹¤ë§Œ ë°ì´í„°ê°€ ë§ì•„ì§€ë©´ ë¡œë”©ì´ ëŠë ¤ì§ˆ ìˆ˜ ìˆìœ¼ë‹ˆ ì ì ˆí•œ ë²”ìœ„ë¥¼ ì„¤ì •í•˜ì„¸ìš”.</div>

            <hr>

            <h2>ë‚ ì§œ ë²”ìœ„ ì»¨íŠ¸ë¡¤ ì¶”ê°€</h2>

            <pre><code>&lt;!-- HTML --&gt;
&lt;div class="date-control"&gt;
    &lt;label&gt;ì‹œì‘ì¼&lt;/label&gt;
    &lt;input type="date" id="startDate"&gt;

    &lt;label&gt;ê¸°ê°„&lt;/label&gt;
    &lt;select id="dateRange"&gt;
        &lt;option value="7"&gt;1ì£¼ì¼&lt;/option&gt;
        &lt;option value="14" selected&gt;2ì£¼ì¼&lt;/option&gt;
        &lt;option value="30"&gt;1ê°œì›”&lt;/option&gt;
    &lt;/select&gt;

    &lt;button onclick="reloadSheet()"&gt;ì ìš©&lt;/button&gt;
&lt;/div&gt;

// JavaScript
async function reloadSheet() {
    const startDate = document.getElementById('startDate').value;
    const days = parseInt(document.getElementById('dateRange').value);

    // ê¸°ì¡´ ì‹œíŠ¸ ì œê±°
    luckysheet.destroy();

    // ìƒˆë¡œ ìƒì„±
    await initReservationSheet(startDate, days);
}</code></pre>

            <hr>

            <h2>í˜„ì¬ ë‚ ì§œë¡œ ì´ë™</h2>

            <pre><code>// ì˜¤ëŠ˜ ë‚ ì§œ ì—´ë¡œ ìŠ¤í¬ë¡¤
function scrollToToday(dates) {
    const today = new Date().toISOString().split('T')[0];
    const todayIndex = dates.findIndex(d => d.date === today);

    if (todayIndex > 0) {
        // í•´ë‹¹ ì…€ë¡œ í¬ì»¤ìŠ¤ ì´ë™
        luckysheet.setRangeShow({
            row: [1, 1],
            column: [todayIndex + 1, todayIndex + 1]
        });
    }
}

// ì‹œíŠ¸ ìƒì„± í›„ í˜¸ì¶œ
luckysheet.create({ ... });
setTimeout(() => scrollToToday(dates), 500);</code></pre>

            <hr>

            <h2>ì™„ì„±ëœ ëª¨ìŠµ</h2>

            <pre class="file-tree">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [ì‹œì‘ì¼: 2024-12-01]  [ê¸°ê°„: 2ì£¼ì¼ â–¼]  [ì ìš©]  [ì˜¤ëŠ˜ë¡œ ì´ë™]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ì¹˜ë£Œì‚¬: â– ê¹€ì¹˜ë£Œ  â– ì´ì¹˜ë£Œ  â– ë°•ì¹˜ë£Œ                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”‚
â”‚ í™˜ìëª…    â”‚ 12/1   â”‚ 12/2   â”‚ 12/3   â”‚ 12/4   â”‚ 12/5   â”‚ ... â”‚
â”‚          â”‚ (ì›”)   â”‚ (í™”)   â”‚ (ìˆ˜)   â”‚ (ëª©)   â”‚ (ê¸ˆ)   â”‚     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”‚
â”‚ ê¹€ì² ìˆ˜    â”‚ 10:00  â”‚        â”‚ 14:00  â”‚        â”‚ 11:00  â”‚     â”‚
â”‚ ì´ì˜í¬    â”‚        â”‚ 11:00  â”‚        â”‚ 10:00  â”‚        â”‚     â”‚
â”‚ ë°•ë¯¼ìˆ˜    â”‚ 15:00  â”‚ 15:00  â”‚        â”‚ 16:00  â”‚        â”‚     â”‚
â”‚ ...      â”‚        â”‚        â”‚        â”‚        â”‚        â”‚     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜
   â†‘ ê³ ì •          â†’ ê°€ë¡œ ìŠ¤í¬ë¡¤ â†’</pre>

            <hr>

            <h2>ì´ë²ˆ ì¥ ì •ë¦¬</h2>

            <ul>
                <li><code>frozen</code> ì˜µì…˜ìœ¼ë¡œ í–‰/ì—´ì„ ê³ ì •í•©ë‹ˆë‹¤</li>
                <li><code>rangeBoth</code>ë¡œ ì²« í–‰ê³¼ ì²« ì—´ì„ ë™ì‹œì— ê³ ì •í•©ë‹ˆë‹¤</li>
                <li>ë‚ ì§œ ë²”ìœ„ ì»¨íŠ¸ë¡¤ë¡œ í‘œì‹œ ê¸°ê°„ì„ ì¡°ì ˆí•©ë‹ˆë‹¤</li>
            </ul>

            <blockquote>ë‹¤ìŒ ì¥ì—ì„œëŠ” DB ë°ì´í„°ë¥¼ Luckysheetì— í‘œì‹œí•˜ëŠ” ì „ì²´ íë¦„ì„ ì •ë¦¬í•©ë‹ˆë‹¤!</blockquote>

            <div class="nav-buttons">
                <button class="nav-btn" id="prevBtn">â† ì´ì „</button>
                <span class="page-num" id="pageNum"></span>
                <button class="nav-btn" id="nextBtn">ë‹¤ìŒ â†’</button>
            </div>
        </main>
    </div>
    <script src="../js/nav.js"></script>
</body>
</html>
