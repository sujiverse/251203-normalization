<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>28ì¥: ë³´ì•ˆ ì²´í¬ë¦¬ìŠ¤íŠ¸ - ë¬¼ë¦¬ì¹˜ë£Œì‚¬ë¥¼ ìœ„í•œ DB 4ê¶Œ</title>
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
    @@include('components/top-nav.html', {"root": "../..", "activeBook": "4"})

    @@include('components/mobile-menu.html')

    <div class="container">
        <nav class="sidebar" id="sidebar">
            <button class="close-btn" onclick="toggleMenu()">Ã—</button>
            <div class="sidebar-header">
                <h1>ğŸ“• ë¬¼ë¦¬ì¹˜ë£Œì‚¬ë¥¼ ìœ„í•œ</h1>
                <p>ì›¹ ì•± ë§Œë“¤ê¸° (4ê¶Œ)</p>
            </div>
            <ul class="nav-list" id="navList"></ul>
        </nav>

        <main class="main">
            <h1 class="title">ë³´ì•ˆ ì²´í¬ë¦¬ìŠ¤íŠ¸</h1>

            <h2>ì™œ ë³´ì•ˆì´ ì¤‘ìš”í•œê°€?</h2>

            <ul>
                <li><strong>í™˜ì ê°œì¸ì •ë³´</strong>: ë²•ì  ë³´í˜¸ ëŒ€ìƒ</li>
                <li><strong>ì˜ë£Œ ì •ë³´</strong>: ë¯¼ê° ì •ë³´</li>
                <li><strong>ì‹ ë¢°</strong>: í™˜ìì˜ ì‹ ë¢°ë¥¼ ì§€ì¼œì•¼ í•¨</li>
            </ul>

            <hr>

            <h2>í•„ìˆ˜ ë³´ì•ˆ ì²´í¬ë¦¬ìŠ¤íŠ¸</h2>

            <h3>1. ë¹„ë°€ë²ˆí˜¸ ë³´ì•ˆ</h3>

            <table>
                <tr>
                    <th>í•­ëª©</th>
                    <th>í™•ì¸</th>
                </tr>
                <tr>
                    <td>ë¹„ë°€ë²ˆí˜¸ í•´ì‹œ ì €ì¥</td>
                    <td>â˜ generate_password_hash ì‚¬ìš©</td>
                </tr>
                <tr>
                    <td>ìµœì†Œ 8ì ì´ìƒ ìš”êµ¬</td>
                    <td>â˜ ê¸¸ì´ ê²€ì¦ ì¶”ê°€</td>
                </tr>
                <tr>
                    <td>ê¸°ë³¸ ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</td>
                    <td>â˜ admin123 ë“± ë³€ê²½</td>
                </tr>
            </table>

            <pre><code># ë¹„ë°€ë²ˆí˜¸ ê²€ì¦
def validate_password(password):
    if len(password) < 8:
        return False, "8ì ì´ìƒ ì…ë ¥í•˜ì„¸ìš”"
    if not any(c.isdigit() for c in password):
        return False, "ìˆ«ìë¥¼ í¬í•¨í•˜ì„¸ìš”"
    return True, "OK"</code></pre>

            <hr>

            <h3>2. SQL ì¸ì ì…˜ ë°©ì§€</h3>

            <pre><code># âŒ ìœ„í—˜í•œ ì½”ë“œ
cursor.execute(f"SELECT * FROM patients WHERE name = '{name}'")

# âœ… ì•ˆì „í•œ ì½”ë“œ (íŒŒë¼ë¯¸í„° ë°”ì¸ë”©)
cursor.execute("SELECT * FROM patients WHERE name = %s", (name,))</code></pre>

            <div class="warning"><strong>âš ï¸ ì ˆëŒ€ ê¸ˆì§€</strong><br>
            ì‚¬ìš©ì ì…ë ¥ì„ ì§ì ‘ SQL ë¬¸ìì—´ì— ë„£ì§€ ë§ˆì„¸ìš”!</div>

            <hr>

            <h3>3. XSS ë°©ì§€</h3>

            <pre><code># Jinja2ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ì´ìŠ¤ì¼€ì´í”„ ì ìš©
{{ user_input }}  â† ìë™ìœ¼ë¡œ &lt;script&gt; ë“± ì´ìŠ¤ì¼€ì´í”„

# ì£¼ì˜: |safe í•„í„°ëŠ” ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ë°ì´í„°ë§Œ
{{ trusted_html|safe }}  â† ì‚¬ìš©ì ì…ë ¥ì—ëŠ” ì ˆëŒ€ ì“°ì§€ ë§ˆì„¸ìš”</code></pre>

            <pre><code>// JavaScriptì—ì„œë„ ì£¼ì˜
// âŒ ìœ„í—˜
element.innerHTML = userInput;

// âœ… ì•ˆì „
element.textContent = userInput;</code></pre>

            <hr>

            <h3>4. ì„¸ì…˜ ë³´ì•ˆ</h3>

            <pre><code># app.py

import os

app.secret_key = os.environ.get('SECRET_KEY')  # í™˜ê²½ë³€ìˆ˜ì—ì„œ ì½ê¸°

# ì„¸ì…˜ ì„¤ì •
app.config.update(
    SESSION_COOKIE_SECURE=True,      # HTTPSì—ì„œë§Œ ì¿ í‚¤ ì „ì†¡
    SESSION_COOKIE_HTTPONLY=True,    # JavaScriptì—ì„œ ì¿ í‚¤ ì ‘ê·¼ ë¶ˆê°€
    SESSION_COOKIE_SAMESITE='Lax'    # CSRF ë°©ì§€
)</code></pre>

            <hr>

            <h3>5. ì ‘ê·¼ ê¶Œí•œ í™•ì¸</h3>

            <pre><code># ëª¨ë“  APIì—ì„œ ê¶Œí•œ í™•ì¸

@app.route('/api/patients/&lt;int:patient_id&gt;')
@login_required
def get_patient(patient_id):
    # ê¶Œí•œ í™•ì¸
    if session['role'] not in ['admin', 'therapist']:
        return jsonify({'error': 'ê¶Œí•œ ì—†ìŒ'}), 403

    # ...


# ìì‹ ì˜ ë°ì´í„°ë§Œ ìˆ˜ì • ê°€ëŠ¥
@app.route('/api/users/&lt;int:user_id&gt;', methods=['PUT'])
@login_required
def update_user(user_id):
    # ë³¸ì¸ ë˜ëŠ” ê´€ë¦¬ìë§Œ
    if session['user_id'] != user_id and session['role'] != 'admin':
        return jsonify({'error': 'ê¶Œí•œ ì—†ìŒ'}), 403

    # ...</code></pre>

            <hr>

            <h3>6. í™˜ê²½ë³€ìˆ˜ ê´€ë¦¬</h3>

            <pre><code># .env íŒŒì¼ (ì ˆëŒ€ gitì— ì˜¬ë¦¬ì§€ ë§ˆì„¸ìš”!)
SECRET_KEY=your-super-secret-key-here
DB_PASSWORD=database-password
DB_HOST=localhost

# .gitignore
.env
*.pyc
__pycache__/

# ì‚¬ìš©ë²•
from dotenv import load_dotenv
import os

load_dotenv()

app.secret_key = os.getenv('SECRET_KEY')
db_password = os.getenv('DB_PASSWORD')</code></pre>

            <hr>

            <h3>7. ì—ëŸ¬ ë©”ì‹œì§€</h3>

            <pre><code># ìš´ì˜ í™˜ê²½ì—ì„œëŠ” ìƒì„¸ ì—ëŸ¬ ìˆ¨ê¸°ê¸°

@app.errorhandler(500)
def internal_error(error):
    # ë¡œê·¸ì—ëŠ” ìƒì„¸ ì •ë³´ ê¸°ë¡
    app.logger.error(f'ì„œë²„ ì˜¤ë¥˜: {error}')

    # ì‚¬ìš©ìì—ê²ŒëŠ” ì¼ë°˜ ë©”ì‹œì§€ë§Œ
    return jsonify({'error': 'ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤'}), 500


# DEBUG ëª¨ë“œ ë„ê¸°
app.run(debug=False)</code></pre>

            <hr>

            <h3>8. ì…ë ¥ê°’ ê²€ì¦</h3>

            <pre><code># ëª¨ë“  ì…ë ¥ê°’ ê²€ì¦

@app.route('/api/patients', methods=['POST'])
@login_required
def create_patient():
    data = request.get_json()

    # í•„ìˆ˜ í•„ë“œ í™•ì¸
    name = data.get('name', '').strip()
    if not name:
        return jsonify({'error': 'ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”'}), 400

    if len(name) > 100:
        return jsonify({'error': 'ì´ë¦„ì´ ë„ˆë¬´ ê¹ë‹ˆë‹¤'}), 400

    # ì „í™”ë²ˆí˜¸ í˜•ì‹ í™•ì¸
    phone = data.get('phone', '')
    if phone and not re.match(r'^010-\d{4}-\d{4}$', phone):
        return jsonify({'error': 'ì „í™”ë²ˆí˜¸ í˜•ì‹ ì˜¤ë¥˜'}), 400

    # ë‚ ì§œ í˜•ì‹ í™•ì¸
    birth_date = data.get('birth_date')
    if birth_date:
        try:
            datetime.strptime(birth_date, '%Y-%m-%d')
        except ValueError:
            return jsonify({'error': 'ë‚ ì§œ í˜•ì‹ ì˜¤ë¥˜'}), 400

    # ...</code></pre>

            <hr>

            <h3>9. ë°±ì—…</h3>

            <pre><code># ì •ê¸° ë°±ì—… ìŠ¤í¬ë¦½íŠ¸ (backup.bat)
@echo off
set DATE=%date:~0,4%%date:~5,2%%date:~8,2%
set BACKUP_DIR=C:\backup

mysqldump -u root -p healing_hands > %BACKUP_DIR%\healing_hands_%DATE%.sql

echo ë°±ì—… ì™„ë£Œ: healing_hands_%DATE%.sql


# ìë™ ë°±ì—… (ì‘ì—… ìŠ¤ì¼€ì¤„ëŸ¬ë¡œ ë§¤ì¼ ì‹¤í–‰)</code></pre>

            <hr>

            <h3>10. ë¡œê¹…</h3>

            <pre><code>import logging
from datetime import datetime

# ë¡œê·¸ ì„¤ì •
logging.basicConfig(
    filename='app.log',
    level=logging.INFO,
    format='%(asctime)s - %(levelname)s - %(message)s'
)

# ì¤‘ìš” ì‘ì—… ë¡œê¹…
@app.route('/api/patients/&lt;int:patient_id&gt;', methods=['DELETE'])
@admin_required
def delete_patient(patient_id):
    logging.info(f"í™˜ì ì‚­ì œ: {patient_id}, ì‚­ì œì: {session['username']}")
    # ...

# ë¡œê·¸ì¸ ì‹œë„ ê¸°ë¡
@app.route('/login', methods=['POST'])
def login():
    username = request.form.get('username')

    # ì‹¤íŒ¨ ì‹œ
    logging.warning(f"ë¡œê·¸ì¸ ì‹¤íŒ¨: {username}, IP: {request.remote_addr}")

    # ì„±ê³µ ì‹œ
    logging.info(f"ë¡œê·¸ì¸ ì„±ê³µ: {username}")</code></pre>

            <hr>

            <h2>ë³´ì•ˆ ì²´í¬ë¦¬ìŠ¤íŠ¸ ìš”ì•½</h2>

            <table>
                <tr>
                    <th>ë¶„ë¥˜</th>
                    <th>í•­ëª©</th>
                    <th>í™•ì¸</th>
                </tr>
                <tr>
                    <td rowspan="3">ì¸ì¦</td>
                    <td>ë¹„ë°€ë²ˆí˜¸ í•´ì‹œ ì €ì¥</td>
                    <td>â˜</td>
                </tr>
                <tr>
                    <td>ì„¸ì…˜ íƒ€ì„ì•„ì›ƒ ì„¤ì •</td>
                    <td>â˜</td>
                </tr>
                <tr>
                    <td>ë¡œê·¸ì¸ ì‹¤íŒ¨ ì œí•œ</td>
                    <td>â˜</td>
                </tr>
                <tr>
                    <td rowspan="2">ì…ë ¥</td>
                    <td>SQL íŒŒë¼ë¯¸í„° ë°”ì¸ë”©</td>
                    <td>â˜</td>
                </tr>
                <tr>
                    <td>ì…ë ¥ê°’ ê²€ì¦</td>
                    <td>â˜</td>
                </tr>
                <tr>
                    <td rowspan="2">ì¶œë ¥</td>
                    <td>XSS ë°©ì§€ (ì´ìŠ¤ì¼€ì´í”„)</td>
                    <td>â˜</td>
                </tr>
                <tr>
                    <td>ì—ëŸ¬ ë©”ì‹œì§€ ìˆ¨ê¹€</td>
                    <td>â˜</td>
                </tr>
                <tr>
                    <td rowspan="2">ì„¤ì •</td>
                    <td>DEBUG ëª¨ë“œ ë„ê¸°</td>
                    <td>â˜</td>
                </tr>
                <tr>
                    <td>í™˜ê²½ë³€ìˆ˜ë¡œ ë¹„ë°€ ê´€ë¦¬</td>
                    <td>â˜</td>
                </tr>
                <tr>
                    <td rowspan="2">ìš´ì˜</td>
                    <td>ì •ê¸° ë°±ì—…</td>
                    <td>â˜</td>
                </tr>
                <tr>
                    <td>ë¡œê·¸ ê¸°ë¡</td>
                    <td>â˜</td>
                </tr>
            </table>

            <hr>

            <h2>ì´ë²ˆ ì¥ ì •ë¦¬</h2>

            <ul>
                <li><strong>ë¹„ë°€ë²ˆí˜¸</strong>: ë°˜ë“œì‹œ í•´ì‹œë¡œ ì €ì¥</li>
                <li><strong>SQL</strong>: íŒŒë¼ë¯¸í„° ë°”ì¸ë”© í•„ìˆ˜</li>
                <li><strong>XSS</strong>: ì‚¬ìš©ì ì…ë ¥ ì´ìŠ¤ì¼€ì´í”„</li>
                <li><strong>ê¶Œí•œ</strong>: ëª¨ë“  APIì—ì„œ ê¶Œí•œ í™•ì¸</li>
                <li><strong>í™˜ê²½ë³€ìˆ˜</strong>: ë¹„ë°€ ì •ë³´ëŠ” ì½”ë“œì— ë„£ì§€ ì•Šê¸°</li>
                <li><strong>ë°±ì—…</strong>: ì •ê¸°ì ìœ¼ë¡œ ë°ì´í„° ë°±ì—…</li>
            </ul>

            <blockquote>ë‹¤ìŒ ì¥ì—ì„œëŠ” ìµœì¢… ì™„ì„±ê³¼ ìš´ì˜ ê°€ì´ë“œì…ë‹ˆë‹¤!</blockquote>

            <div class="nav-buttons">
                <button class="nav-btn" id="prevBtn">â† ì´ì „</button>
                <span class="page-num" id="pageNum"></span>
                <button class="nav-btn" id="nextBtn">ë‹¤ìŒ â†’</button>
            </div>
        </main>
    </div>
    <script src="../js/nav.js"></script>
</body>
</html>
