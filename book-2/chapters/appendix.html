<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¶€ë¡: ì¿¼ë¦¬ ë ˆì‹œí”¼ë¶ - ë¬¼ë¦¬ì¹˜ë£Œì‚¬ë¥¼ ìœ„í•œ DB 2ê¶Œ</title>
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
    <nav class="top-nav">
        <a href="../../index.html" class="top-nav-brand"><span>ğŸ¥</span> DB ì™„ì „ì •ë³µ</a>
        <div class="top-nav-links">
            <a href="../../book-1/index.html" class="top-nav-link book-1">1ê¶Œ</a>
            <a href="../../book-2/index.html" class="top-nav-link book-2 active">2ê¶Œ</a>
            <a href="../../book-3/index.html" class="top-nav-link book-3">3ê¶Œ</a>
            <a href="../../book-4/index.html" class="top-nav-link book-4">4ê¶Œ</a>
            <a href="../../book-5/index.html" class="top-nav-link book-5">5ê¶Œ</a>
        </div>
    </nav>
    <button class="menu-toggle" onclick="toggleMenu()">â˜°</button>
    <div class="overlay" id="overlay" onclick="toggleMenu()"></div>
    <div class="container">
        <nav class="sidebar" id="sidebar">
            <button class="close-btn" onclick="toggleMenu()">Ã—</button>
            <div class="sidebar-header"><h1>ğŸ“™ 2ê¶Œ: SQL ê¸°ì´ˆ í¸</h1><p>ë°ì´í„°ë² ì´ìŠ¤ í™œìš©</p></div>
            <ul class="nav-list" id="navList"></ul>
        </nav>
        <main class="main">
            <h1 class="title">ğŸ“‹ ë¶€ë¡: ì¿¼ë¦¬ ë ˆì‹œí”¼ë¶</h1>
            <p>ë³µì‚¬í•´ì„œ ë°”ë¡œ ì“¸ ìˆ˜ ìˆëŠ” ì‹¤ë¬´ ì¿¼ë¦¬ ëª¨ìŒì…ë‹ˆë‹¤.<br>
            ë‚ ì§œì™€ ì´ë¦„ë§Œ ë°”ê¿”ì„œ ì‚¬ìš©í•˜ì„¸ìš”!</p>
            <hr>

            <h2>ğŸ” í™˜ì ì¡°íšŒ</h2>

            <h3>ì´ë¦„ìœ¼ë¡œ í™˜ì ì°¾ê¸°</h3>
            <pre><code>SELECT * FROM patients WHERE name LIKE '%í™ê¸¸ë™%';</code></pre>

            <h3>ì „í™”ë²ˆí˜¸ë¡œ í™˜ì ì°¾ê¸°</h3>
            <pre><code>SELECT * FROM patients WHERE phone LIKE '%1234%';</code></pre>

            <h3>ì˜¤ëŠ˜ ìƒì¼ì¸ í™˜ì</h3>
            <pre><code>SELECT name, phone, birth_date
FROM patients
WHERE MONTH(birth_date) = MONTH(CURDATE())
  AND DAY(birth_date) = DAY(CURDATE());</code></pre>
            <hr>

            <h2>ğŸ“… ì˜ˆì•½/ì¼ì • ê´€ë¦¬</h2>

            <h3>ì˜¤ëŠ˜ ì˜ˆì•½ ëª©ë¡</h3>
            <pre><code>SELECT
    TIME_FORMAT(ts.start_time, '%H:%i') AS ì‹œê°„,
    p.name AS í™˜ì,
    t.name AS ì¹˜ë£Œì‚¬
FROM treatment_sessions ts
JOIN patients p ON ts.patient_id = p.patient_id
JOIN therapists t ON ts.therapist_id = t.therapist_id
WHERE ts.session_date = CURDATE()
ORDER BY ts.start_time;</code></pre>

            <h3>ë‚´ì¼ ì˜ˆì•½ ëª©ë¡</h3>
            <pre><code>SELECT
    TIME_FORMAT(ts.start_time, '%H:%i') AS ì‹œê°„,
    p.name AS í™˜ì,
    p.phone AS ì—°ë½ì²˜,
    t.name AS ì¹˜ë£Œì‚¬
FROM treatment_sessions ts
JOIN patients p ON ts.patient_id = p.patient_id
JOIN therapists t ON ts.therapist_id = t.therapist_id
WHERE ts.session_date = DATE_ADD(CURDATE(), INTERVAL 1 DAY)
ORDER BY ts.start_time;</code></pre>
            <hr>

            <h2>ğŸ“ í•´í”¼ì½œ/ë¦¬ì½œ ê´€ë¦¬</h2>

            <h3>7ì¼ ì´ìƒ ë¯¸ë°©ë¬¸ í™˜ì</h3>
            <pre><code>SELECT
    p.name, p.phone,
    MAX(ts.session_date) AS ë§ˆì§€ë§‰ë°©ë¬¸,
    DATEDIFF(CURDATE(), MAX(ts.session_date)) AS ê²½ê³¼ì¼
FROM patients p
JOIN treatment_sessions ts ON p.patient_id = ts.patient_id
GROUP BY p.patient_id, p.name, p.phone
HAVING DATEDIFF(CURDATE(), MAX(ts.session_date)) >= 7
ORDER BY ê²½ê³¼ì¼ DESC;</code></pre>

            <h3>14ì¼ ì´ìƒ ë¯¸ë°©ë¬¸ í™˜ì</h3>
            <pre><code>SELECT
    p.name, p.phone,
    MAX(ts.session_date) AS ë§ˆì§€ë§‰ë°©ë¬¸,
    DATEDIFF(CURDATE(), MAX(ts.session_date)) AS ê²½ê³¼ì¼
FROM patients p
JOIN treatment_sessions ts ON p.patient_id = ts.patient_id
GROUP BY p.patient_id, p.name, p.phone
HAVING DATEDIFF(CURDATE(), MAX(ts.session_date)) >= 14
ORDER BY ê²½ê³¼ì¼ DESC;</code></pre>
            <hr>

            <h2>ğŸ’° ë§¤ì¶œ ê´€ë¦¬</h2>

            <h3>ì˜¤ëŠ˜ ë§¤ì¶œ</h3>
            <pre><code>SELECT
    SUM(b.total_amount) AS ì´ë§¤ì¶œ,
    SUM(CASE WHEN b.payment_status = 'ì™„ë£Œ' THEN b.total_amount ELSE 0 END) AS ìˆ˜ë‚©ì™„ë£Œ,
    SUM(CASE WHEN b.payment_status = 'ëŒ€ê¸°' THEN b.total_amount ELSE 0 END) AS ë¯¸ìˆ˜ê¸ˆ
FROM billings b
JOIN treatment_sessions ts ON b.session_id = ts.session_id
WHERE ts.session_date = CURDATE();</code></pre>

            <h3>ì´ë²ˆ ë‹¬ ë§¤ì¶œ</h3>
            <pre><code>SELECT
    SUM(b.total_amount) AS ì´ë§¤ì¶œ
FROM billings b
JOIN treatment_sessions ts ON b.session_id = ts.session_id
WHERE ts.session_date >= DATE_FORMAT(CURDATE(), '%Y-%m-01')
  AND ts.session_date < DATE_ADD(DATE_FORMAT(CURDATE(), '%Y-%m-01'), INTERVAL 1 MONTH);</code></pre>
            <hr>

            <h2>ğŸ‘¨â€âš•ï¸ ì¹˜ë£Œì‚¬ ì‹¤ì </h2>

            <h3>ì¹˜ë£Œì‚¬ë³„ ì´ë²ˆ ë‹¬ ì¹˜ë£Œ íšŸìˆ˜</h3>
            <pre><code>SELECT
    t.name AS ì¹˜ë£Œì‚¬,
    COUNT(*) AS ì¹˜ë£ŒíšŸìˆ˜
FROM treatment_sessions ts
JOIN therapists t ON ts.therapist_id = t.therapist_id
WHERE ts.session_date >= DATE_FORMAT(CURDATE(), '%Y-%m-01')
GROUP BY t.therapist_id, t.name
ORDER BY ì¹˜ë£ŒíšŸìˆ˜ DESC;</code></pre>

            <h3>ì¹˜ë£Œì‚¬ë³„ ì´ë²ˆ ë‹¬ ë§¤ì¶œ</h3>
            <pre><code>SELECT
    t.name AS ì¹˜ë£Œì‚¬,
    SUM(b.total_amount) AS ë§¤ì¶œ
FROM treatment_sessions ts
JOIN therapists t ON ts.therapist_id = t.therapist_id
JOIN billings b ON ts.session_id = b.session_id
WHERE ts.session_date >= DATE_FORMAT(CURDATE(), '%Y-%m-01')
GROUP BY t.therapist_id, t.name
ORDER BY ë§¤ì¶œ DESC;</code></pre>
            <hr>

            <div class="tip"><strong>ğŸ’¡ ë‚ ì§œ ë³€ê²½ íŒ</strong><br>
            <code>CURDATE()</code> â†’ ì˜¤ëŠ˜ ë‚ ì§œ<br>
            <code>'2024-01-01'</code> â†’ ì›í•˜ëŠ” ë‚ ì§œë¡œ ë°”ê¿”ì„œ ì‚¬ìš©</div>

            <div class="nav-buttons">
                <a href="chapter-11.html" class="nav-btn">â† ì´ì „</a>
                <span class="page-num">12 / 12</span>
                <button class="nav-btn" disabled>ë‹¤ìŒ â†’</button>
            </div>
        </main>
    </div>
    <script src="../js/nav.js"></script>
</body>
</html>
