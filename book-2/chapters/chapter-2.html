<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[2장] 환자 관리 실무 - 물리치료사를 위한 DB 2권</title>
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
    <!-- 상단 네비게이션 -->
    <nav class="top-nav">
        <a href="../../index.html" class="top-nav-brand">
            <span>🏥</span> DB 완전정복
        </a>
        <div class="top-nav-links">
            <a href="../../book-1/index.html" class="top-nav-link book-1">1권</a>
            <a href="../../book-2/index.html" class="top-nav-link book-2 active">2권</a>
            <a href="../../book-3/index.html" class="top-nav-link book-3">3권</a>
            <a href="../../book-4/index.html" class="top-nav-link book-4">4권</a>
            <a href="../../book-5/index.html" class="top-nav-link book-5">5권</a>
        </div>
    </nav>

    <button class="menu-toggle" onclick="toggleMenu()">☰</button>
    <div class="overlay" id="overlay" onclick="toggleMenu()"></div>

    <div class="container">
        <nav class="sidebar" id="sidebar">
            <button class="close-btn" onclick="toggleMenu()">×</button>
            <div class="sidebar-header">
                <h1>📙 2권: SQL 기초 편</h1>
                <p>데이터베이스 활용</p>
            </div>
            <ul class="nav-list" id="navList"></ul>
        </nav>

        <main class="main">
            <h1 class="title">[2장] 환자 관리 실무</h1>

            <div class="intro-box">
                <p>이번 장에서는 데이터를 <strong>추가(INSERT)</strong>, <strong>수정(UPDATE)</strong>, <strong>삭제(DELETE)</strong>하는 방법을 배웁니다. 1장에서는 데이터를 "읽기만" 했다면, 이제는 직접 데이터를 변경하는 작업을 다룹니다.</p>
            </div>

            <div class="warning">
                <strong>⚠️ 이 장을 읽기 전 반드시 알아두세요!</strong><br><br>
                <strong>UPDATE</strong>와 <strong>DELETE</strong>는 항상 <strong>WHERE</strong>와 함께 사용하세요!<br><br>
                WHERE 없이 실행하면 <strong>전체 데이터</strong>가 바뀌거나 삭제됩니다.<br>
                예: <code>DELETE FROM patients;</code> → 모든 환자 데이터 삭제! 😱
            </div>

            <hr>

            <!-- ===== 쿼리 1: 신규 환자 등록 ===== -->
            <h2>1. 신규 환자 등록 (INSERT)</h2>

            <div class="concept-box">
                <h3>🎯 이 쿼리가 필요한 상황</h3>
                <p>새로운 환자가 처음 방문했을 때, 환자 정보를 데이터베이스에 등록합니다. 보통 EMR 화면에서 입력하면 내부적으로 이런 쿼리가 실행되는 거예요.</p>
            </div>

            <pre><code>INSERT INTO patients (patient_id, name, gender, phone, birth_date, insurance_code)
VALUES (
    'P005',
    '정우성',
    'M',
    '010-7777-8888',
    '1973-03-20',
    'INS001'
);</code></pre>

            <div class="explanation-box">
                <h3>📖 INSERT 문법 완전 분석</h3>

                <div class="line-explain">
                    <div class="code-line">INSERT INTO patients</div>
                    <div class="explain-text">
                        "<strong>patients 테이블에 새 데이터를 넣어줘</strong>"<br><br>
                        <code>INSERT INTO</code>는 "~에 넣다"라는 의미예요.<br>
                        영어 그대로 해석하면 됩니다: Insert(삽입하다) Into(~안에)
                    </div>
                </div>

                <div class="line-explain">
                    <div class="code-line">(patient_id, name, gender, phone, birth_date, insurance_code)</div>
                    <div class="explain-text">
                        "<strong>이 컬럼들에 값을 넣을 거야</strong>"<br><br>
                        괄호 안에는 값을 넣을 컬럼 이름들을 나열합니다.<br>
                        순서가 중요해요! 아래 VALUES와 순서가 일치해야 합니다.
                    </div>
                </div>

                <div class="line-explain">
                    <div class="code-line">VALUES ('P005', '정우성', 'M', ...)</div>
                    <div class="explain-text">
                        "<strong>실제로 넣을 값들은 이거야</strong>"<br><br>
                        위에서 나열한 컬럼 순서대로 값을 넣습니다:<br>
                        • patient_id ← 'P005'<br>
                        • name ← '정우성'<br>
                        • gender ← 'M'<br>
                        • phone ← '010-7777-8888'<br>
                        • birth_date ← '1973-03-20'<br>
                        • insurance_code ← 'INS001'
                    </div>
                </div>

                <div class="analogy-box">
                    <h4>🎭 비유로 이해하기</h4>
                    <p>INSERT는 <strong>새 줄을 추가하는 것</strong>이에요.</p>
                    <p>엑셀에서 맨 아래 빈 행에 새 데이터를 입력하는 것과 같습니다.</p>
                    <table class="mini-table">
                        <tr><th>patient_id</th><th>name</th><th>gender</th><th>phone</th></tr>
                        <tr><td>P001</td><td>김철수</td><td>M</td><td>010-1234-...</td></tr>
                        <tr><td>P002</td><td>이영희</td><td>F</td><td>010-2345-...</td></tr>
                        <tr class="highlight-row"><td>P005</td><td>정우성</td><td>M</td><td>010-7777-...</td></tr>
                    </table>
                    <p class="table-caption">↑ 새로 추가된 행</p>
                </div>
            </div>

            <div class="tip">
                <strong>💡 실무 팁: 문자열은 작은따옴표로!</strong><br>
                SQL에서 문자열(텍스트)은 반드시 <code>'작은따옴표'</code>로 감싸야 합니다.<br>
                숫자는 따옴표 없이 그냥 씁니다: <code>VALUES (123, '홍길동')</code>
            </div>

            <hr>

            <!-- ===== 쿼리 2: 환자 정보 수정 ===== -->
            <h2>2. 환자 정보 수정 (UPDATE)</h2>

            <div class="concept-box">
                <h3>🎯 이 쿼리가 필요한 상황</h3>
                <p>"환자분이 전화번호 바뀌셨대요" - 기존 데이터를 수정해야 할 때 사용합니다.</p>
            </div>

            <div class="step-box">
                <h4>📋 안전한 UPDATE 2단계 절차</h4>
                <div class="step-item">
                    <span class="step-num">1단계</span>
                    <span class="step-desc">먼저 SELECT로 대상 확인</span>
                </div>
                <div class="step-item">
                    <span class="step-num">2단계</span>
                    <span class="step-desc">확인 후 UPDATE 실행</span>
                </div>
            </div>

            <h4>1단계: 먼저 확인하기</h4>
            <pre><code>SELECT * FROM patients WHERE patient_id = 'P001';</code></pre>

            <div class="explanation-box">
                <div class="why-box">
                    <h4>❓ 왜 먼저 SELECT를 할까요?</h4>
                    <p>수정하기 전에 "<strong>내가 바꾸려는 게 정말 이 데이터가 맞나?</strong>"를 확인하는 거예요.<br>
                    잘못된 환자의 정보를 수정하면 큰일 나잖아요!</p>
                </div>
            </div>

            <h4>2단계: 수정 실행</h4>
            <pre><code>UPDATE patients
SET phone = '010-9999-0000'
WHERE patient_id = 'P001';</code></pre>

            <div class="explanation-box">
                <h3>📖 UPDATE 문법 완전 분석</h3>

                <div class="line-explain">
                    <div class="code-line">UPDATE patients</div>
                    <div class="explain-text">
                        "<strong>patients 테이블을 수정할 거야</strong>"
                    </div>
                </div>

                <div class="line-explain">
                    <div class="code-line">SET phone = '010-9999-0000'</div>
                    <div class="explain-text">
                        "<strong>phone 컬럼의 값을 이걸로 바꿔줘</strong>"<br><br>
                        <code>SET</code>은 "설정하다"라는 뜻이에요.<br>
                        여러 컬럼을 한 번에 바꾸려면 콤마로 구분:<br>
                        <code>SET phone = '010-9999-0000', name = '김철수(수정)'</code>
                    </div>
                </div>

                <div class="line-explain">
                    <div class="code-line">WHERE patient_id = 'P001'</div>
                    <div class="explain-text">
                        "<strong>단, patient_id가 P001인 행만!</strong>"<br><br>
                        🚨 <strong>이 부분이 제일 중요합니다!</strong><br>
                        WHERE가 없으면 <strong>모든 환자</strong>의 전화번호가 바뀝니다!
                    </div>
                </div>

                <div class="analogy-box">
                    <h4>🎭 비유로 이해하기</h4>
                    <p><strong>UPDATE</strong>는 엑셀에서 <strong>특정 셀의 값을 수정</strong>하는 것과 같아요.</p>
                    <table class="mini-table">
                        <tr><th>patient_id</th><th>name</th><th>phone</th></tr>
                        <tr>
                            <td>P001</td>
                            <td>김철수</td>
                            <td><span class="strikethrough">010-1234-5678</span> → <span class="highlight-text">010-9999-0000</span></td>
                        </tr>
                        <tr><td>P002</td><td>이영희</td><td>010-2345-6789</td></tr>
                    </table>
                </div>
            </div>

            <div class="warning">
                <strong>🚨 UPDATE 실수 방지 체크리스트</strong><br><br>
                ✅ WHERE 절이 있는가?<br>
                ✅ WHERE 조건이 정확한가? (SELECT로 먼저 확인!)<br>
                ✅ 바꾸려는 값이 맞는가?
            </div>

            <hr>

            <!-- ===== 쿼리 3: 수납 상태 변경 ===== -->
            <h2>3. 수납 상태 변경</h2>

            <div class="concept-box">
                <h3>🎯 이 쿼리가 필요한 상황</h3>
                <p>환자가 수납을 완료했을 때, 수납 상태를 "대기"에서 "완료"로 변경합니다.</p>
            </div>

            <pre><code>UPDATE billings
SET payment_status = '완료', payment_date = CURDATE()
WHERE billing_id = 5;</code></pre>

            <div class="explanation-box">
                <h3>📖 쿼리 뜯어보기</h3>

                <div class="line-explain">
                    <div class="code-line">SET payment_status = '완료', payment_date = CURDATE()</div>
                    <div class="explain-text">
                        <strong>두 개의 컬럼을 동시에 수정</strong>합니다:<br><br>
                        • <code>payment_status = '완료'</code>: 상태를 "완료"로 변경<br>
                        • <code>payment_date = CURDATE()</code>: 수납일을 오늘 날짜로 기록<br><br>
                        콤마(,)로 구분하면 여러 컬럼을 한 번에 수정할 수 있어요!
                    </div>
                </div>

                <div class="why-box">
                    <h4>❓ 왜 수납일도 같이 기록할까요?</h4>
                    <p>"언제 수납했는지" 기록이 남아야 나중에 매출 분석이나 정산할 때 편해요.<br>
                    CURDATE()를 쓰면 자동으로 오늘 날짜가 들어가니까 실수할 일도 없죠!</p>
                </div>
            </div>

            <div class="tip">
                <strong>💡 여러 컬럼 동시 수정 예시</strong><br>
                <pre><code>UPDATE patients
SET
    phone = '010-1111-2222',
    address = '서울시 강남구',
    memo = '연락처 변경됨'
WHERE patient_id = 'P001';</code></pre>
            </div>

            <hr>

            <!-- ===== 쿼리 4: 데이터 삭제 ===== -->
            <h2>4. 데이터 삭제 (DELETE)</h2>

            <div class="warning">
                <strong>🚨 DELETE는 가장 위험한 명령어입니다!</strong><br><br>
                삭제된 데이터는 <strong>복구가 매우 어렵습니다</strong>.<br>
                실무에서는 삭제보다 "상태 변경"(예: is_deleted = 1)을 권장합니다.
            </div>

            <div class="concept-box">
                <h3>🎯 이 쿼리가 필요한 상황</h3>
                <p>잘못 입력된 데이터를 삭제해야 할 때. 하지만 정말 필요한 경우에만 사용하세요!</p>
            </div>

            <div class="step-box">
                <h4>📋 안전한 DELETE 3단계 절차</h4>
                <div class="step-item">
                    <span class="step-num">1단계</span>
                    <span class="step-desc">삭제 대상 SELECT로 확인</span>
                </div>
                <div class="step-item">
                    <span class="step-num">2단계</span>
                    <span class="step-desc">연결된 데이터 먼저 삭제</span>
                </div>
                <div class="step-item">
                    <span class="step-num">3단계</span>
                    <span class="step-desc">본 데이터 삭제</span>
                </div>
            </div>

            <h4>1단계: 삭제 대상 확인</h4>
            <pre><code>SELECT * FROM treatment_sessions WHERE session_id = 8;</code></pre>

            <div class="explanation-box">
                <div class="why-box">
                    <h4>❓ 왜 먼저 SELECT를 할까요?</h4>
                    <p>삭제하면 되돌릴 수 없으니까, "<strong>정말 이게 삭제할 데이터가 맞나?</strong>"를 100% 확인해야 해요.</p>
                </div>
            </div>

            <h4>2단계: 연결된 데이터 먼저 삭제</h4>
            <pre><code>DELETE FROM billings WHERE session_id = 8;</code></pre>

            <div class="explanation-box">
                <div class="why-box">
                    <h4>❓ 왜 billings를 먼저 삭제할까요?</h4>
                    <p>데이터베이스에서는 <strong>"참조 무결성"</strong>이라는 규칙이 있어요.</p>
                    <p>billings 테이블이 treatment_sessions를 참조하고 있으면,<br>
                    참조당하는 쪽(treatment_sessions)을 먼저 삭제할 수 없습니다.</p>
                    <br>
                    <p>🎭 <strong>비유</strong>: 부모(세션)가 자식(청구)을 두고 있으면,<br>
                    자식을 먼저 내보내야 부모도 나갈 수 있어요.</p>
                </div>
            </div>

            <h4>3단계: 본 데이터 삭제</h4>
            <pre><code>DELETE FROM treatment_sessions WHERE session_id = 8;</code></pre>

            <div class="explanation-box">
                <h3>📖 DELETE 문법 분석</h3>

                <div class="line-explain">
                    <div class="code-line">DELETE FROM treatment_sessions</div>
                    <div class="explain-text">
                        "<strong>treatment_sessions 테이블에서 삭제해줘</strong>"<br><br>
                        SELECT와 다르게 컬럼을 지정하지 않아요.<br>
                        DELETE는 항상 <strong>행(row) 전체</strong>를 삭제합니다.
                    </div>
                </div>

                <div class="line-explain">
                    <div class="code-line">WHERE session_id = 8</div>
                    <div class="explain-text">
                        "<strong>session_id가 8인 행만!</strong>"<br><br>
                        🚨 <strong>WHERE를 빼먹으면 모든 데이터가 삭제됩니다!</strong><br>
                        <code>DELETE FROM treatment_sessions;</code> → 전체 치료 기록 삭제 😱
                    </div>
                </div>
            </div>

            <div class="compare-box">
                <h4>🔄 삭제 vs 상태 변경 (실무 권장)</h4>
                <div class="compare-item">
                    <h5>DELETE (물리적 삭제)</h5>
                    <pre><code>DELETE FROM patients
WHERE patient_id = 'P001';</code></pre>
                    <p class="compare-note">데이터가 완전히 사라짐 ❌</p>
                </div>
                <div class="compare-item">
                    <h5>UPDATE (논리적 삭제) ✅ 권장</h5>
                    <pre><code>UPDATE patients
SET is_deleted = 1, deleted_at = NOW()
WHERE patient_id = 'P001';</code></pre>
                    <p class="compare-note">데이터는 남아있고, 삭제 표시만 함</p>
                </div>
            </div>

            <div class="tip">
                <strong>💡 실무에서는 "소프트 삭제"를 많이 씁니다</strong><br><br>
                실제로 DELETE하지 않고, <code>is_deleted = 1</code> 같은 플래그를 두어<br>
                "삭제된 것처럼" 처리합니다. 이러면 실수로 삭제해도 복구할 수 있어요!
            </div>

            <div class="summary-box">
                <h3>📝 이번 장 핵심 정리</h3>
                <table class="summary-table">
                    <tr>
                        <th>명령어</th>
                        <th>역할</th>
                        <th>주의사항</th>
                    </tr>
                    <tr>
                        <td><strong>INSERT INTO</strong></td>
                        <td>새 데이터 추가</td>
                        <td>컬럼 순서와 값 순서 일치</td>
                    </tr>
                    <tr>
                        <td><strong>UPDATE</strong></td>
                        <td>기존 데이터 수정</td>
                        <td>WHERE 필수! 먼저 SELECT로 확인</td>
                    </tr>
                    <tr>
                        <td><strong>DELETE</strong></td>
                        <td>데이터 삭제</td>
                        <td>WHERE 필수! 연결된 데이터 먼저 삭제</td>
                    </tr>
                </table>
                <br>
                <p><strong>🔑 핵심 원칙</strong>: UPDATE/DELETE 전에 항상 SELECT로 먼저 확인하세요!</p>
            </div>

            <div class="nav-buttons">
                <a href="chapter-1.html" class="nav-btn">← 이전</a>
                <span class="page-num">2 / 12</span>
                <a href="chapter-3.html" class="nav-btn">다음 →</a>
            </div>
        </main>
    </div>

    <script src="../js/nav.js"></script>
</body>
</html>
