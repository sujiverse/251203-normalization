<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[1장] 매일 쓰는 기본 조회 - 물리치료사를 위한 DB 2권</title>
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
    <!-- 상단 네비게이션 -->
    <nav class="top-nav">
        <a href="../../index.html" class="top-nav-brand">
            <span>🏥</span> DB 완전정복
        </a>
        <div class="top-nav-links">
            <a href="../../book-1/index.html" class="top-nav-link book-1">1권</a>
            <a href="../../book-2/index.html" class="top-nav-link book-2 active">2권</a>
            <a href="../../book-3/index.html" class="top-nav-link book-3">3권</a>
            <a href="../../book-4/index.html" class="top-nav-link book-4">4권</a>
            <a href="../../book-5/index.html" class="top-nav-link book-5">5권</a>
        </div>
    </nav>

    <button class="menu-toggle" onclick="toggleMenu()">☰</button>
    <div class="overlay" id="overlay" onclick="toggleMenu()"></div>

    <div class="container">
        <nav class="sidebar" id="sidebar">
            <button class="close-btn" onclick="toggleMenu()">×</button>
            <div class="sidebar-header">
                <h1>📙 2권: SQL 기초 편</h1>
                <p>데이터베이스 활용</p>
            </div>
            <ul class="nav-list" id="navList"></ul>
        </nav>

        <main class="main">
            <h1 class="title">[1장] 매일 쓰는 기본 조회</h1>

            <div class="intro-box">
                <p>이번 장에서는 물리치료실에서 <strong>매일 아침 출근하면 바로 사용할</strong> 실무 쿼리들을 배웁니다. 오늘 예약된 환자는 누구인지, 특정 환자를 어떻게 검색하는지, 그리고 환자의 치료 이력을 어떻게 조회하는지 알아보겠습니다.</p>
            </div>

            <!-- ===== 쿼리 1: 오늘 예약 환자 목록 ===== -->
            <h2>1. 오늘 예약 환자 목록</h2>

            <div class="concept-box">
                <h3>🎯 이 쿼리가 필요한 상황</h3>
                <p>아침에 출근해서 "오늘 누가 오지?"를 확인할 때 사용합니다. 예약 시간순으로 정렬되어 있어서 하루 스케줄을 한눈에 파악할 수 있어요.</p>
            </div>

            <pre><code>SELECT
    TIME_FORMAT(ts.start_time, '%H:%i') AS 예약시간,
    p.name AS 환자명,
    p.phone AS 연락처,
    t.name AS 담당치료사
FROM treatment_sessions ts
JOIN patients p ON ts.patient_id = p.patient_id
JOIN therapists t ON ts.therapist_id = t.therapist_id
WHERE ts.session_date = CURDATE()
ORDER BY ts.start_time;</code></pre>

            <div class="explanation-box">
                <h3>📖 쿼리 뜯어보기 (한 줄씩 이해하기)</h3>

                <div class="line-explain">
                    <div class="code-line">SELECT</div>
                    <div class="explain-text">"<strong>골라줘</strong>"라는 뜻입니다. 데이터베이스한테 "이런 정보들을 보여줘"라고 요청하는 거예요.</div>
                </div>

                <div class="line-explain">
                    <div class="code-line">TIME_FORMAT(ts.start_time, '%H:%i') AS 예약시간</div>
                    <div class="explain-text">
                        <strong>TIME_FORMAT</strong>은 시간 형식을 바꿔주는 함수예요.<br>
                        • <code>ts.start_time</code>: treatment_sessions 테이블의 시작시간 컬럼<br>
                        • <code>'%H:%i'</code>: "시:분" 형태로 보여줘 (예: 09:30, 14:00)<br>
                        • <code>AS 예약시간</code>: 결과 컬럼 이름을 "예약시간"으로 표시<br><br>
                        <strong>왜 필요할까요?</strong> 원래 데이터가 "09:30:00"처럼 초까지 저장되어 있는데, 실무에서는 초까지 볼 필요 없잖아요!
                    </div>
                </div>

                <div class="line-explain">
                    <div class="code-line">p.name AS 환자명, p.phone AS 연락처</div>
                    <div class="explain-text">
                        patients 테이블에서 이름과 전화번호를 가져옵니다.<br>
                        • <code>p</code>는 patients 테이블의 <strong>별명(alias)</strong>이에요. 매번 "patients.name"이라고 쓰기 귀찮으니까 "p"라고 줄여 쓰는 거죠.
                    </div>
                </div>

                <div class="line-explain">
                    <div class="code-line">FROM treatment_sessions ts</div>
                    <div class="explain-text">
                        "<strong>어디서 가져올 건데?</strong>" treatment_sessions(치료 세션) 테이블에서 가져옵니다.<br>
                        • <code>ts</code>: treatment_sessions의 별명
                    </div>
                </div>

                <div class="line-explain">
                    <div class="code-line">JOIN patients p ON ts.patient_id = p.patient_id</div>
                    <div class="explain-text">
                        <strong>JOIN은 테이블을 연결하는 것</strong>입니다!<br><br>
                        🎯 <strong>비유로 이해하기:</strong><br>
                        치료 세션 테이블에는 "P001"이라는 환자 ID만 있어요. 근데 우리는 "김철수"라는 이름이 필요하죠?<br>
                        환자 이름은 patients 테이블에 있으니까, 두 테이블을 <strong>환자 ID로 연결</strong>하는 거예요.<br><br>
                        <code>ON ts.patient_id = p.patient_id</code><br>
                        → "치료 세션의 환자ID와 환자 테이블의 환자ID가 같은 것끼리 연결해줘"
                    </div>
                </div>

                <div class="line-explain">
                    <div class="code-line">JOIN therapists t ON ts.therapist_id = t.therapist_id</div>
                    <div class="explain-text">
                        마찬가지로 치료사 테이블도 연결해서 치료사 이름을 가져옵니다.
                    </div>
                </div>

                <div class="line-explain">
                    <div class="code-line">WHERE ts.session_date = CURDATE()</div>
                    <div class="explain-text">
                        "<strong>조건: 오늘 날짜인 것만!</strong>"<br>
                        • <code>CURDATE()</code>: 오늘 날짜를 자동으로 가져오는 함수<br>
                        • 매일 실행해도 항상 "그 날" 예약만 보여줍니다
                    </div>
                </div>

                <div class="line-explain">
                    <div class="code-line">ORDER BY ts.start_time</div>
                    <div class="explain-text">
                        "<strong>시작 시간 순서대로 정렬해줘</strong>"<br>
                        아침 9시 환자부터 순서대로 보여줍니다.
                    </div>
                </div>
            </div>

            <div class="result-example">
                <h4>📋 실행 결과 예시</h4>
                <table class="result-table">
                    <tr><th>예약시간</th><th>환자명</th><th>연락처</th><th>담당치료사</th></tr>
                    <tr><td>09:00</td><td>김철수</td><td>010-1234-5678</td><td>박치료</td></tr>
                    <tr><td>09:30</td><td>이영희</td><td>010-2345-6789</td><td>박치료</td></tr>
                    <tr><td>10:00</td><td>박민수</td><td>010-3456-7890</td><td>김재활</td></tr>
                </table>
            </div>

            <div class="tip">
                <strong>💡 실무 팁</strong><br>
                이 쿼리를 EMR 시스템에 저장해두면 매일 클릭 한 번으로 오늘 스케줄을 확인할 수 있어요!
            </div>

            <hr>

            <!-- ===== 쿼리 2: 환자 이름으로 검색 ===== -->
            <h2>2. 환자 이름으로 검색</h2>

            <div class="concept-box">
                <h3>🎯 이 쿼리가 필요한 상황</h3>
                <p>"김철수 환자분 차트 좀 열어봐" - 환자 이름만 알 때 빠르게 찾을 수 있어요. 이름 일부만 알아도 검색 가능합니다!</p>
            </div>

            <pre><code>SELECT
    p.patient_id AS 환자번호,
    p.name AS 이름,
    p.phone AS 연락처,
    p.birth_date AS 생년월일
FROM patients p
WHERE p.name LIKE '%김철수%';</code></pre>

            <div class="explanation-box">
                <h3>📖 LIKE와 와일드카드(%) 완전 정복</h3>

                <p><strong>LIKE</strong>는 "~처럼 생긴 것"을 찾는 명령어예요. <strong>%</strong>는 "아무 글자나"를 의미합니다.</p>

                <div class="pattern-box">
                    <h4>🔍 검색 패턴 3가지</h4>

                    <div class="pattern-item">
                        <code>'김%'</code>
                        <span class="pattern-desc"><strong>김</strong>으로 시작하는 모든 이름</span>
                        <span class="pattern-example">김철수, 김영희, 김민수 ✓ / 박김철 ✗</span>
                    </div>

                    <div class="pattern-item">
                        <code>'%철%'</code>
                        <span class="pattern-desc"><strong>철</strong>이 포함된 모든 이름</span>
                        <span class="pattern-example">김철수, 박철민, 철수 ✓</span>
                    </div>

                    <div class="pattern-item">
                        <code>'%수'</code>
                        <span class="pattern-desc"><strong>수</strong>로 끝나는 모든 이름</span>
                        <span class="pattern-example">김철수, 박민수, 이영수 ✓ / 수진이 ✗</span>
                    </div>
                </div>

                <div class="analogy-box">
                    <h4>🎭 비유로 이해하기</h4>
                    <p>%는 조커 카드라고 생각하세요! 조커는 어떤 카드도 될 수 있잖아요?</p>
                    <ul>
                        <li><code>'김%'</code> = "김" + 조커 = 김으로 시작하면 뒤에 뭐가 와도 OK</li>
                        <li><code>'%철%'</code> = 조커 + "철" + 조커 = 어디든 "철"만 있으면 OK</li>
                    </ul>
                </div>
            </div>

            <div class="warning">
                <strong>⚠️ 주의사항</strong><br>
                동명이인이 있을 수 있어요! 검색 결과에서 생년월일이나 연락처로 정확한 환자를 확인하세요.
            </div>

            <hr>

            <!-- ===== 쿼리 3: 특정 환자의 치료 이력 ===== -->
            <h2>3. 특정 환자의 치료 이력</h2>

            <div class="concept-box">
                <h3>🎯 이 쿼리가 필요한 상황</h3>
                <p>"이 환자분 여기 언제부터 오셨지?", "지난번에 무슨 치료 받으셨더라?" - 환자의 전체 치료 기록을 조회할 때 사용합니다.</p>
            </div>

            <pre><code>SELECT
    ts.session_date AS 치료일,
    t.name AS 치료사,
    fi.fee_name AS 치료종류,
    b.total_amount AS 금액
FROM treatment_sessions ts
JOIN therapists t ON ts.therapist_id = t.therapist_id
JOIN patients p ON ts.patient_id = p.patient_id
LEFT JOIN billings b ON ts.session_id = b.session_id
LEFT JOIN fee_items fi ON b.fee_code = fi.fee_code
WHERE p.name = '김철수'
ORDER BY ts.session_date DESC;</code></pre>

            <div class="explanation-box">
                <h3>📖 JOIN vs LEFT JOIN 차이점</h3>

                <p>이 쿼리에서 <strong>JOIN</strong>과 <strong>LEFT JOIN</strong> 두 가지가 나오죠? 차이를 알아봅시다.</p>

                <div class="compare-box">
                    <div class="compare-item">
                        <h4>JOIN (INNER JOIN)</h4>
                        <p><strong>양쪽 테이블 모두에 데이터가 있는 것만</strong> 가져옵니다.</p>
                        <p class="compare-example">
                            치료사가 배정된 세션만 보여줌<br>
                            (치료사 없는 세션은 제외)
                        </p>
                    </div>
                    <div class="compare-item">
                        <h4>LEFT JOIN</h4>
                        <p><strong>왼쪽 테이블은 전부, 오른쪽은 있으면</strong> 가져옵니다.</p>
                        <p class="compare-example">
                            수납 정보가 없어도 세션은 보여줌<br>
                            (수납 전이라도 치료 기록은 표시)
                        </p>
                    </div>
                </div>

                <div class="analogy-box">
                    <h4>🎭 비유로 이해하기</h4>
                    <p><strong>JOIN</strong>: 커플만 입장 가능한 클럽 🚪</p>
                    <p>→ 짝(연결된 데이터)이 있어야만 들어갈 수 있음</p>
                    <br>
                    <p><strong>LEFT JOIN</strong>: 솔로도 환영하는 파티 🎉</p>
                    <p>→ 왼쪽 테이블 사람들은 일단 다 들어오고, 짝이 있으면 같이 입장</p>
                </div>

                <div class="why-box">
                    <h4>❓ 왜 billings에 LEFT JOIN을 썼을까?</h4>
                    <p>치료는 받았는데 <strong>아직 수납을 안 한</strong> 경우가 있잖아요!<br>
                    그래도 치료 기록은 보고 싶으니까 LEFT JOIN을 사용합니다.<br>
                    만약 그냥 JOIN을 쓰면 수납 안 한 치료 기록은 아예 안 보여요.</p>
                </div>
            </div>

            <div class="line-explain">
                <div class="code-line">ORDER BY ts.session_date DESC</div>
                <div class="explain-text">
                    <strong>DESC</strong>는 내림차순(최신순)이에요!<br>
                    • <code>DESC</code>: 최신 → 과거 순서 (내림차순, Descending)<br>
                    • <code>ASC</code>: 과거 → 최신 순서 (오름차순, Ascending, 생략 가능)<br><br>
                    보통 치료 이력은 최근 기록부터 보고 싶으니까 DESC를 씁니다.
                </div>
            </div>

            <div class="result-example">
                <h4>📋 실행 결과 예시</h4>
                <table class="result-table">
                    <tr><th>치료일</th><th>치료사</th><th>치료종류</th><th>금액</th></tr>
                    <tr><td>2024-01-15</td><td>박치료</td><td>도수치료</td><td>50,000</td></tr>
                    <tr><td>2024-01-12</td><td>박치료</td><td>도수치료</td><td>50,000</td></tr>
                    <tr><td>2024-01-10</td><td>김재활</td><td>물리치료</td><td>15,000</td></tr>
                    <tr><td>2024-01-08</td><td>박치료</td><td>NULL</td><td>NULL</td></tr>
                </table>
                <p class="result-note">※ 마지막 행의 NULL은 아직 수납 처리가 안 된 경우입니다</p>
            </div>

            <div class="summary-box">
                <h3>📝 이번 장 핵심 정리</h3>
                <ul>
                    <li><strong>SELECT</strong>: 보고 싶은 컬럼 선택</li>
                    <li><strong>FROM</strong>: 어떤 테이블에서 가져올지</li>
                    <li><strong>JOIN</strong>: 테이블 연결 (양쪽 다 있어야 함)</li>
                    <li><strong>LEFT JOIN</strong>: 테이블 연결 (왼쪽은 무조건 포함)</li>
                    <li><strong>WHERE</strong>: 조건 필터링</li>
                    <li><strong>LIKE '%검색어%'</strong>: 부분 문자열 검색</li>
                    <li><strong>ORDER BY</strong>: 정렬 (DESC: 내림차순)</li>
                    <li><strong>CURDATE()</strong>: 오늘 날짜</li>
                </ul>
            </div>

            <div class="nav-buttons">
                <a href="../index.html" class="nav-btn">← 이전</a>
                <span class="page-num">1 / 12</span>
                <a href="chapter-2.html" class="nav-btn">다음 →</a>
            </div>
        </main>
    </div>

    <script src="../js/nav.js"></script>
</body>
</html>
